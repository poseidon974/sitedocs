{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>Voici les diff\u00e9rents cours pr\u00e9sents et document\u00e9s</p> Type Formation Cours Date Linux Administration avanc\u00e9e Installation avanc\u00e9e CENTOS9 01/12/2022 Linux Administration avanc\u00e9e RPM et YUM 02/12/2022 Windows PowerShell Cr\u00e9ation d'un dossier et d'un script 06/12/2022 Windows PowerShell Cr\u00e9ation d'un fichier avec user et date 06/12/2022 Linux Administration [LVM] 01/06/2022 Windows AD Cr\u00e9ation d'une GPO 07/12/2022 Linux S\u00e9curit\u00e9 Les permissions 26/01/2023 Linux S\u00e9curit\u00e9 SE Linux 26/01/2023"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/","title":"Mise en place des partitions","text":""},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#decouverte-des-disques","title":"D\u00e9couverte des disques","text":""},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#emplacement-des-disques","title":"Emplacement des disques","text":"<p><code>/dev/sda</code> </p> <p>sda = Premier disque </p> <p>sdb = Second disque</p> <p>De mani\u00e8re g\u00e9n\u00e9rale sdx avec le x qui est le disque (par ordre aphab\u00e9tique)</p>"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#partitions-des-disques","title":"Partitions des disques","text":"<p><code>/dev/sda1</code></p> <p>sda1 = Premi\u00e8re partition du disque</p> <p>sda2 = Seconde partition du disque</p> <p>De mani\u00e8re g\u00e9\u00e9nrale sdxz avec z qui le num\u00e9ro de la partition.</p>"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#creation-des-partitions","title":"Cr\u00e9ation des partitions","text":""},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#liste-des-partitions","title":"Liste des partitions","text":"<ul> <li> <p>1 partition swap</p> </li> <li> <p>1 partition filesystem</p> </li> <li> <p>3 partition LVM</p> </li> <li> <p>3 partitions RAID</p> </li> </ul> <p>Commande : <code>fdisk /dev/sdb</code></p> <p>Pour acc\u00e8der au menu : <code>m</code> pour l'aide de la commande</p> <p>Cr\u00e9ation de la nouvelle table en GPT : <code>g</code></p> <p>Cr\u00e9ation de la nouvelle partition : <code>n</code></p> <pre><code>-&gt; Num\u00e9ro de partition\n-&gt; Premier secteur \n-&gt; Dernier secteur (possibilit\u00e9 de mettre un espace en K,M,G,T,P)\n</code></pre> <p>Cr\u00e9ation du type de la partition : <code>t</code></p> <pre><code>-&gt; Num\u00e9ro de la partition \u00e0 modifier\n-&gt; Num\u00e9ro ou alias de type de partition\n</code></pre>"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#mise-en-place-de-sauvegarde","title":"Mise en place de sauvegarde","text":""},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#mise-en-place-de-larchive-de-sauvegarde","title":"Mise en place de l'archive de sauvegarde","text":"<p>Sauvegarde : <code>tar -cvz -f /home.tar.gz /home</code></p> <pre><code>-&gt; -c = Cr\u00e9ation d'archive\n-&gt; -v = Verbose\n-&gt; -z = Compression du fichier\n-&gt; -f = Nom de l'archive (Toujours cette option en derni\u00e8re)\n</code></pre> <p>Test de l'archive : <code>tar -tf /home.tar.gz</code></p> <pre><code>-&gt; -t = pour tester l'archive\n-&gt; -f = sp\u00e9cification du fichier (Toujours cette option en derni\u00e8re)\n</code></pre>"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#mise-en-place-du-nouveau-home","title":"Mise en place du nouveau /home","text":""},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#vidange-du-repertoire","title":"Vidange du r\u00e9pertoire","text":"<p>Plusieurs fa\u00e7on de vider le r\u00e9pertoire /home :</p> <p><code>rm -rf /home ; mkdir /home</code></p> <p>ou </p> <p><code>rm -rf /home/*</code></p> <p>Attention \u00e0 ne pas mettre d'espace entre <code>/</code> et <code>home</code> car cela supprimerais tout le syst\u00e8me de fichier. </p>"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#mise-en-place-du-formatage","title":"Mise en place du formatage","text":"<p>Formatage en EXT4 pour la partition <code>FileSystem</code> :</p> <p><code>mkfs.ext4 /dev/sdb2</code></p> <p>Message d'erreur si la partition est d\u00e9j\u00e0 format\u00e9e</p> <p>Obtenir l'UUID d'une partition : </p> <p><code>lsblk -o uuid -n /dev/sdb2</code></p> <p>Modification de fstab : </p> <p><code>nano /etc/fstab</code></p> <p>Montage de la partition et test si fstab est correct:</p> <p><code>sudo mount -av</code></p>"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#restauration-de-larchive","title":"Restauration de l'archive","text":"<p><code>sudo tar -C / -xf /home.tar.gz</code></p> <p><code>ls -l /home</code></p> <p>Vigilance sur la taille du syst\u00e8me de fichier sinon l'extraction ne focntionnera pas.</p>"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#lvm","title":"LVM","text":""},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#commandes-lvm2","title":"Commandes LVM2","text":"<p>Scan des partitions LVM : <code>pvs</code> alias =&gt; <code>pvscan</code></p> <p>Cr\u00e9ation disques physiques pour les  volumes logiques : <code>pvcreate /dev/sdb3 /dev/sdb4 /dev/sdb5</code> alias =&gt; <code>pvcreate /dev/sdb{3..5}</code></p> <p>Cr\u00e9ation d'un volume logique vgdata <code>vgcreate vgdata /dev/sdb3</code></p> <p><code>lsblk</code> pour affihcer tout les volumes </p> <p>VG =&gt; Volume groupe</p> <ul> <li>L'extention de VG prends des volumes physiques <code>sudo vgextend vgdata /dev/sdb4</code></li> </ul> <p>LV =&gt; Logical Volume  - pour utiliser les commandes \u00e0 partir de PV.... , on parle de volume physique.</p> <p>PV =&gt; Physical volume</p>"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#commandes-pour-afficher-les-volumes","title":"Commandes pour afficher les volumes","text":"<ul> <li>pvscan</li> <li>lvscan</li> <li>pvscan</li> </ul>"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#suppression-des-volumes","title":"Suppression des volumes","text":"<p>La suppression des volumes entraine la suppression des donn\u00e9es stock\u00e9es sur le logical volume</p> <ul> <li>D\u00e9montage des volumes en premier : <code>unmount \\data</code></li> <li>Suppression du volume logique : <code>lvremove /dev/rootvg/lvdata</code></li> <li>Suppression du volume groupe : <code>vgremove /dev/rootvg</code></li> <li>Suppression des volumes physique : <code>pvremove /dev/sdb3 /dev/sdb4 /dev/sdb5</code></li> <li>Modification du fstab pour ne pas demarrer en mode recovery</li> </ul>"},{"location":"Linux/Bachelor/Partionnement/RAID/","title":"RAID","text":""},{"location":"Linux/Bachelor/Partionnement/RAID/#installation","title":"Installation","text":""},{"location":"Linux/Bachelor/Partionnement/RAID/#installation-via-ansible","title":"Installation via ansible","text":"<p>Installer ansible <code>apt install ansible</code></p> <p>Installation de mdadm : <code>ansible localhost -m package -a \"name=mdadm state=latest\"</code></p>"},{"location":"Linux/Bachelor/Partionnement/RAID/#creation-du-raid","title":"Cr\u00e9ation du raid","text":"<p>Mise en place du raid avec 1 disque manaquant (d'o\u00f9 l'option <code>missing</code>) : </p> <p><code>mdadm --create /dev/md0 --level 1 --raid-device 2 /dev/sdb6 missing</code></p> <p>Status du raid : <code>mdadm --detail /dev/md0</code></p> <p>Ajout d'un disque : <code>mdadm --manage /dev/md0 --add /dev/sdb7</code></p> <p>Disque HS : <code>mdadm /dev/md0 --fail /dev/sdb6</code></p> <p>Retirer le disque : <code>mdadm /dev/md0 --remove /dev/sdb6</code></p> <p>Montage de /data via ansible : <code>ansible localhost -m mount -a \"src=/dev/md0 path=/data state=mounted\"</code></p> <p>Recherche dans la doc <code>ansible-doc -l |grep -i --color filesystem</code></p> <p>Montage via l'UUID : <code>ansible localhost -m mount -a \"src= '-U 07684c31-dd62-45be-82bb-a72cae950930 name=/data fstype=ext4 state=present'\"</code></p> <p>formatage avec l'UUID : <code>ansible localhost -m filesystem -a \"dev=/dev/md0  fstype=ext4 state=present opts='-U 06b4a9c3-9487-4685-a672-d28b6df2b5f6'\"</code></p> <p>cible de anible playbook : <code>ansible-playbook make-filesystem.yml</code></p>"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/","title":"Deployment ansible","text":""},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#generation-des-cles-ssh","title":"G\u00e9n\u00e9ration des cl\u00e9s SSH","text":"<p>G\u00e9n\u00e9ration de la cl\u00e9 : <code>ssh-keygen</code></p> <p>Mise en place de la cl\u00e9 : <code>ssh-copy-id 127.0.0.1</code></p> <p>Demande une derni\u00e8re fois un mot de passe pour confirmer l'ajout</p> <p>Mise en place des privil\u00e8ges : <code>nano /etc/sudoers</code></p> <pre><code># User privilege specification\nroot    ALL=(ALL:ALL) NOPASSWD: ALL\n# Allow members of group sudo to execute any command\n%sudo   ALL=(ALL:ALL) NOPASSWD:  ALL\n</code></pre> <p>rajout de l'option NOPASSWD:</p>"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#test-ansible-ping","title":"Test ansible ping","text":"<p>Mise en place de l'inventaire : <code>echo \"debian-locale ansible_host=127.0.0.1\" &gt;&gt; inventaire.txt</code></p> <p>Dans le fichier <code>ansible.cfg</code>, ajout de redirecteurs :</p> <pre><code>[defaults]\n\ndeprecation_warnings=False //enl\u00e8vement des warnings\ninventory = inventaire.txt // redirecteur\n</code></pre> <p>Commande de ping : <code>ansible all -m ping -o</code></p>"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#boot-dune-machine","title":"Boot d'une machine","text":""},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#demarrage","title":"D\u00e9marrage","text":"<p>MBR : Master boot record</p> <p>Sous windows on utilise pas le bootloader. On va utiliser le premier secteur bootable sur le disque. (pas de programme d'ammorcage)</p> <p>RO = Read only dans les options de d\u00e9marrage </p> <p>D\u00e9marrage du syst\u00e8me :</p> <ul> <li> <p>Construction du syst\u00e8me de base </p> </li> <li> <p>D\u00e9marrage des services </p> </li> <li> <p>Lancements de taches dites \"supervis\u00e9e\" comme le lancement d'une session</p> </li> </ul> <p><code>Systemctl status</code> permet d'obtenir des informations globalement sur la machine et donne l'\u00e9tat g\u00e9n\u00e9ral de tout les services lanc\u00e9s avec ceux qui sont failed et running.</p> <p>Mise en place d'un /data avec <code>/etc/systemd/system/data.mount</code> :</p> <pre><code>[Unit]\n\n[Mount]\n\nWhat=UUID=915bcbeb-c17a-44e9-9e4f-beb8b79b724c\nWhere=/data\nType=ext4\nOptions=defaults\n</code></pre>"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#passage-avec-ansible","title":"Passage avec ansible","text":"<p>Mise en place de l'invetaire en yml avec <code>ansible-inventory -y --list</code> (option -y pour yaml/yml)</p> <p>Modification du fichier ansible.cfg pour int\u00e9grer l'invetaire en yml</p> <pre><code>[defaults]\n\ndeprecation_warnings=False //enl\u00e8vement des warnings\ninventory = inventaire.yml // redirecteur\n</code></pre>"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#timer","title":"Timer","text":"<p><code>sudo nano /etc/systemd/system/compteur.timer</code></p>"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#modifier-une-conf","title":"Modifier une conf","text":"<p><code>systemctl edit xx.socket</code></p>"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#logs","title":"Logs","text":""},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#mise-en-place-de-rsyslog-avec-envoi-de-msg-sur-un-autre-serveur","title":"Mise en place de rsyslog avec envoi de msg sur un autre serveur","text":"<ul> <li> <p>Installation du package rsyslog-relp avec apt.</p> </li> <li> <p>Modification de la conf de <code>/etc/rsyslog.conf</code> : <pre><code>module(load=\"omrelp\")\nmodule(load=\"immark\" interval=\"180\")\n\nlocal1.info    :omrelp:IP:PORT\n</code></pre></p> </li> <li> <p>envoi d'un msg <code>sudo logger -p local1.info -t \"tag-du-jour\" \"J'ai r\u00e9ussi \"</code></p> </li> </ul>"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#mise-en-place-avec-ansible","title":"Mise en place avec Ansible","text":"<p>Mise en place d'un dossier roles <code>mkdir roles</code></p> <p>Cr\u00e9ation des fichier li\u00e9s au roles <code>ansible-galaxy role init roles/rsyslog</code></p> <p>Fichier de configuration des tasks</p> <p><pre><code>---\n# tasks file for roles/rsyslog\n\n- name: maj derni\u00e8re version\n  apt:\n    name: \"*\"\n    state: latest\n\n- name: install Rsyslog\n  package:\n    name: rsyslog\n    state: latest\n\n- name: install Rsyslog_relp\n  package:\n    name: rsyslog-relp\n    state: latest\n\n- name: D\u00e9marrer et activer rsyslog\n  ansible.builtin.service:\n    name: \"{{ rsyslog_service }}\"\n    state: started\n    enabled: yes\n\n- name: Mise en place de la Config\n  template:\n    src: rsyslog_relp.j2\n    dest: \"/etc/rsyslog.d/rsyslog-relp.conf\"\n    owner: root\n    group: root\n    mode: \"0644\"\n  notify: restart-rsyslog\n</code></pre> Mise en place des des variables dans defaults :</p> <pre><code>relp_port: 0000\nrelp_server: 1.2.3.4\n</code></pre> <p>Configuration d'un template : </p> <pre><code>[Unit]\nDescription= Mise en place de RELP\n\n[Service]\n\nmodule(load=\"omrelp\")\nmodule(load=\"immark\" interval=\"180\")\n\n*.info      :omrelp:{{relp_server}}:{{relp_port}}\n</code></pre>"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#logs_1","title":"Logs","text":"<p>Plusieurs application de logs :</p> <ul> <li>journalctl</li> <li>rsyslog</li> </ul> <p>=&gt; Les configuruations de rsyslog permettent de pouvoir conserver des donn\u00e9es suivant le poids d'un fichier, le nombre de jours, ... </p>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/","title":"Installation de Centos","text":"<ul> <li>kickstart (redhat) = methode d'installation qui permet de faire passer les questions d'installation<ul> <li>utilisation avec la modification de l'ecran d'installation</li> </ul> </li> </ul>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#procedure","title":"Proc\u00e9dure","text":"<ul> <li>installation manuellement</li> <li>R\u00e9cuparation du fichier /rot/anaconda-ks.cfg --&gt; /srv/ks.cfg</li> <li>Mettre le fichier \u00e0 disposition avec un client http = conteneur docker</li> <li>Installation nouvelle VM avec l'utilisation du fichier KS <p>inst.ks=https://...../ks.cfg</p> </li> <li>si probl\u00e8me r\u00e9solution : inst.resolution=1080x1920</li> </ul>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#cahier-des-charges","title":"Cahier des charges","text":"<ul> <li>3 partitions :<ul> <li>/boot : 500Mo, format ext2</li> <li>Swap : 1Go</li> <li>Syst\u00e8me de fichier racine (/), ext4, 3 Go, mais sur du LVM, volume groupe = rootvg, volume logique = rootlv</li> </ul> </li> </ul>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#rappels","title":"Rappels","text":"<ul> <li>LVM : Logical Volume Manager</li> <li>PV : Physical volume </li> <li>VG : Volume Volume (prends l'int\u00e9gralit\u00e9 des PV)</li> <li>LG : Logical Volume (Volumes logiques cr\u00e9es sur le VG et permet d'utiliser des systemes de fichier diff\u00e9rents) exemples :<ul> <li>LV1 /leo (ext4)</li> <li>LV2 /data1 (EXT3)</li> <li>LV3 /data2 (EXT4)</li> </ul> </li> </ul> <p> Sch\u00e9ma de LVM</p> <p>Modification du nom de la machine</p> <p>Dans le fichier  <code>/etc/hostname</code>, on peux changer le nom ou avec la commande <code>hostname set-hostname nomdelamachine</code></p>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#installation-centos9","title":"Installation CENTOS9","text":"<ul> <li>Choix du clavier</li> <li>Mise en place du partitionnement</li> </ul>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#installation-docker","title":"Installation docker","text":"<p>Rappel sur docker</p> <p>Site de documentation docker : https://docs.docker.com</p> <p>Selon la firme de recherche sur l'industrie 451 Research, \u00ab Docker est un outil qui peut empaqueter une application et ses d\u00e9pendances dans un conteneur isol\u00e9, qui pourra \u00eatre ex\u00e9cut\u00e9 sur n'importe quel serveur \u00bb. Il ne s'agit pas de virtualisation, mais de conteneurisation, une forme plus l\u00e9g\u00e8re qui s'appuie sur certaines parties de la machine h\u00f4te pour son fonctionnement.</p> <ul> <li> <p>Copier le fichier ananconda</p> <ul> <li> <p>cp anaconda-ks.cfg /srv/kickstart/ks.cfg</p> </li> </ul> </li> <li> <p>installer docker avec CURL </p> <ul> <li> <p>curl -sSL https://get.docker.com | sudo bash</p> </li> </ul> <p>ou sinon : </p> <ul> <li> <p>curl -sSl -o get-docker.sh https://get.docker.com</p> </li> <li> <p>controle : get-docker.sh</p> </li> <li> <p>execution : bash get-docker.sh</p> </li> </ul> </li> <li> <p>Demarrage et automatisation de docker au boot</p> <ul> <li> <p>systemctl enable --now docker.service</p> </li> </ul> </li> <li> <p>D\u00e9marrage d'un conteneur de serveur web</p> <p>Apache - &gt; docker container run -d --name websrv --publish 80:80 --volume /srv/kickstart:/usr/local/apache2/htdocs  httpd</p> <p>Ngnix - &gt; docker container run -d --name websrv --publish 80:80  --volume /srv/kickstart:/usr/share/nginx/html  nginx</p> </li> <li> <p>Verficiation des user dans docker </p> <ul> <li> <p>docker container top websrv</p> </li> </ul> </li> <li> <p>Mise \u00e0 jour des permissions </p> <ul> <li> <p>chmod 644 /srv/kickstart/ks.cfg</p> </li> </ul> </li> <li> <p>Installation de micro </p> <ul> <li> <p>curl https://getmic.ro | bash</p> </li> <li> <p>mv micro /usr/local/bin</p> </li> <li> <p>ln -s /usr/local/bin/micro /usr/local/sbin/micro</p> </li> </ul> </li> <li> <p>Changement pour enlever le mot de passe de user</p> <ul> <li> <p>sed -i -e '/%wheel/s,,# ,' -e '/^# %wheel.*NOPASSWD/s,^# ,,' /etc/sudoers</p> <p>Le -i prend en compte pour l'execution</p> </li> </ul> </li> </ul>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#mise-en-place-de-lanaconda-pour-installer-dautres-machines","title":"Mise en place de l'anaconda pour installer d'autres machines","text":""},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#cahier-des-charges_1","title":"Cahier des charges","text":"<ul> <li>\"micro\" doit etre install\u00e9 dans /usr/local/bin</li> <li>Lien symbolique dans /usr/local/bin </li> <li>User n'a pas \u00e0 s'identifier pour sudo ... No PASSWD</li> <li>On ne peut se connecter en trannt que \"user\" avec une cl\u00e9 punlique definie ici</li> </ul>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#extention-du-volume-groupe","title":"Extention du volume groupe","text":"<ul> <li>Cr\u00e9ation du volume dans le sdb</li> </ul> <p>pvcreate /dev/sdb</p> <ul> <li>Extentention du volume groupe sur le nouveau disque</li> </ul> <p>vgextend /dev/rootvg /dev/sdb</p> <ul> <li>Extention du volume logique </li> </ul> <p>lvextend -l 100%FREE -r /dev/rootvg/rootlv</p>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#modification-du-ssh","title":"modification du SSH","text":"<ul> <li>Cr\u00e9ation des dossier ssh (/.ssh/authorized_keys)</li> </ul> <p>.ssh avec les droits 700</p> <p>authorized_keys avec les droits 600</p> <p>Exemple de fichier anaconda :</p> <pre><code># Generated by Anaconda 34.25.2.2\n# Generated by pykickstart v3.32\n#version=RHEL9\n# Use graphical install\ngraphical\nrepo --name=\"AppStream\" --baseurl=file:///run/install/sources/mount-0000-cdrom/AppStream\n\n%addon com_redhat_kdump --enable --reserve-mb='auto'\n\n%end\n\n# Keyboard layouts\nkeyboard --xlayouts='fr (oss)'\n# System language\nlang fr_FR.UTF-8\n\n# Network information\nnetwork  --hostname=LG-stream9-1.local\n\n# Use CDROM installation media\ncdrom\n\n%packages\n@^minimal-environment\n\n%end\n\n# Run the Setup Agent on first boot\nfirstboot --enable\n\n# Generated using Blivet version 3.6.0\nignoredisk --only-use=sda\n# Partition clearing information\nclearpart --none --initlabel\n# Disk partitioning information\npart pv.1220 --fstype=\"lvmpv\" --ondisk=sda --size=7690\npart /boot/efi --fstype=\"efi\" --ondisk=sda --size=1024 --fsoptions=\"umask=0077,shortname=winnt\"\npart swap --fstype=\"swap\" --ondisk=sda --size=1024\npart /boot --fstype=\"ext2\" --ondisk=sda --size=500\nvolgroup rootvg --pesize=4096 pv.1220\nlogvol / --fstype=\"ext4\" --size=3072 --name=rootlv --vgname=rootvg\n\n# System timezone\ntimezone Europe/Paris --utc\n\n# Root password\nrootpw --iscrypted --allow-ssh $6$2y5hbbXM4dYt4c0v$usoQguNqD5QySTU5sbwDHMPuHU4tBs0mwPqUU574s83Vr1Tz5aJ//zIwtIEPdqsaTwpiBDQwnT.LQ/9PMC95o.\nuser --groups=wheel --name=user --password=$6$IW2fEdwd1zcdKMCW$ecnGuYPR.PvRDy354ttoEJbnYuFHJm9HpAA6ZT2sHF2sqGEsHWnvnAYdvr6EdVFipZKkjchbaQOMyRERyZAR91 --iscrypted --gecos=\"user\"\n</code></pre>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#debian","title":"Debian","text":"<ul> <li>Preseed (debian) = methode d'installation qui permet de faire passer les questions d'installation</li> </ul>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/","title":"Programme du jour","text":"<ul> <li>Manipuler rpm et yum</li> <li>Compiler un logiciel libre (\u00e0 partir des sources)</li> <li>Cr\u00e9er un pakcage RPM</li> <li>Cr\u00e9er un d\u00e9p\u00f4t pour mettre \u00e0 dispo mes packages</li> <li>D\u00e9clarer mon d\u00e9p\u00f4t sur les pc clients</li> </ul>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#manipuler-rpm-et-yum","title":"Manipuler rpm et yum","text":""},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#rpm","title":"RPM","text":"<p>RPM : commande pour manipuler des package et savoir les informations sur ceux-ci</p> <ul> <li> <p>Options :</p> </li> <li> <p>-q query =&gt; Information de version</p> </li> <li>-qi =&gt; descriptif sur le paquage</li> <li>-qa =&gt; liste de tout les paquages install\u00e9s</li> <li>-ql =&gt; liste des fihcier install\u00e9 le paquet</li> <li>-qc =&gt; Liste des fihciers de config</li> <li>-qd =&gt; Liste des fichiers de docs</li> <li>-qf =&gt; savoir quel fichier \u00e0 install\u00e9 le package</li> <li>--requires (-R) =&gt; savoir les paquages dont il a besoin</li> <li>--provides (-P) =&gt; d\u00e9pendances pour qui ?</li> <li>--scripts =&gt; fichier spec avec les scripts de d\u00e9sinstall, install, preinstall</li> </ul>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#yum","title":"YUM","text":"<p>Yum : surcouche de rpm </p> <p>DNF = reprise de yum qui etait sur python 2.3</p> <p>Options :</p> <ul> <li>install</li> <li>update</li> <li>upgrade (attention cela peut remplacer des paquets)</li> <li>remove </li> <li>list (liste tout les paquets)</li> <li>search (liste les paquets avec par exemple http dans les descriptions)</li> <li>provides</li> </ul> <p>Extraire une archive</p> <ul> <li>test de l'archive</li> </ul> <pre><code>tar -tvzf ARCHIVE | tail\n</code></pre> <p>options : - t pour tester ou lister (--list) - v versbose - f file - z compression - x pour extraire</p> <p>Le tail est utilis\u00e9 pour etre sur que tout les fichiers soient dans le meme dossier racine </p> <ul> <li>Extraction </li> </ul> <pre><code>tar -xvzf ARCHIVE\n</code></pre>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#verification-des-signatures-gpg","title":"Verification des signatures GPG :","text":"<p>Importer la cl\u00e9 avec WGET : <pre><code>wget https://download.samba.org/pub/rsync/src/rsync-3.2.7.tar.gz.asc\n</code></pre></p> <p>Verification de la signature :  <pre><code>gpg --verify rsync-3.2.7.tar.gz.asc\n</code></pre> </p> <p>Copie de la cl\u00e9 pour enregistrer la cl\u00e9 via un serveur de cl\u00e9s</p> <p></p> <pre><code> gpg  --receive-keys  0048C8B026D4C96F0E589C2F6C859FB14B96A8C5\n</code></pre> <p>V\u00e9rifier \u00e0 nouveau la cl\u00e9</p> <p></p>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#paquet-rsync","title":"Paquet rsync","text":"<p>Erreurs lors de la configuration </p> <p></p> <p>Installation de GCC compilateur C </p> <pre><code>dnf -y install gcc\n</code></pre> <p>Nouvelle erreur lors de la configuration : </p> <p></p> <p>On cherche les paquets openssl :</p> <pre><code>yum provides \"*/openssl/md4.h\"\n</code></pre> <p>On trouve ensuite les paquets openssl-devel</p> <pre><code>dnf -y install gcc openssl-devel\n</code></pre> <p>On retrouve plusieurs erreurs suppl\u00e9mentaires </p> <ul> <li>zstd</li> <li>lz4</li> <li>xxhash</li> </ul> <p>Pour xxhash on va sur le site https://pkgs.org et on cherche un paquet qui se rapporte xxhash-devel</p> <p>On trouve le repo CRB :</p> <p></p> <p>Commande compl\u00e8te avec tout les arguments :</p> <pre><code>dnf  --enablerepo=\"crb\" -y install gcc openssl-devel lz4-devel libzstd-devel xxhash-devel\n</code></pre> <p>On retrouve ensuite le code retour avec la configuration termin\u00e9e :</p> <p></p> <p>epel-release permet d'aller chercher des paquets qui ne sont pas soutenu par REDHAT mais par une autre communaut\u00e9 comme la communaut\u00e9 FEDORA</p> <p>Petite astuce pour savoir le nombre de coeur : </p> <p>grep -c ^processor /proc/cpuinfo</p>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#rpm-build","title":"RPM build","text":""},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#package-rsync-non-vide","title":"Package rsync (non vide)","text":"<p>3 options :</p> <ul> <li>b pour partir d'un fichier spec</li> <li>r pour partir d'un fichier sources package</li> <li>t pour partir d\"un tarball</li> </ul> <p>On build avec RPM :</p> <pre><code> rpmbuild -tb rsync-3.y.z.tar.gz\n</code></pre> <p>Exemple du fichier SPEC modifi\u00e9 :</p> <p></p> <p>Attention, le %files n'accepte pas les doubles fichiers sur la m\u00eame ligne :</p> <p></p> <p>RPM -ivh (v pour verbose ; h pour la barre de progressions)</p>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#package-rsync-vide","title":"Package rsync (vide)","text":"<p>Installation de rpmdev :</p> <pre><code>dnf -y install rpmdevtools\n</code></pre> <p>Cr\u00e9ation du fichier (--output pour set le nom et l'endoit du fichier) :</p> <pre><code>rpmdev-newspec --type minimal --output rpmbuild/SPECS/vide.spec\n</code></pre> <p></p> <p>Modification du fichier SPEC :</p> <p></p>"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#creation-dun-repo","title":"Cr\u00e9ation d'un repo","text":"<p>Installation de la commande createrepo :  <pre><code>dnf install creatrepo_c\n</code></pre></p> <p>Installation du repo :</p> <pre><code>Createrepo rpmbuild/RPMS\n</code></pre> <p></p> <p>Lancement d'un conteneur docker en restart always :</p> <pre><code>docker container run -d --name repo --publish 8001:80 --volume /root/rpmbuild/RPMS/:/usr/local/apache2/htdocs --restart always httpd\n</code></pre> <p>Cr\u00e9er le fichier /etc/yum.repos.d/mondepot.repo <pre><code>[mondepot]\nname=Mon beau d\u00e9pot\nbaseurl=http://IP:8001\n</code></pre></p>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/DNS/","title":"Les DNS","text":"<p>Objectifs</p> <ul> <li> <p>D\u00e9clarer le serveur DNS</p> </li> <li> <p>Etre un salve d'un autre serveur</p> </li> </ul> <p>Pour la r\u00e9solution de noms DNS, la commande <code>getent</code> est pr\u00e9sente sur les syst\u00e8mes linux. </p>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/DNS/#bind","title":"Bind","text":"<p>Installation de bind :</p> <pre><code>dnf install -y bind\n</code></pre> <p>Observation des nouvelles installations :</p> <pre><code>rpm -ql bind | grep /etc/\n</code></pre> <p>Mise en place de l'ecoute sur l'ip \"publique\" dans <code>/etc/named.conf</code> :</p> <pre><code>options {\nlisten-on port 53 { 127.0.0.1; 10.56.126.223};\nlisten-on-v6 port 53 { ::1; };\ndirectory       \"/var/named\";\ndump-file       \"/var/named/data/cache_dump.db\";\nstatistics-file \"/var/named/data/named_stats.txt\";\nmemstatistics-file \"/var/named/data/named_mem_stats.txt\";\nsecroots-file   \"/var/named/data/named.secroots\";\nrecursing-file  \"/var/named/data/named.recursing\";\nallow-query     { localhost; };\n\n/*\n         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.\n         - If you are building a RECURSIVE (caching) DNS server, you need to enable\nrecursion.\n         - If your recursive DNS server has a public IP address, you MUST enable access\n           control to limit queries to your legitimate users. Failing to do so will\n           cause your server to become part of large scale DNS amplification\n           attacks. Implementing BCP38 within your network would greatly\n           reduce such attack surface\n        */\n        recursion yes;\n\ndnssec-validation yes;\n\nmanaged-keys-directory \"/var/named/dynamic\";\ngeoip-directory \"/usr/share/GeoIP\";\n\npid-file \"/run/named/named.pid\";\nsession-keyfile \"/run/named/session.key\";\n\n/* https://fedoraproject.org/wiki/Changes/CryptoPolicy */\n        include \"/etc/crypto-policies/back-ends/bind.config\";\n};\n\nlogging {\nchannel default_debug {\nfile \"data/named.run\";\nseverity dynamic;\n};\n};\nzone \".\" IN {\ntype hint;\nfile \"named.ca\";\n};\n\ninclude \"/etc/named.rfc1912.zones\";\ninclude \"/etc/named.root.key\";\n</code></pre> <p>Ajout d'une ACL que l'on pourra r\u00e9utiliser : </p> <pre><code>acl mes-clients {\n10.56.126.0/24;\n};\n</code></pre> <p>Ajout de mes-clients sur la ligne suivante: </p> <pre><code>allow-query     { localhost; mes-clients; };\n</code></pre> <p>Ajout d'une zone avec la cr\u00e9ation d'un fichier dans <code>/etc/named/mes-domaines.conf</code> :</p> <pre><code>zone \"dom3.local. \"{\ntype master;\nfile \"dynamic/dom3.local.zone\";\n};\n</code></pre> <p>Pour que le fichier soit lu par named, on lui indique le chemin complet dans sont fichier de configuration <code>etc/named.conf</code> :</p> <pre><code>include \"/etc/named/mes-domaines.conf\";\n</code></pre> <p>Configuration de la zone dans <code>/var/named/dynamic/dom3.local.zone</code> :</p> <pre><code>$TTL 3600\n@       IN      SOA     dns1 leoguilloux.yahoo.com. (\n2023021401 ; Serial\n                        3600       ; Refresh\n                        1800       ; Retry\n                        604800     ; Expire\n                        86400 )    ; Minimum TTL\n@       NS      dns1\ndns1    A       10.56.126.223\n</code></pre> <p>Ports ouverts sur une machine</p> <pre><code>ss -plntu\n</code></pre> <p>Pour que une machine cliente puisse ping l'exterieur, on lui met une route par d\u00e9faut passant par la gateway.</p> <p>Sur le routeur, on lui change l'interface dans la zone external :</p> <pre><code>firewall-cmd --zone=external --add-interface=eth2 --permanent\n</code></pre> <p>On red\u00e9marre le service avec :</p> <pre><code>systemctl restart firewalld\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/","title":"LDAP","text":""},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#definition","title":"D\u00e9finition","text":"<p>LDAP est l'abr\u00e9viation de Lightweight Directory Access Protocol (protocole l\u00e9ger d'acc\u00e8s \u00e0 un annuaire). C'est un protocole de communication utilis\u00e9 pour acc\u00e9der \u00e0 des annuaires en ligne, qui sont des bases de donn\u00e9es contenant des informations sur des utilisateurs, des groupes, des ordinateurs et d'autres ressources r\u00e9seau.</p> <p>LDAP permet aux clients d'acc\u00e9der \u00e0 ces annuaires pour effectuer des op\u00e9rations telles que la recherche, la lecture, la mise \u00e0 jour et la suppression de donn\u00e9es. Les annuaires LDAP sont utilis\u00e9s dans de nombreuses applications, notamment pour la gestion des utilisateurs et des groupes, l'authentification et l'autorisation, la messagerie \u00e9lectronique, la voix sur IP, et bien d'autres.</p> <p>LDAP utilise un mod\u00e8le client-serveur et repose sur un ensemble de r\u00e8gles et de sp\u00e9cifications d\u00e9finies par l'Internet Engineering Task Force (IETF). Il est consid\u00e9r\u00e9 comme un protocole efficace et s\u00fbr pour la gestion de donn\u00e9es d'annuaire \u00e0 grande \u00e9chelle.</p>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#decouverte-et-parametrages","title":"D\u00e9couverte et param\u00e9trages","text":"<p>Recherche dans les schemas :</p> <pre><code>grep -rni --color PosixAccount /etc/openldap/schema/\n</code></pre> <p>Affichage des lignes de 161 \u00e0 180 du fichier <code>nis.schema</code> :</p> <pre><code>objectclass ( 1.3.6.1.1.1.2.0 NAME 'posixAccount'\nDESC 'Abstraction of an account with POSIX attributes'\nSUP top AUXILIARY\n        MUST ( cn $ uid $ uidNumber $ gidNumber $ homeDirectory )\nMAY ( userPassword $ loginShell $ gecos $ description ) )\n\nobjectclass ( 1.3.6.1.1.1.2.1 NAME 'shadowAccount'\nDESC 'Additional attributes for shadow passwords'\nSUP top AUXILIARY\n        MUST uid\n        MAY ( userPassword $ shadowLastChange $ shadowMin $\n              shadowMax $ shadowWarning $ shadowInactive $\n              shadowExpire $ shadowFlag $ description ) )\n\nobjectclass ( 1.3.6.1.1.1.2.2 NAME 'posixGroup'\nDESC 'Abstraction of a group of accounts'\nSUP top STRUCTURAL\n        MUST ( cn $ gidNumber )\nMAY ( userPassword $ memberUid $ description ) )\n</code></pre> <p>1 objet rentr\u00e9 dans l'annuaire doit obliatoirement avoir une classe structurale.</p> <p>La classe Account se situe dans le fichier <code>cosine.schema</code> et cette classe est une classe Structurale :</p> <pre><code>objectclass ( 0.9.2342.19200300.100.4.5 NAME 'account'\nSUP top STRUCTURAL\n        MUST userid\n        MAY ( description $ seeAlso $ localityName $\n                organizationName $ organizationalUnitName $ host )\n)\n</code></pre> <p>D\u00e9marrage de ldap :</p> <pre><code>systemctl start slapd\n</code></pre> <p>Plusieurs LDAP :</p> <ul> <li>Ldapi : Connexion avec le socket UNIX (locale)</li> <li>Ldaps : connexion avec des certficats (utlis\u00e9 par des clients TLS)</li> <li>Ldap : connexion simple sans certificats (tuilis\u00e9 par des clients non TLS)</li> </ul> <p>Les commandes ldapwhoami permettent de tester l'acc\u00e8s \u00e0 un annuaire.</p> <p>Recherche et connexion dans l'annuaire avec connexion :</p> <pre><code>ldapsearch -Y EXTERNAL -H ldapi:/// -Q  -b CN=config\n</code></pre> <p>Options de filtres ( attention pas d'op\u00e9rateur &lt; ou &gt; (op\u00e9ratuers strictes) ) :</p> <ul> <li><code>=</code>(\u00e9gal)</li> <li><code>*</code>: joker</li> <li><code>&lt;=</code> (plus petit ou \u00e9gal)</li> <li><code>&gt;=</code> (plus grand ou \u00e9gal)</li> <li><code>~=</code>(approximation)</li> </ul> <p>Recherche port\u00e9e avec scope <code>-s</code> et ses options :</p> <ul> <li>base (uniquement la base)</li> <li>sub (\u00e0 partir de la base sur la totalit\u00e9 de la base)</li> <li>one (fils directs)</li> </ul> <p>ldapmodify utlise un sch\u00e9ma pour la modification :</p> <ul> <li>le DN,<ul> <li>le type d'op\u00e9ration r\u00e9alis\u00e9e,</li> <li>changetype: add : pour ajouter une entr\u00e9e</li> <li>changetype: delete : pour supprimer une entr\u00e9e</li> <li>changetype: modify : pour modifier une entr\u00e9e d\u00e9j\u00e0 pr\u00e9sente<ul> <li>La ligne du dessous mentionne alors le type de modification :</li> <li>add : attribut</li> <li>delete : attribut</li> <li>replace : attribut<ul> <li>La ligne du dessous donne alors la nouvelle valeur de l'attribut</li> </ul> </li> </ul> </li> </ul> </li> </ul> <p>Cr\u00e9ation d'un fichier pour modifier le mot de passe root :</p> <pre><code>dn: olcDatabase={2}mdb,cn=config\nchangetype: modify\nreplace: olcRootPW\nolcRootPW: secret\n</code></pre> <p>Application de la modification : </p> <p><pre><code>ldapmodify -Y EXTERNAL -H ldapi:/// -Q -f modif-rootpw.ldif\n</code></pre> Observation de la modification avec la commande <code>ldapsearch -Y EXTERNAL -H ldapi:/// -Q -LLL -b 'olcDatabase={2}mdb,cn=config'</code> : </p> <pre><code>dn: olcDatabase={2}mdb,cn=config\nobjectClass: olcDatabaseConfig\nobjectClass: olcMdbConfig\nolcDatabase: {2}mdb\nolcDbDirectory: /var/lib/ldap\nolcSuffix: dc=my-domain,dc=com\nolcRootDN: cn=Manager,dc=my-domain,dc=com\nolcDbIndex: objectClass eq,pres\nolcDbIndex: ou,cn,mail,surname,givenname eq,pres,sub\nolcRootPW: secret\n</code></pre> <p>Pour obtenir un mot de passe chiffr\u00e9, on utilise <code>slappasswd</code>.</p> <p>Saut de ligne<p>Dans les diff\u00e9rents \u00e9diteurs, ceux-ci enregisre un saut de ligne qui est interpr\u00e9t\u00e9 par ldap (ex: mot de passe de 6 caract\u00e8res comptera sur 7). Cela se suprrime avec la commande : <pre><code>echo -n secret &gt; .ldappass\n</code></pre></p> </p>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#realisation-du-travail","title":"R\u00e9alisation du travail","text":"<p>Travail \u00e0 r\u00e9aliser<ul> <li> On cherche \u00e0 cr\u00e9er une organisation \"mon domaine domX.local\" (entr\u00e9e d'annuaire \"organization\")<ul> <li> Cr\u00e9ation d'une OU \"users\" (entr\u00e9e d'annuaire : organizationUnit\")<ul> <li> Ajout d'une entr\u00e9e bas\u00e9e sur posixAccount : \"ldapuser1\"</li> </ul> </li> <li> Cr\u00e9ation d'une OU \"groups\" (entr\u00e9e d'annuaire : organizationUnit\")<ul> <li> Ajout d'une entr\u00e9e bas\u00e9e sur posixGroup : \"ldapgroup1\"</li> </ul> </li> </ul> </li> </ul> </p>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#creation-dune-organisation-avec-la-creation-dun-fichier-orgldif","title":"Cr\u00e9ation d'une organisation avec la cr\u00e9ation d'un fichier <code>org.ldif</code>","text":"<pre><code>dn: dc=dom3,dc=local\nobjectClass: organization\nobjectClass: dcObject\no: Mon domaine dom0.local\n</code></pre> <p>On ajout l'organistaion avec :</p> <pre><code>ldapadd -D cn=leo,dc=dom3,dc=local -y ~/.ldappass -f org.ldif -c\n</code></pre> <p>Info<p>L'option <code>-c</code> permet de continuer si des lignes provoquent des erreurs</p> </p> <p>Dans la suite des travaux, nous continurons dans le fichier <code>org.ldif</code>.</p>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#creation-dune-ou-users","title":"Cr\u00e9ation d'une OU \"users\"","text":"<pre><code>dn: ou=users,dc=dom3,dc=local\nobjectClass: organizationalUnit\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#ajout-dun-utilisateur-ldapuser1","title":"Ajout d'un utilisateur <code>ldapuser1</code>","text":"<p>Ajout du sch\u00e9ma inetorgperson :</p> <pre><code>ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif\n</code></pre> <p>Ajout de l'utilisateur ici dans <code>groups</code>:</p> <pre><code>dn: cn=ldapuser1,ou=groups,dc=dom3,dc=local\nobjectClass: posixAccount\nobjectClass: inetOrgPerson\ncn: Youzer Un\ngn: Youzer\nsn: Un\nuid: ldpauser1\nuidNumber: 10001\ngidNumber: 10000\nhomeDirectory: /home/ldapuser1\n</code></pre> <p>Ajout d'utilisateur ici dans <code>users</code> :</p> <pre><code>dn: cn=ldapuser1,ou=users,dc=dom3,dc=local\nobjectClass: posixAccount\nobjectClass: inetOrgPerson\ncn: Youzer Un\ngn: Youzer\nsn: Un\nuid: ldapuser1\nuidNumber: 10001\ngidNumber: 10000\nhomeDirectory: /home/ldapuser1\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#creation-dune-ou-groups","title":"Cr\u00e9ation d'une OU \"groups\"","text":"<pre><code>dn: ou=groups,dc=dom3,dc=local\nobjectClass: organizationalUnit\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#ajout-dun-groupe-ldapgroup1","title":"Ajout d'un groupe <code>ldapgroup1</code>","text":"<p>On cherche dans les sch\u00e9mas les r\u00e9f\u00e9rences \u00e0 posixGroup :</p> <pre><code>grep -rni --color PosixGroup /etc/openldap/schema/\n</code></pre> <p>On retrouve dans le fichier <code>nis.schema</code> que l'identifiant est gidnumber. </p> <p>On ajoute le schema nis.ldif :</p> <pre><code>ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif\n</code></pre> <p>On cherche l'erreur suivante sur les <code>manager</code> que l'on trouve dans cosine.schema. On ajoute ensuite le fichier ldif :</p> <pre><code>ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif\n</code></pre> <p>Si il y a des erreurs, il faut int\u00e9grer les fichier dans l'ordre <code>nis.ldif</code> puis <code>cosine.ldif</code>.</p> <p>Code d\u00e9finitif pour la cr\u00e9ation :</p> <pre><code>dn: cn=ldapgroupe1,ou=groups,dc=dom3,dc=local\nobjectClass: posixGroup\ngidNumber: 10000\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#pam","title":"PAM","text":"<p>PAM permet d'authentifier des utilisateurs en utilisant LDAP.</p> <p>On cherche les fichiers de PAM avec <code>/etc/pam.d/</code>.</p> <p>Le fichier <code>other</code> est pr\u00e9sent lorsque aucun fichier du nom du programme existe.</p> <p>Pour voir si un programme d\u00e9pend de pam ou tout autre programme, on utilise <code>ldd</code>. Par exemple pour passwd, on obtient :</p> <pre><code>        linux-vdso.so.1 (0x00007ffcf63ec000)\nlibuser.so.1 =&gt; /lib64/libuser.so.1 (0x00007ff80b72f000)\nlibgobject-2.0.so.0 =&gt; /lib64/libgobject-2.0.so.0 (0x00007ff80b6d4000)\nlibglib-2.0.so.0 =&gt; /lib64/libglib-2.0.so.0 (0x00007ff80b59a000)\nlibpopt.so.0 =&gt; /lib64/libpopt.so.0 (0x00007ff80b58b000)\nlibpam.so.0 =&gt; /lib64/libpam.so.0 (0x00007ff80b579000)\nlibpam_misc.so.0 =&gt; /lib64/libpam_misc.so.0 (0x00007ff80b573000)\nlibaudit.so.1 =&gt; /lib64/libaudit.so.1 (0x00007ff80b543000)\nlibselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007ff80b516000)\nlibc.so.6 =&gt; /lib64/libc.so.6 (0x00007ff80b200000)\nlibgmodule-2.0.so.0 =&gt; /lib64/libgmodule-2.0.so.0 (0x00007ff80b510000)\nlibcrypt.so.2 =&gt; /lib64/libcrypt.so.2 (0x00007ff80b4d6000)\nlibffi.so.8 =&gt; /lib64/libffi.so.8 (0x00007ff80b4ca000)\nlibpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007ff80b450000)\nlibeconf.so.0 =&gt; /lib64/libeconf.so.0 (0x00007ff80b445000)\nlibm.so.6 =&gt; /lib64/libm.so.6 (0x00007ff80b125000)\nlibcap-ng.so.0 =&gt; /lib64/libcap-ng.so.0 (0x00007ff80b43c000)\nlibpcre2-8.so.0 =&gt; /lib64/libpcre2-8.so.0 (0x00007ff80b089000)\n/lib64/ld-linux-x86-64.so.2 (0x00007ff80b762000)\n</code></pre> <p>On observe ligne 6, que le programme n\u00e9c\u00e9ssite PAM pour focntionner.</p> <p>Pour l'authentification, le fichier de PAM <code>/etc/pam.d/system_auth</code> pr\u00e9sente les r\u00e8gles d'authentifications.</p> <pre><code>auth        required      pam_env.so\nauth        sufficient    pam_unix.so try_first_pass nullok\nauth        required      pam_deny.so\n</code></pre> <p>Note<p>PAM est appel\u00e9 pour le login et ne donnera jamais l'\u00e9l\u00e9ment qui \u00e0 \u00e9chou\u00e9. </p> </p> <p>Chez PAM, plusieurs strat\u00e9gies sont pr\u00e9d\u00e9finies :</p> <ul> <li>Required : R\u00e9ussir le module est n\u00e9cessaire, on annoncera une erreur \u00e0 la fin du traitement uniquement si 1 des modules \"required\" \u00e9choue.</li> <li>Requisite : R\u00e9ussir le module est n\u00e9cessaire : la premi\u00e8re erreur (on annoncera laquelle) est synonyme d'abandon</li> <li>Sufficient : La r\u00e9ussite du module est suffisante pour que l'on valide le contexte. On ne fait pas l'analyse des modules qui suivent (m\u00eame required ou requisite) dans le contexte</li> <li>Optional : La r\u00e9ussite d'un module optional est n\u00e9cessaire si les autres sont ignor\u00e9s. Le module n'est pas appel\u00e9 si un autre module r\u00e9ussit ou \u00e9choue</li> <li>Include : sert \u00e0 brancher vers un sous-fichier de r\u00e8gles PAM</li> </ul>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#sssd","title":"SSSD","text":"<p>Pourquoi utiliser SSHD ? Car SSHD est plus r\u00e9cent que PAM pour LDAP.</p> <p>Installation des packages SSHD :</p> <pre><code>dnf -y install sssd sssd-ldap sssd-tools oddjob oddjob-mkhomedir\n</code></pre> <p>D\u00e9marrage du service :</p> <pre><code>systemctl enable --now oddjobd.service\n</code></pre> <p>Authselect permet de configurer des profils d'authentifications.</p> <p>Nous pouvons lister les profils avec <code>authselect list</code> :</p> <pre><code>- minimal        Local users only for minimal installations\n- sssd           Enable SSSD for system authentication (also for local users only)\n- winbind        Enable winbind for system authentication\n</code></pre> <p>Configuration de PAM avec SSHD :</p> <pre><code>authselect select --force sssd with-mkhomedir\n</code></pre> <p>Si on regarde maintenant le fichier de pam <code>system_auth</code> :</p> <pre><code>auth        required                                     pam_env.so\nauth        required                                     pam_faildelay.so delay=2000000\nauth        [default=1 ignore=ignore success=ok]         pam_usertype.so isregular\nauth        [default=1 ignore=ignore success=ok]         pam_localuser.so\nauth        sufficient                                   pam_unix.so nullok\nauth        [default=1 ignore=ignore success=ok]         pam_usertype.so isregular\nauth        sufficient                                   pam_sss.so forward_pass\nauth        required                                     pam_deny.so\n</code></pre> <p>On observe de nouvelles lignes qui se sont ajout\u00e9es dans le fichier avec des param\u00e8tres suppl\u00e9mentaires.</p>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#configuration-de-sss","title":"Configuration de SSS","text":"<p>Ajout d'un fichier de configuration <code>/etc/sssd/sssd.conf</code> :</p> <pre><code>[sssd]\nservices = nss, pam\ndomains = dom3.local\n\n[nss]\nfilter_users = root\nfilter_groups = root\n\n[domain/dom3.local]\ncache_credentials = true\nid_provider = ldap\nauth_provider = ldap\nldap_uri = ldap://10.56.126.220\n#ldap_tls_reqcert = demand\nldap_search_base = dc=dom3,dc=local\nldap_user_search_base = ou=users,dc=dom3,dc=local\nldap_groups_search_base = ou=groups,dc=dom3,dc=local\n\n[pam]\noffline_credentials_expiration = 1\noffline_failed_login_attempts = 3\noffline_failed_login_delay = 5\n</code></pre> <p>Modification des droits en 600 :</p> <pre><code>chmod 600 /etc/sssd/sssd.conf\n</code></pre> <p>D\u00e9marrage du service SSSD qui n\u00e9c\u00e9ssitait un fichier de configuration :</p> <pre><code>systemctl restart sssd\n</code></pre> <p>On verifie la connexion avec <code>sssctl user-checks ldapuser1</code> (ici un extrait du message retour):</p> <p><pre><code>user: ldapuser1\naction: acct\nservice: system-auth\n\nSSSD nss user lookup result:\n - user name: ldapuser1\n - user id: 10001\n- group id: 10000\n- gecos: Youzer Un\n - home directory: /home/ldapuser1\n - shell:\n</code></pre> Verficiation aussi avec <code>id ldapuser1</code> :</p> <pre><code>uid=10001(ldapuser1) gid=10000(ldapgroupe1) groupes=10000(ldapgroupe1)\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#certification-avec-tls","title":"Certification avec TLS","text":""},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#certificat-auto-signe","title":"Certificat auto-sign\u00e9","text":"<p>Cr\u00e9ation d'un dossier avec des droits personnalis\u00e9s sur le serveur :</p> <pre><code>install -d -m 2750 -o root -g ldap /etc/openldap/certs\n</code></pre> <p>Cr\u00e9ation des documents <code>ca.pem</code> et <code>ca-key.pem</code> :</p> <pre><code>openssl req \\\n-newkey rsa:4096 -nodes -keyout /etc/openldap/certs/ca-key.pem \\\n-subj '/countryName=FR/stateOrProvinceName=Bretagne/organizationName=Actilis/CN=CA-LDAP/' \\\n-x509 -sha256 -days 365 \\\n-extensions v3_ca \\\n-out /etc/openldap/certs/ca.pem\n</code></pre> <p>Ajout des droits sur le fichier <code>ca.pem</code> :</p> <pre><code>chmod 444 /etc/openldap/certs/ca.pem\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#certificat-serveur","title":"Certificat serveur","text":"<p>Cr\u00e9ation des fichiers <code>server.csr</code> et <code>key.pem</code> :</p> <pre><code>openssl req \\\n-newkey rsa:4096 -nodes -keyout /etc/openldap/certs/key.pem \\\n-subj '/CN=dom3.local/' \\\n-out server.csr\n</code></pre> <p>Ajout des permissions :</p> <pre><code>chmod 440 /etc/openldap/certs/key.pem\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#tamponnage-du-fichier","title":"Tamponnage du fichier","text":"<pre><code>openssl x509 -req -days 365 -sha256 -in server.csr -out /etc/openldap/certs/cert.pem \\\n-CA /etc/openldap/certs/ca.pem -CAkey /etc/openldap/certs/ca-key.pem -CAcreateserial \\\n-extfile &lt;(printf \"basicConstraints = CA:FALSE\\n subjectAltName=IP:127.0.0.1,IP:10.56.126.220,DNS:ldap.dom3.local\")\n</code></pre> <p>Verifications du certificat :</p> <pre><code>openssl x509 -noout -subject &lt; /etc/openldap/certs/cert.pem\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/LDAP/#integration-des-configurations","title":"Int\u00e9gration des configurations","text":"<p>Ajouter un fichier tls.ldif :</p> <pre><code>dn: cn=config\nchangetype: modify\nreplace: olcTLSCACertificateFile\nolcTLSCACertificateFile: /etc/openldap/certs/ca.pem\n-\nreplace: olcTLSCertificateFile\nolcTLSCertificateFile: /etc/openldap/certs/cert.pem\n-\nreplace: olcTLSCertificateKeyFile\nolcTLSCertificateKeyFile: /etc/openldap/certs/key.pem\n</code></pre> <p>Ajout de la configuration avec <code>ldapmodify</code> :</p> <pre><code>ldapmodify -Y EXTERNAL -H ldapi:/// &lt; tls.ldif\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/NMCLI/","title":"Configuration r\u00e9seau","text":""},{"location":"Linux/Master/Administration%20r%C3%A9seau/NMCLI/#configuration-dune-ip-fixe-avec-nmcli","title":"Configuration d'une IP fixe avec nmcli","text":"<p>Info</p> <p>nmcli est un outil qui permet de g\u00e9rer la configuration r\u00e9seau en interagissant avec le deamon NetworkManager. nmcli est utilis\u00e9 pour cr\u00e9er, afficher, modifier, supprimer, activer et d\u00e9sactiver les connexions r\u00e9seau, ainsi que pour contr\u00f4ler et afficher l'\u00e9tat des p\u00e9riph\u00e9riques r\u00e9seau.</p> <p>Pour ajouter une IP fixe, nmcli propose une gestion de profile permettant d'activer une configuration personnalis\u00e9e pour chaque r\u00e9seau souhait\u00e9.</p> <p>Ici, nous souhaitons avoir les informations suivantes :</p> <ul> <li>Adresse IP : 10.56.126.223</li> <li>Masque : 255.255.255.0</li> <li>Gateway : 10.56.126.254</li> <li>DNS : 1.1.1.1</li> </ul> <p>Ajout d'un profil pour une connexion ip fixe :</p> <pre><code>nmcli connection add type ethernet con-name ipfixe ifname eth0 ipv4.addresses 10.56.126.223/24 ipv4.gateway 10.56.126.254 ipv4.dns 1.1.1.1 ipv4.method manual\n</code></pre> <p>On observe ensuite les diff\u00e9rentes connection avec <code>nmcli connection show</code> :</p> <pre><code>NAME     UUID                                  TYPE      DEVICE\nipfixe   693bdc04-28e0-4e83-9b58-fef659d8f33c  ethernet  eth0\ndocker0  0250129c-212a-4ecc-a7f3-35649a492f08  bridge    docker0\nlo       45cc8d65-2e4e-40ce-bdbd-1c90b23dada8  loopback  lo\neth0     40d5bcc8-ca0c-42a9-9fad-388b15a5e856  ethernet  --\n</code></pre> <p>On active la connextion avec :</p> <pre><code>nmcli connection up ipfixe\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/NMCLI/#network-manager","title":"Network Manager","text":"<p>Installation du package systemd-networkd pour obtenir la commande <code>networkctl</code>:</p> <pre><code>dnf -y install systemd-networkd\n</code></pre> <p>Pour observer les diff\u00e9rentes cartes r\u00e9seaux, on utlise networkctl :</p> <pre><code>IDX LINK        TYPE     OPERATIONAL SETUP\n  1 lo          loopback carrier     unmanaged\n  2 eth0        ether    routable    unmanaged\n  3 eth1        ether    carrier     unmanaged\n  4 docker0     bridge   routable    unmanaged\n  6 vethda849ef ether    enslaved    unmanaged\n</code></pre> <p>Empecher le management des cartes tout le temps :</p> <ul> <li>Ajout d'un fichier dans /etc/NetworkManager/conf.d/99-unmanaged.conf <pre><code>[keyfile]\nunmanaged-devices=mac:00:15:5d:85:01:0f,mac:00:15:5d:85:01:10\n</code></pre></li> <li>Suppression des profiles avec nmcli :  <pre><code>nmcli connection delete #nomdelaconnexion\n</code></pre></li> </ul> <p>Configuration d'une carte avec un fichier de configuration dans <code>/etc/systemd/network/</code> avec un fichier en .network :</p> <pre><code># Configuration du LAN 1\n[Match]\nMACAddress=00:15:5d:85:01:0f\n\n\n[Network]\nAddress=192.168.131.254/24\n# Configuration du LAN 2\n[Match]\nMACAddress=00:15:5d:85:01:10\n\n\n[Network]\nAddress=192.168.132.254/24\n</code></pre> <p>Tip</p> <p>Pour continuer le tp, on utilise 3 machines diff\u00e9rentes afin d'avoir la possibilit\u00e9 de communiquer entre elles.</p> <p>Modification des fichiers de configuration de network :</p> <pre><code># Configuration du LAN 1\n[Match]\nMACAddress=00:15:5d:85:01:0f\n\n\n[Network]\nAddress=192.168.131.1/24\nGateway=192.168.131.254\n</code></pre> <p>On active le routage car par d\u00e9faut le routage n'est pas activ\u00e9 sur linux :</p> <p><pre><code>sysctl -w net.ipv4.ip_forward=1 </code></pre> Rendre le param\u00e8tre persistant dans etc/sysctl.d/01-routage.conf :</p> <pre><code>net.ipv4.ip_forward = 1\n</code></pre> <p>Mettre en place une r\u00e8gle de firewall pour enlever le message \"paquet filtr\u00e9\" :</p> <pre><code>firewall-cmd --zone=trusted --add-source=192.168.0.0/16 --permanent\n</code></pre> <p>Ajout d'une ou plusieurs routes statiques permanantes avec nmcli pour permettre \u00e0 plusieurs sous-r\u00e9seaux de communiquer entre eux :</p> <pre><code>nmcli connection modify eth2 +ipv4.routes \"192.168.101.0/24 10.56.126.220\"\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/","title":"S\u00e9curit\u00e9 de SSH","text":""},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#changement-du-port-de-ssh","title":"Changement du port de SSH","text":"<p>Warning</p> <p>Cette solution pour s\u00e9curiser SSH n'est pas recommand\u00e9 car cela ne procure pas beaucoup de s\u00e9curit\u00e9</p> <p>Localisation du fichier de configguration de SSH </p> <pre><code>/etc/ssh/sshd_config\n</code></pre> <p>Pour modifier le port, on modifie la ligne :</p> <p><pre><code>#Port 22\n</code></pre> On enregistre ensuite le fichier et on execute la policy de SE linux : </p> <pre><code>semanage port -a -t ssh_port_t -p tcp #PORTNUMBER\n</code></pre> <p>On restart aussi le service :</p> <pre><code>sudo systemctl restart sshd\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#fail2ban","title":"Fail2ban","text":"Info <p>Pour chercher des packages qui ne sont pas pr\u00e9sent sur les dep\u00f4ts par d\u00e9faut : dpkg.org</p> <p>Installation d'un d\u00e9pot suppl\u00e9mentaire :</p> <p><pre><code>dnf install epel-release\n</code></pre> On cherche le repo <code>fail2ban</code> et de quoi il est compos\u00e9:</p> <pre><code>dnf search fail2ban\ndnf info fail2ban\n</code></pre> <p>Installation de bail2ban :</p> <pre><code>dnf install fail2ban-firewalld\n</code></pre> <p>Info</p> <p>Systemd \u00e0 la main sur cron, fstab, les services et aussi les logs</p> <p>Dans le service journald, on cherche les envois de logs avec <code>grep Forward /etc/systemd/journald.conf</code>.</p> <p>Cela nous retourne : </p> <pre><code>#ForwardToSyslog=no\n#ForwardToKMsg=no\n#ForwardToConsole=no\n#ForwardToWall=yes\n</code></pre> <p>Pour obtenir les logs de sshd avec systemctl :</p> <pre><code>journalctl --unit sshd.service\n</code></pre> <p>Installation d'un package suppl\u00e9mentaire :</p> <pre><code>dnf install -y fail2ban-systemd\n</code></pre> <p>Tip</p> <p>Le service de fail2ban n'est pas en d\u00e9marrage automatique d\u00e8s son installation.</p> <p>Mise en route du service fail2ban :</p> <pre><code>systemctl start fail2ban\n</code></pre> <p>Observation des prisons <code>fail2ban-client status</code>:</p> <pre><code>Status\n|- Number of jail:      0\n`- Jail list:\n</code></pre> <p>Localisation des fichiers de configuation des fichiers de fail2ban :</p> <pre><code>/etc/fail2ban/\n</code></pre> <p>Interdiction</p> <p>On ne travaille pas sur le fichier de configuration direct, on utilise le dossier en .d \u00e0 la fin</p> <p>Affichage de pages de man install\u00e9es avec le package <code>rpm -ql fail2ban-server | grep /man</code> et on cherche la documentation sur les jails :</p> <pre><code>/usr/share/man/man1/fail2ban-client.1.gz\n/usr/share/man/man1/fail2ban-python.1.gz\n/usr/share/man/man1/fail2ban-regex.1.gz\n/usr/share/man/man1/fail2ban-server.1.gz\n/usr/share/man/man1/fail2ban.1.gz\n/usr/share/man/man5/jail.conf.5.gz\n</code></pre> <p>Ajout d'un fichier de configuration dans le dossier jail.d :</p> <pre><code>[sshd]\nenabled = true\n\n# Mise en place d'un blocage de 30 minutes si il y a 5 essais erron\u00e9s en 5 minutes\n\nbantime = 1800\nfindtime = 300\nmaxretry = 5\n</code></pre> <p>On restart le service fail2ban :</p> <pre><code>systemctl restart fail2ban.service\n</code></pre> <p>On peut observer les jail:</p> <pre><code>fail2ban-client get sshd banned\n</code></pre> <p>On d\u00e9ban juste d'un jail avec la commande : </p> <pre><code>fail2ban-cleint set sshd unbanip #ipdelamachine\n</code></pre> <p>On d\u00e9ban une ip de toutes les jails:</p> <pre><code>fail2ban-clent unban #ipdelamachine\n</code></pre> <p>Info</p> <p>On d\u00e9sactive fail2ban pour la suite du tp.</p>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#sshguard","title":"SSHGuard","text":"<p>Recherche de SSHGuard :</p> <pre><code>dnf search sshguard\n</code></pre> <p>Dans la liste on cherche ce qui se rapporte au firewall :</p> <pre><code>======================================== Nom correspond exactement \u00e0 : sshguard ========================================\nsshguard.x86_64 : Protects hosts from brute-force attacks against SSH and other services\n========================================= Nom &amp; R\u00e9sum\u00e9 correspond \u00e0 : sshguard =========================================\nsshguard-firewalld.x86_64 : Configuration for firewalld backend of SSHGuard\nsshguard-iptables.x86_64 : Configuration for iptables backend of SSHGuard\nsshguard-nftables.x86_64 : Configuration for nftables backend of SSHGuard\n</code></pre>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#portknocker","title":"PortKnocker","text":""},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#installation-du-serveur-knock","title":"Installation du serveur knock","text":"<p>Info</p> <p>Port_knocker permet d\u2019ouvrir et de fermer les ports d\u2019une machine de fa\u00e7on dynamique. Il agit avec un client qui vient \"frapper\" \u00e0 la porte de la machine sur plusieurs ports. Si la s\u00e9quence est correcte, port-knocker ouvre le port qui correspond \u00e0 la s\u00e9quence pendant un certain temps avant de le d\u00e9sactiver.</p> <p>Recherche du pakcge knockd :</p> <pre><code>dnf search knock\n</code></pre> <p>Installation de knock et de son serveur :</p> <pre><code>dnf -y install knock\ndnf -y install knock-server\n</code></pre> <p>Tip</p> <p>Attention le service n'est pas d\u00e9marr\u00e9 par d\u00e9faut \u00e0 l'installation. Pour le d\u00e9marrer, utiliser : <pre><code>systemctl start knockd\n</code></pre></p> <p>Localisation des fichiers de configurations :</p> <pre><code>/etc/knockd.conf\n</code></pre> <p>On observe le fichier de configuration : </p> <pre><code>[options]\nUseSyslog\n\n[opencloseSSH]\nsequence      = 2222:udp,3333:tcp,4444:udp\n        seq_timeout   = 15\ntcpflags      = syn,ack\n        start_command = /sbin/iptables -A INPUT -s %IP% -p tcp --dport ssh -j ACCEPT\n        cmd_timeout   = 10\nstop_command  = /sbin/iptables -D INPUT -s %IP% -p tcp --dport ssh -j ACCEPT\n</code></pre> <p>Sur la configuration, on observe la s\u00e9quence utilis\u00e9e avec les ports suivants: <code>2222:udp,3333:tcp,4444:udp</code>.</p> <p>De plus, on remarque 2 commandes iptables permettant d'ajouter (option -A) et de supprimer (option -D) une ip dans le fichier iptables</p> <p>Warning</p> <p>Pour que le port knocking fontionne correctement, il faut que tout les ports de la machine soient ferm\u00e9s. On utlise la commade iptables pour fermer tout les ports : <pre><code>iptables -P INPUT DROP\n</code></pre></p> <p>On r\u00e9alise notre propre fichier de configuration. Au pr\u00e9lable, comme il n'y a pas de dossier en .d pour faire des configurations annexe, on copie le fichier de configuration pour en faire une sauvegarde.</p> <p>Modification du fichier knockd.config :</p> <pre><code>[opencloseSSH]\nsequence      = 2222:tcp,3333:udp,4444:tcp\n        seq_timeout   = 15\nstart_command = /bin/firewall-cmd --zone=public --add-rich-rule 'rule family=ipv4 source address=%IP% service name=ssh accept'\ntcpflags      = syn\n        cmd_timeout   = 10\nstop_command  = /bin/firewall-cmd --zone=public --remove-rich-rule 'rule family=ipv4 source address=%IP% service name=ssh accept'\n</code></pre> <p>Warning</p> <p>Comme ici on utilise firewall-cmd, on d\u00e9sactive sur la zone publique ssh <pre><code>firewall-cmd --zone=public --remove-service=ssh\n</code></pre></p> <p>Ici nous avons utilis\u00e9 firewall-cmd pour remplacer iptables. Les start_command et stop_command permettent d'ajouter avec les rich-rules le service SSH.</p> <p>Sur la s\u00e9quence, les ports sont en tcp et udp. </p> <p>Warning</p> <p>Lorsque le port n'est pas sp\u00e9cifi\u00e9, celui-ci prend par d\u00e9faut la valeur TCP.*</p>"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#connexion-avec-knock","title":"Connexion avec knock","text":"<p>Pour la connexion client, nous avons besoin du package knock.</p> <p>On toc \u00e0 la porte de la machine :</p> <pre><code>knock  10.56.126.74 2222:tcp 3333:udp 4444:tcp\n</code></pre> <p>Si on decompose la commande, on retrouve l'ip de destination puis les diff\u00e9rents ports avec les protocoles si ce n'est pas du TCP.</p> <p>Warning</p> <p>Une fois la commande de knock envoy\u00e9e, il faut envoyer la commande ssh dans le laps de temps o\u00f9 le port est ouvert</p>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/","title":"Se linux","text":""},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#introduction","title":"Introduction","text":"<p>SE Linux se base sur la s\u00e9curit\u00e9 de type MAC (Mandatory Access Control).</p> <p>La commande <code>sestatus</code> permet d'obtenir des informations concernant la protection de SE Linux</p> <p> </p> Exemple de protection SE Linux <p>SE Linux poss\u00e8de 2 modes :</p> <ul> <li>Enforcing : cette option bloque et log</li> <li>Permissive : cette option laisse tout faire et log</li> </ul> <p>Pour forcer le mode <code>permissive</code> on utilise la commande :</p> Solution 1Solution 2 <pre><code>setenforce 0\n</code></pre> <pre><code>setenforce Permissive\n</code></pre> <p>Pour forcer le mode <code>enforcing</code> on utilise la commande :</p> Solution 1Solution 2 <pre><code>setenforce 1\n</code></pre> <pre><code>setenforce Enforcing\n</code></pre> <p>Chaque fihcier et prossesus ont un label de s\u00e9curit\u00e9 (security context) avec une forme : </p> <p>user:role:type(files)/domaine(processus):mls</p> <p>Cette forme peut-etre lue avec les commandes : </p> <pre><code>ls -Z /etc/hosts\n</code></pre> <p>et </p> <pre><code>ps -Zfax\n</code></pre> Info <p><code>Z</code> pour lister les labels</p> <p><code>f</code> affiche sous forme d'arbre</p> <p><code>a</code> pour lister les porcessus des autres utilisateurs</p> <p><code>x</code> affiche les processus qui n'ont pas de terminal de controle</p> <p>Lister les r\u00e8gles d'une strat\u00e9gie :</p> <pre><code>chcon -R -t </code></pre> Info <p><code>-R</code> pour recurcive</p> <p><code>-t</code> pour le type</p>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#manipulations","title":"Manipulations","text":""},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#mise-a-zero-de-auditlog","title":"Mise \u00e0 z\u00e9ro de audit.log","text":"<p>Arret du service auditd :</p> <pre><code>systemctl stop auditd\n</code></pre> <p>Si le service ne veux pas \u00eatre arr\u00e9t\u00e9 par le biais de <code>systemctl</code>, utilisez :</p> <pre><code>service auditd stop\n</code></pre> <p>Supprimez le fichier <code>\\var\\log\\audit\\audit.log</code></p> <pre><code>rm \\var\\log\\audit\\audit.log\n</code></pre> <p>On regarde ensuite les labels de s\u00e9curit\u00e9 du fichier :</p> <pre><code>ls -lZ \\var\\log\\audit\\audit.log\n</code></pre>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#mise-a-zero-de-selinux","title":"Mise \u00e0 z\u00e9ro de SElinux","text":""},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#reconstitution-des-labels-de-securite","title":"Reconstitution des labels de s\u00e9curit\u00e9","text":"<p>Danger</p> <p>La reconsititution des labels de s\u00e9curit\u00e9s concerne tout les fichiers. Si des labels de s\u00e9curit\u00e9 ont \u00e9t\u00e9 modifi\u00e9s manuellement, ceux-ci seront r\u00e9initialis\u00e9s par la reconsititution sauf si ceux-ci ont \u00e9t\u00e9 rentr\u00e9s dans les configurations persistantes.</p> <p>Pour reconstruire les labels de s\u00e9curit\u00e9 : </p> <pre><code>restorecon -R /\n</code></pre> <p>Pour reconstruire les labels de s\u00e9curit\u00e9 au prochain d\u00e9marrage :</p> <pre><code>touch /.autorelabel\n</code></pre> <p>Au red\u00e9marrage on peut observe le relabel :</p> <p> </p> Message au red\u00e9marrage de l'autorelabel <p>Les templates sont stocker dans <code>/etc/selinux/targeted</code>.</p> <p> </p> Contenu du dossier targeted <p>Exemple d'un fichier (ici <code>/etc/selinux/targeted/contexts/systemd_contexts</code>) :</p> <pre><code>runtime=system_u:object_r:systemd_runtime_unit_file_t:s0\n</code></pre>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#travail-sur-un-serveur-ftp","title":"Travail sur un serveur FTP","text":"<p>Abstract</p> <p>Installation du serveur : vsftpd</p> <p>On observe ensuite les labels de s\u00e9curit\u00e9 sur les dossiers <code>/var/ftp</code> et <code>/var/ftp/pub</code>.</p> <p>On remmarque que sur les labels de s\u00e9curit\u00e9, on retrouve un label public_content_t.</p> <p>On demarre le service avec <code>systemctl start vsftpd</code>.</p> <p>Note</p> <p>Le firewall bloque peut-\u00eatre les connexion au ftp via le navigateur (ftp://ipmachine).</p> <p>On active le service firewall FTP :</p> <pre><code>firewall-cmd --add-service=ftp\n</code></pre> <p>On se connecte avec un client ftp et une session comme root. On obteint un succ\u00e8s de connexion.</p> <p>On s'int\u00e9rresse maintenant au fichier de configuration <code>/etc/vsftpd/vsftpd.conf</code>.</p> <p>On retrouve la ligne :</p> <pre><code>anonymous_enable=NO\n</code></pre> <p>La ligne ci-dessus doit \u00eatre comment\u00e9e afin de pouvoir autoriser les connexions anonymes.</p> <p>Warning</p> <p>Il faut restart le service afin de prendre en compte le changement de configuration.</p> <p>On va cr\u00e9er les dossiers pour d\u00e9placer l'attache du ftp dans <code>/home/ftp/pub</code></p> Info <p>On peut utiliser <code>mkdir -p</code> avec l'option <code>-p</code> qui permet de cr\u00e9er les parents du dossier voulu.</p> <p>On ajoute une ligne dans <code>/etc/vsftpd/vsftpd.conf</code> pour lier le ftp dans le dossier cr\u00e9er pr\u00e9c\u00e9dement :</p> <pre><code>anon_root=/home/ftp\n</code></pre> <p>On regarde les labels de s\u00e9urit\u00e9 sur le dossier <code>ls -lZ /home/ftp/</code></p> <pre><code>drwxr-xr-x. 2 root root unconfined_u:object_r:user_home_t:s0 4096 27 janv. 09:34 pub\n</code></pre> <p>Info</p> <p>A partir de redhat 9, on \u00e0 maintenant acc\u00e8s au FTP .</p> <p>On cherche \u00e0 lister les diff\u00e9rents modules de SE Linux avec la commande avec l'installation de tools:</p> <pre><code>dnf -y install setools-console\n</code></pre> <p>On va lister tout les r\u00e8gles d'autorisations :</p> <pre><code>sesearch --allow -s ftpd_t | grep \" ftpd\"\n</code></pre> <p>Et on obteint une information concernant la r\u00e8gle ci-dessus :</p> <pre><code>allow ftpd_t user_home_t:dir { create link rename reparent rmdir setattr unlink watch watch_reads };\nallow ftpd_t user_home_t:file { create ioctl link lock map open read rename setattr unlink watch watch_reads write };\n</code></pre> <p>On peux filtrer aussi avec :</p> <pre><code>sesearch --allow -s ftpd_t -t user_home_t\n</code></pre> <p>On obteint :</p> <pre><code>allow daemon user_home_t:file { append getattr };\nallow domain file_type:blk_file map; [ domain_can_mmap_files ]:True\nallow domain file_type:chr_file map; [ domain_can_mmap_files ]:True\nallow domain file_type:file map; [ domain_can_mmap_files ]:True\nallow domain file_type:lnk_file map; [ domain_can_mmap_files ]:True\nallow ftpd_t file_type:filesystem getattr;\nallow ftpd_t non_security_file_type:dir { add_name create getattr ioctl link lock open read remove_name rename reparent rmdir search setattr unlink watch watch_reads write }; [ ftpd_full_access ]:True\nallow ftpd_t non_security_file_type:dir { add_name getattr ioctl lock open read remove_name search write }; [ ftpd_full_access ]:True\nallow ftpd_t non_security_file_type:dir { add_name getattr ioctl lock open read remove_name search write }; [ ftpd_full_access ]:True\nallow ftpd_t non_security_file_type:file { append create getattr ioctl link lock open read rename setattr unlink watch watch_reads write }; [ ftpd_full_access ]:True\nallow ftpd_t non_security_file_type:lnk_file { append create getattr ioctl link lock read rename setattr unlink watch watch_reads write }; [ ftpd_full_access ]:True\nallow ftpd_t user_home_t:dir { create link rename reparent rmdir setattr unlink watch watch_reads };\nallow ftpd_t user_home_t:file { create ioctl link lock map open read rename setattr unlink watch watch_reads write };\nallow userdom_filetrans_type user_home_t:dir { add_name getattr ioctl lock open read remove_name search write };\n</code></pre>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#exploration-de-selinux-avec-les-ports","title":"Exploration de SElinux avec les ports","text":"<p>Installation de apache avec le package httpd.</p> <p>Une fois l'installation termin\u00e9e, on modifie le port de Apache dans le fichier de configuration (<code>/etc/httpd/conf/httpd.conf</code>) :</p> <pre><code>Listen 8888\n</code></pre> <p>Warning</p> <p>Pour activer la modification, il faut red\u00e9marrer le service ou le d\u00e9marrer si cela n'a pas \u00e9t\u00e9 fait \u00e0 l'installation</p> <p>Pour red\u00e9marrer :</p> <pre><code>systemctl restart httpd\n</code></pre> <p>Pour d\u00e9marrer le service :</p> <pre><code>systemctl start httpd\n</code></pre> <p>Avec le restart, on obteint une erreur de configuration :</p> <pre><code>Job for httpd.service failed because the control process exited with error code.\nSee \"systemctl status httpd.service\" and \"journalctl -xeu httpd.service\" for details.\n</code></pre> <p>Si on observe les logs avec <code>journalctl -u httpd | tail</code>, on remarque que le port 8888 provoque un probl\u00e8me :</p> <pre><code>janv. 27 11:15:33 LG-stream9-1.local systemd[1]: Starting The Apache HTTP Server...\njanv. 27 11:15:35 LG-stream9-1.local httpd[1865]: (13)Permission denied: AH00072: make_sock: could not bind to address [::]:8888\njanv. 27 11:15:35 LG-stream9-1.local httpd[1865]: (13)Permission denied: AH00072: make_sock: could not bind to address 0.0.0.0:8888\njanv. 27 11:15:35 LG-stream9-1.local httpd[1865]: no listening sockets available, shutting down\njanv. 27 11:15:35 LG-stream9-1.local httpd[1865]: AH00015: Unable to open logs\njanv. 27 11:15:35 LG-stream9-1.local systemd[1]: httpd.service: Main process exited, code=exited, status=1/FAILURE\njanv. 27 11:15:35 LG-stream9-1.local systemd[1]: httpd.service: Failed with result 'exit-code'.\njanv. 27 11:15:35 LG-stream9-1.local systemd[1]: Failed to start The Apache HTTP Server.\n</code></pre> <p>On cherche aussi dans <code>/var/log/audit/audit.log</code> avec la commane <code>grep avc /var/log/audit/audit.log</code></p> <pre><code>type=AVC msg=audit(1674814535.950:140): avc:  denied  { name_bind } for  pid=1865 comm=\"httpd\" src=8888 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket permissive=0\ntype=AVC msg=audit(1674814535.953:141): avc:  denied  { name_bind } for  pid=1865 comm=\"httpd\" src=8888 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket permissive=0\n</code></pre> <p>On utilise audit2 pour comprendre le probl\u00e8me avec la commande (<code>grep avc /var/log/audit/audit.log | tail -n -1 | audit2why</code>):</p> <pre><code>Was caused by:\nThe boolean nis_enabled was set incorrectly.\nDescription:\nAllow nis to enabled\nAllow access by executing:\n# setsebool -P nis_enabled 1\n</code></pre> <p>Puis on cherche de savoir comment r\u00e9soudre ce probl\u00e8me avec audit2 avec la commande (<code>grep avc /var/log/audit/audit.log | tail -n -1 | audit2allow</code>):</p> <pre><code>#============= httpd_t ==============\n\n#!!!! This avc can be allowed using the boolean 'nis_enabled'\nallow httpd_t unreserved_port_t:tcp_socket name_bind;\n</code></pre> <p>Danger</p> <p>Attention cela provoque une faille de s\u00e9curit\u00e9. Nous allons donc passer par semanage.</p> <p>Pour lister tout les ports avec semanage (<code>semanage port -l | grep http</code> ) :</p> <pre><code>http_cache_port_t              tcp      8080, 8118, 8123, 10001-10010\nhttp_cache_port_t              udp      3130\nhttp_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000\npegasus_http_port_t            tcp      5988\npegasus_https_port_t           tcp      5989\n</code></pre> <p>Ici on peut d\u00e9couvrir tout les ports, on modifie alors le label http pour autoriser le port 8888 :</p> <pre><code>semanage port -a -t http_port_t -p tcp 8888\n</code></pre> <p>Si on observe les ports, on le retrouve dans la liste :</p> <pre><code>http_cache_port_t              tcp      8080, 8118, 8123, 10001-10010\nhttp_cache_port_t              udp      3130\nhttp_port_t                    tcp      8888, 80, 81, 443, 488, 8008, 8009, 8443, 9000\npegasus_http_port_t            tcp      5988\npegasus_https_port_t           tcp      5989\n</code></pre> <p>On red\u00e9marre alors le service httpd et on obteint aucune erreurs.</p>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#les-booleens-dans-selinux","title":"Les bool\u00e9ens dans SElinux","text":"Pr\u00e9requis pour r\u00e9aliser cette activit\u00e9 <p>Il est n\u00e9c\u00e9ssaire d'avoir un serveur web (par exemple httpd autrement dit apache).</p> <p>Ici nous utilisons le serveur web pr\u00e9c\u00e9dement install\u00e9 et sur le port 8888. Normalement, le port par d\u00e9faut est 80.</p> <p>Cr\u00e9ation d'un fichier <code>/var/www/cgi-bin/env.cgi</code> contenant :</p> <pre><code>#!/bin/bash\n\necho -e \"Content-Type: text/plain\\n\\n\"\n\nset\n</code></pre> <p>On rend ensuite le fichier executable pour tout le monde :</p> <pre><code>chmod 755 /var/www/cgi-bin/env.cgi\n</code></pre> <p>Puis on test avec un curl :</p> <pre><code>curl http://127.0.0.1:8888/cgi-bin/env.cgi\n</code></pre> Attention au firewall <p>Attention le firewall peut bloquer la communication sur le port 8888. Il faut autoriser le trafic sur le port :</p> <pre><code>firewall-cmd --add-port=8888/tcp\n</code></pre> <p>Petite modification du fichier <code>/var/www/cgi-bin/env.cgi</code> pour executer des requetes dans l'URL:</p> <pre><code>#!/bin/bash\n\necho -e \"Content-Type: text/plain\\n\\n\"\n\necho \"La commande est : $QUERY_STRING\"\nCMD=$(echo $QUERY_STRING | sed 's,%20, ,g')\n$CMD\n</code></pre> <p>Si on test le script dans le navigateur avec la commande  <code>curl http://172.19.252.60:8888/cgi-bin/env.cgi?ls</code>:</p> <p> </p> Exemple avec la commande ls <p>Danger</p> <p>Attention, les commandes sont execut\u00e9es avec l'identit\u00e9 du user <code>wwwdata</code>. </p> <p>Le utlisateur poss\u00e8de donc tout les droits de cr\u00e9ations et autres li\u00e9s \u00e0 <code>wwwdata</code>.</p> <p>Pour la s\u00e9curit\u00e9, on va d\u00e9sactiver toutes les executions des .cgi :</p> <pre><code> getsebool -a | grep http\n</code></pre> <p>On d\u00e9sactive alors l'execution des CGI :</p> <pre><code>setsebool -P httpd_enable_cgi off\n</code></pre> <p>Tip</p> <p>Attention au mode de selinux car si il est en permissive cela laissera actif l'execution des CGI.</p>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/","title":"Les permissions","text":""},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/#liste-des-permissions","title":"Liste des permissions","text":"<p>Commande pour obtenir des informations concernant les droits :</p> <pre><code>ls -l\n</code></pre> <p>On obteint plusieurs groupes :</p> <p></p> <ul> <li>x : pour se d\u00e9placer dedans (pour les fichier, on execute le fichier tel qu'un script)</li> <li>w : modification de contenu avec l'ajout, la modification ou la suppression d'octect (en fichiers ou en repertoires)</li> <li>r : lecture et copie des fichiers ( r\u00e9pertoire : lister les fichiers)</li> <li>s : Il conf\u00e8re l'identit\u00e9 du propri\u00e9taire de la commande (avec <code>passwd</code> par exemple)</li> <li>t : on trouve la permission sur tout les dossiers temporaires/partages. Seul le propri\u00e8taire du fichier peut le supprimer. (sticky-bit)</li> </ul>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/#commandes-de-changements-de-permissions","title":"Commandes de changements de permissions","text":"<ul> <li><code>chown</code> : pour modifier mes permissions du fichier</li> <li><code>chgrp</code> : L'administrateur et l'utilisateur peuvent modifier les permissions</li> <li><code>chmod</code>: Permet de changer les permissions d'acc\u00e8s d'un fichier ou d'un r\u00e9pertoire (il faut etre propri\u00e8taire du fichier)</li> </ul> <p>Pour chercher les fichiers qui poss\u00e8de le droit <code>s</code> :</p> <pre><code>find -perm /u=s\n</code></pre> <p>Et on obtient une liste de fichier plus ou moins longue si docker est install\u00e9 : </p> <p> </p> Liste des fichiers poss\u00e8dant le droit permettant une \u00e9l\u00e9vation de privil\u00e8ges <p>Info</p> <p>On peux ajouter une option <code>-o</code> pour faire un or et donc lier plusieurs arguments</p> <p>Exemple : <code>find / -perm /u=s -o -perm /g=s</code></p>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/#les-capabilities","title":"Les capabilities","text":""},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/#premieres-notions-sur-les-capabilities","title":"Premi\u00e8res notions sur les capabilities","text":"<p>Installation des pages de man (si elles ne sont pas pr\u00e9sentes) :</p> <pre><code>dnf -y install man-pages\n</code></pre> <p>Overture du man de <code>capabilities</code> :</p> <pre><code>man capabilities\n</code></pre> <p>Les capabilities ont 2 cat\u00e9gories :</p> <ul> <li>les processus privili\u00e9gi\u00e9s </li> <li>les processes non privili\u00e9gi\u00e9s</li> </ul> <p>Les processus privili\u00e9gi\u00e9s sont appell\u00e9 par un superutilisateur ou root. Ils contournent les verfications du noyaux.</p> <p>Les processus non privili\u00e9gi\u00e9s sont soumis \u00e0 une verification bas\u00e9e sur le processus.</p> <p>Les options :</p> <ul> <li><code>CAP_DAC_OVERRIDE</code> permet \u00e0 root de contourner les v\u00e9rification de lecture et d'\u00e9critures</li> <li><code>CAP_NET_BIND_SERVICE</code> permet de lier un socket aux ports pr\u00e9vili\u00e9gi\u00e9s (inf\u00e9rieur \u00e0 1024)</li> <li><code>CAP_CHOWN</code> permet d'apporter des modifications sur les fichiers</li> </ul>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/#tests-de-la-commande-nc","title":"Tests de la commande NC","text":"<p>Avec la commande <code>NC</code>, cela permet de d\u00e9clarer un serveur d'\u00e9coute et ainsi de pouvoir communiquer entre 2 ordinateurs distants</p> Tip <p>Pour pouvoir utiliser les commandes NC, il faut l'installer :</p> <pre><code>dnf -y install nc\n</code></pre> <p>L'utilisation de nc se r\u00e9alise avec 2 terminaux afin de pouvoir cr\u00e9er comme un canal de communication entre les deux terminaux.</p> <p>On lance avec un user sans droits sudo la commande : <code>nc -l 90</code></p> <p>On obtient alors une erreur:</p> <pre><code>Ncat: bind to :::90: Permission denied. QUITTING.\n</code></pre> Rappel sur les commandes de groupes et users <p>Ajout d'un groupe nomm\u00e9 ncusers :</p> <p><pre><code>groupadd ncusers\n</code></pre> Ajout d'un utilisateur avec le groupe ncusers <pre><code>useradd -g ncusers ncuser\n</code></pre></p> <p>On copie le dossier nc dans le tmp :</p> <pre><code>cp /bin/nc /tmp/capnc\n</code></pre> <p>Mise en place des droits :</p> <pre><code>install -o ncuser -g ncusers -m 700 /bin/nc /tmp/capnc\n</code></pre> <p>R\u00e8glage des droits avec la commande setcap :</p> <pre><code> setcap  cap_net_bind_service=ep  /tmp/capnc\n</code></pre> <p>V\u00e9rification des droits sur le dossier : </p> <pre><code>getcap /tmp/capnc\n</code></pre> <p>Puis on v\u00e9rifie si les droits focntionne avec la connexion sur le ncuser puis l'indication de la commande : </p> <pre><code>su - ncuser -c \"/tmp/capnc -l 90\"\n</code></pre>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/","title":"Sudo et Sudoreplay","text":""},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#introduction","title":"Introduction","text":"<p>Sudo est une abr\u00e9viation de \"substitute user do\", \"super user do\" ou \"switch user do \" , en fran\u00e7ais : \u00ab se substituer \u00e0 l'utilisateur pour faire \u00bb, \u00ab faire en tant que super-utilisateur \u00bb ou \u00ab changer d'utilisateur pour faire \u00bb). </p> <p>Elle est utilis\u00e9e dans tquasi tout les syst\u00e8mes de types UNIX.</p> Important <p>Le fichier de configuration de sudo est <code>/etc/sudoers</code>. Ce fichier est logiquement en lecture seule.</p> <p>Pour configurer sudo, on utlise les dossiers g\u00e9n\u00e9r\u00e9s par le package. Ici, un dossier est pr\u00e9sent pour laisser un fichier avec une configuration personnalis\u00e9e dans <code>/etc/sudoers.d/</code>.</p> <p>Dans ce dossier, vous pouvez cr\u00e9er un fichier avec n'importe quelle extension avec les configurations souhait\u00e9es.</p>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#mise-en-oeuvre-de-sudo","title":"Mise en oeuvre de sudo","text":"Directives de configurations <p>Ici chez sudo, nous avons une directive de configuration avec <code>!log_output</code>. Tout est redirig\u00e9 dans le dossier <code>/var/log/sudo-io</code>.</p>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#mise-en-place-des-logs","title":"Mise en place des logs","text":"<p>Cr\u00e9ation du dossier pour le stockage des logs d'output :</p> <pre><code>mkdir -p /var/log/sudo-io\n</code></pre> <p>Application des redirections de logs dans le dossier nouvellement cr\u00e9e. Ici on place un nouveau fichier dans <code>/etc/sudoers.d/</code> nomm\u00e9 config :</p> <pre><code>Defaults log_output\nDefaults!/usr/bin/sudoreplay !log_output\nDefaults!/sbin/reboot !log_output\n</code></pre>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#realisaton-de-regles-pour-sudo","title":"R\u00e9alisaton de r\u00e8gles pour sudo","text":""},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#commandes-swap","title":"Commandes swap","text":"<p>On souhaite que le groupe <code>users</code> puisse r\u00e9aliser les commandes :</p> <ul> <li><code>swapon</code>avec n'importe quel argument </li> <li><code>swapoff</code>avec l'argument unique \\dev\\sda3</li> </ul> <p>On r\u00e9alise un nouveau fichier nomm\u00e9 <code>swap_off_users</code> dans le dossier de configuration de sudo :</p> <pre><code>%users     ALL   =    (ALL)     /sbin/swapon, /sbin/swapoff /dev/sda3\n</code></pre> <p>Tip</p> <p>Pour tester les commandes, il est conseill\u00e9 de prendre un utilisateur sans aucun groupes afin de pouvoir tester simplement.</p> <p>Rappel : pour ajouter un user la commande est <code>useradd</code> et la commande pour ajouter dans un groupe <code>usermod -aG</code></p> <p>Ici on ajoute l'utlisateur <code>utlisateur</code> dans le groupe users :</p> <pre><code>usermod -aG users utilisateur\n</code></pre> <p>Pour tester les commandes, on utlise les commandes suivantes :</p> <pre><code>sudo swapon /dev/sda3\nsudo swapoff /dev/sda3\n</code></pre>"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#commande-id","title":"Commande ID","text":""},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#sudoreplay","title":"Sudoreplay","text":"<p>Avec l'activation des logs r\u00e9alis\u00e9 plus haut, tout les logs ont \u00e9t\u00e9 enregistr\u00e9s. Les logs se trouvent dans <code>/var/log/sudo-io</code></p> <p>On peux afficher les logs avec la commande : <pre><code>ls -trl /var/log/sudo-io/00/00/*\n</code></pre></p> <p>On peux aussi afficher les replays avec le TSID avec la commande :</p> <pre><code>sudoreplay -l\n</code></pre> <p>Pour jouer les sessions, on utlise sudoreplay avec <code>sudoreplay TSID</code>.</p>"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Commandes%20dans%20kubernetes/","title":"Commandes dans Kubernetes","text":"<p>Changement de l'espace de travail </p> <pre><code>kubectl config set-context --current --namespace kube-system\n</code></pre> <p>Cr\u00e9ation d'un espace de travail</p> <pre><code>kubectl create namespace leo\n</code></pre> <p>Se situer dans l'environement </p> <p><pre><code>kubectl config get-contexts\n</code></pre> Cr\u00e9ation d'un d\u00e9ployment</p> <pre><code> kubectl create deployment --image nginx:latest --port 80 nginx\n</code></pre> <p>Lister les deployments</p> <pre><code>kubectl get deployments\n</code></pre> <p>Lister les pods de mani\u00e8re simple</p> <pre><code>kubectl get pods\n</code></pre> <p>Lister les pods de mani\u00e8re plus compl\u00e8te </p> <pre><code>kubectl get pods  -o wide\n</code></pre> <p>Cr\u00e9ation d'un service</p> <pre><code>kubectl create service loadbalancer --tcp 80:80 ngnix\n</code></pre> <p>Recuprer le service</p> <pre><code> kubectl get service\n</code></pre> <p>Edition du r\u00e9plicat </p> <pre><code>kubectl scale --replicas=3 deployment nginx\n</code></pre> <p>D\u00e9ployement d'un template </p> <pre><code>kubectl apply -f ./Deployment_whomi.yml </code></pre> <p>Voir les logs d'un pod </p> <pre><code>kubectl logs -f whoami\n</code></pre> <p>Voir les logs d'un pod avec le label</p> <pre><code>kubectl logs -f -l app=whoami\n</code></pre> <p>Passer en mode exectution dans le pod</p> <pre><code>kubectl exec -it nginx-deployment -- sh\n</code></pre>"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Syntaxe%20fichier%20deployment%20et%20services/","title":"Syntaxe fichier deployment et services","text":""},{"location":"Vitrualisation%20%26%20cloud/Commandes/Syntaxe%20fichier%20deployment%20et%20services/#syntaxe-du-deployment","title":"Syntaxe du deployment","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: nginx-deployment\nlabels:\napp: nginx\nspec:\nreplicas: 3\nselector:\nmatchLabels:\napp: nginx\ntemplate:\nmetadata:\nlabels:\napp: nginx\nspec:\ncontainers:\n- name: nginx\nimage: nginx:1.14.2\nports:\n- containerPort: 80\n</code></pre>"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Syntaxe%20fichier%20deployment%20et%20services/#syntaxe-du-service","title":"Syntaxe du service","text":"<pre><code>apiVersion: v1\nkind: Service\nmetadata:\nname: my-service\nspec:\nselector:\napp.kubernetes.io/name: MyApp\nports:\n- protocol: TCP\nport: 80\ntargetPort: 9376\n</code></pre>"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Syntaxe%20fichier%20deployment%20et%20services/#exemple-de-fichier-complet","title":"Exemple de fichier complet","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: whoami-deployment\nlabels:\napp: whoami\nspec:\nreplicas: 3\nselector:\nmatchLabels:\napp: whoami\ntemplate:\nmetadata:\nlabels:\napp: whoami\nspec:\ncontainers:\n- name: whoami\nimage: traefik/whoami:latest\nports:\n- containerPort: 80\nprotocol: TCP\n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\nname: whoami-service\nspec:\nselector:\napp: whoami\nports:\n- protocol: TCP\nport: 80\ntargetPort: 80\ntype: LoadBalancer\n</code></pre>"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Syntaxe%20fichier%20deployment%20et%20services/#exemple-avec-modification-de-ports","title":"Exemple avec modification de ports","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: whoami-deployment\nlabels:\napp: whoami\nspec:\nreplicas: 3\nselector:\nmatchLabels:\napp: whoami\ntemplate:\nmetadata:\nlabels:\napp: whoami\nspec:\ncontainers:\n- name: whoami\nimage: traefik/whoami:latest\nenv : - name: WHOAMI_PORT_NUMBER\nvalue : \"1234\"\nports:\n- containerPort: 1234\nprotocol: TCP\n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\nname: whoami-service\nspec:\nselector:\napp: whoami\nports:\n- protocol: TCP\nport: 80\ntargetPort: 1234\ntype: LoadBalancer\n</code></pre>"},{"location":"Vitrualisation%20%26%20cloud/Rappels/Rappel%20sur%20la%20virtualisation/","title":"La vitrualisation","text":""},{"location":"Vitrualisation%20%26%20cloud/Rappels/Rappel%20sur%20la%20virtualisation/#rappel-sur-les-vm-et-les-conteneurs","title":"Rappel sur les VM et les conteneurs","text":""},{"location":"Vitrualisation%20%26%20cloud/Rappels/Rappel%20sur%20la%20virtualisation/#difference-entre-la-vm-et-le-conteneur","title":"Diff\u00e9rence entre la VM et le conteneur","text":"Rappel sur la virtualisation et les conteneurs <p>Les VM h\u00e9bergent un syst\u00e8me virtuel complet comprenant le hardware (physique) et l'OS (Op\u00e9rating Syst\u00e8me). Cot\u00e9 conteneurs, celui-ci est utilis\u00e9 pour :</p> <ul> <li>la performance</li> <li>les ressources</li> <li>Facilite la MCO ( + vite , + leger et un versionning avanc\u00e9)</li> <li>Le prix</li> <li>Gain d'agilit\u00e9</li> <li>Mise \u00e0 l'\u00e9chelle plus facile</li> </ul> <p>Les conteneurs d\u00e9pendent d'une seule et unique application.</p> <p> </p> Principe du conteneur"},{"location":"Vitrualisation%20%26%20cloud/Rappels/Rappel%20sur%20la%20virtualisation/#larchitecture-des-conteneur-detaille","title":"L'architecture des conteneur d\u00e9taill\u00e9","text":"<p>Le conteneur poss\u00e8de tout son environement tout autour de l'application</p> <p> </p> Principe du conteneur - Architecture"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/","title":"Kubernetes","text":""},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#definition","title":"D\u00e9finition","text":"<p>Kubernetes est une solution Open Source permettant l'orchestration de ressources conteneuris\u00e9es. Cette solution est une solution d\u00e9velopp\u00e9e par Google et elle \u00e0 \u00e9t\u00e9 offert \u00e0 la Linux Fondation (2014).  Par la suite la CNCF (Cloud Native Computing Fondation) \u00e0 \u00e9t\u00e9 cr\u00e9e en 2015.</p> <p>D\u00e9finition de kubernetes par la CNCF</p> <p>Kubernetes est ue plateforme open source extensible et portable pour la gestion de charge de trvail et de service conteneuris\u00e9s.</p>"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#autres-plateformes","title":"Autres plateformes","text":"<p>On retrouve plusieurs plateformes encore active aujourd'hui contrairement \u00e0 Docker Swarm, Mesos ...</p> <p>Les solutions actuelles : </p> <ul> <li>Titus, solution utilis\u00e9e par Netflix</li> <li>Nomad, soltion en voggue propuls\u00e9e par Hashicorp</li> <li>Apache Mesos , solution propos\u00e9e par Apache</li> </ul>"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#fonctionnement-de-kubernetes","title":"Fonctionnement de Kubernetes","text":""},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#architecture-de-kubernetes","title":"Architecture de kubernetes","text":""},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#termes-utilises-dans-kubernetes","title":"Termes utilis\u00e9s dans Kubernetes","text":"Terme Signification Master (ou control-plane) Permet de g\u00e9rer le syst\u00e8mes Workers Permet d'executer l'applicatif ETCD Magasin de valeurs cl\u00e9s coh\u00e9rent et hautement disponible Scheduleur Assure les diff\u00e9rentes contraintes (arret, d\u00e9marrage des conteneurs) Controller Manager Gestion des droits API-SERVER Centre n\u00e9vralgique de kubernetes Kube proxy Assure le r\u00e9seau, la communication avec l'api-server Kubelet Seul composant non contenuris\u00e9. Service <code>systemctl</code> qui va communiquer avec le moteur de contenurisation container Ressource ex\u00e9cutant une application pod Groupement d'un ou plusieurs conteneurs deployment Orchestre les pods et replicaSets deamonset S'assure d'avoir un pod sur chaque noeud statefullset [legacy] S'assure de n'avoir qu'un seul pod service Explose votre application sur le r\u00e9seau du cluster ingress Permet d'exposer un service en externe (#reverseProxy) persistent volumes claims Demande d'allocation de stockage configMaps stockage cl\u00e9-valeur non confidentiel secrets stockage cl\u00e9-valeur confidentiel"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#objets-de-kubernetes","title":"Objets de kubernetes","text":""},{"location":"Windows/Active%20directory/GPO/","title":"GPO","text":"<p>Nous avons un script \u00e0 d\u00e9ployer sur toutes les machines du domaine. Ce script doit : </p> <ul> <li>S'executer au d\u00e9marrage de la session</li> <li>Les utilisateurs dans les OU choisi doivent avoir se script</li> </ul> <p>Info</p> <p>OU = Unit\u00e9 d'organisation</p>"},{"location":"Windows/Active%20directory/GPO/#creation-dun-ou","title":"Cr\u00e9ation d'un OU","text":"<p>Pour cr\u00e9er un OU, le serveur (ici un Windows serveur 2019) doit \u00eatre un serveur AD.</p> <p>Le serveur AD doit \u00eatre promu en contr\u00f4leur de domaine.</p> <p>La cr\u00e9ation d'OU, intervient dans les outils du gestionnaire de serveur puis dans dans gestion des strat\u00e9gies de groupe.</p> <p> </p> Outils de l'AD <p>On obtient ensuite une fen\u00eatre avec la for\u00eat.</p> <p> </p> Gestion des strat\u00e9gies de groupes <p>On utlise ensuite le clic droit -&gt; Nouvelle unit\u00e9 d'organsiation</p> <p> </p> Cr\u00e9ation de l'OU <p>Donnez ensuite un nom \u00e0 votre OU. </p> <p>On retrouve cette OU dans la foret sous les domaines</p> <p> </p> Unit\u00e9 organisation 1"},{"location":"Windows/Active%20directory/GPO/#creation-de-la-gpo","title":"Cr\u00e9ation de la GPO","text":"<p>Une fois l'OU cr\u00e9e, vous pouvez vous positionner sur celle-ci et faire Clic droit -&gt; Cr\u00e9\u00e9r un objet GPO</p> <p>Mettez un nom \u00e0 cette GPO.</p> <p> </p> Cr\u00e9ation de la GPO <p>Faites clic droit sur la GPO puis modifier l\u00e0.</p> <p>Ici nous allons dans les strat\u00e9gies de scripts d'ouverture de sessions.</p> <p> </p> Localisation des scripts d'ouverture de sessions <p>On ajoute le script (ici un script powershell) dans l'onglet Powershell. Quand on met un script, il faut garder le dossier par d\u00e9faut et mettre le script dans ce dossier.</p> <p><pre><code>\\\\AD-LG.local\\SysVol\\AD-LG.local\\Policies\\{53DB8C41-12CE-42EE-9DD9-509CA44D262A}\\User\\Scripts\\Logon\n</code></pre> Ici le chemin avec le num\u00e9ro de la GPO.</p> <p>On v\u00e9rifie ensuite le nom du script.</p> <p> </p> Onglet powershell <p>Sur la machine cliente, on peux voir avec un <code>GPRESULT /R</code> l'\u00e9tat de la GPO.</p> <p>On v\u00e9rifie que la GPO espion est bien pr\u00e9sent.</p> <p> </p> Verificiation du scripts d'ouverture de sessions"},{"location":"Windows/Powershell/Cr%C3%A9ation%20d%27un%20dossier%2Bscript/","title":"Cr\u00e9ation d'un dossier+script","text":""},{"location":"Windows/Powershell/Cr%C3%A9ation%20d%27un%20dossier%2Bscript/#verification","title":"Verification","text":"<p>Dans cette partie, on va v\u00e9rifier si un dossier est cr\u00e9e \u00e0\u00f9 non.</p> <p>Pour test si un dossier existe, on va utiliser <code>Get-Item</code> :</p> <pre><code>$retour = Get-Item -Path \"c:/log\" -ErrorAction SilentlyContinue\n</code></pre> <p>Ici, on stocke la valeur rendu par la commande dans <code>$retour</code>.</p> <p>On va ensuite aller chercher le dossier <code>c:/log</code>.</p> <p>On va s'assurer que la commande s'excute en silence m\u00eame si il y a des erreurs avec <code>-ErrorAction SilentlyContinue</code></p> <p>Note</p> <p>Ici nous utilisons un dossier qui n'existe pas.</p> <p>Le but de cette activit\u00e9 est de cr\u00e9er un script qui quand il ne trouve pas le dossier <code>c:/log</code>, il cr\u00e9e un dossier. </p> <p>Dans ce dossier, nous souhaitons qu'il y ai un fichier nomm\u00e9 'ESPION.txt'.</p> <p>On va donc cr\u00e9er un dossier \u00e0 la racine si celui-ci n'existe pas :</p> <pre><code>if (!(Get-Item -Path \"c:\\log\" -ErrorAction SilentlyContinue)) {New-Item \"c:\\log\" -ItemType Directory }\n</code></pre> <p>On v\u00e9rifie ensuite si le fichier <code>espion.txt</code> existe dans le dossier <code>c:\\log</code> :</p> <pre><code>if (!(Get-Item -Path \"c:\\log\\espion.txt\" -ErrorAction SilentlyContinue)) {New-Item -Path \"c:\\log\\espion.txt\" -ItemType File}\n</code></pre> <p>On r\u00e9alise ensuite le script complet avec l'impl\u00e9mentation du user et de la date/heure :</p> <pre><code>if (!(Get-Item -Path \"c:\\log\" -ErrorAction SilentlyContinue)) {New-Item \"c:\\log\" -ItemType Directory }\nif (!(Get-Item -Path \"c:\\log\\espion.txt\" -ErrorAction SilentlyContinue)) {New-Item -Path \"c:\\log\\espion.txt\" -ItemType File}\n\n$export = \"{0,-20}:{1:yyyy}:{2}:{3}:{4}:{5}:{6}\" -f $env:USERNAME, (Get-Date),(Get-Date).Month,(Get-Date).Day,(Get-Date).Hour,(Get-Date).Minute, (Get-Date).DayOfWeek\nWrite-Output $export\n\nADD-content -path \"c:\\log\\espion.txt\" -value $export\n</code></pre> <p>Note</p> <p>Le <code>ADD-content -path \"c:\\log\\espion.txt\" -value $export</code> permet d'\u00e9crit dans le fichier espion.txt</p>"},{"location":"Windows/Powershell/Cr%C3%A9ation%20fichier%20avec%20user%20%2B%20date/","title":"Cr\u00e9ation fichier avec user + date","text":""},{"location":"Windows/Powershell/Cr%C3%A9ation%20fichier%20avec%20user%20%2B%20date/#comment-obtenir-la-date-en-powershell","title":"Comment obtenir la date en Powershell","text":"<p>On utilise la commande : </p> <pre><code>Get-Date\n</code></pre> <p> </p> R\u00e9sultat de la commande Get-date"},{"location":"Windows/Powershell/Cr%C3%A9ation%20fichier%20avec%20user%20%2B%20date/#obtenir-certaines-informations-dapres-une-commande","title":"Obtenir certaines informations d'apr\u00e8s une commande","text":"<p>Note</p> <p>Les op\u00e9rateurs sont r\u00e9f\u00e9renc\u00e9s sur le site : https://ss64.com/ps/ </p> <p>On souhaite r\u00e9cup\u00e9rer les diff\u00e9rents membre de la date affich\u00e9e par powershell :</p> <pre><code>Get-Date | Get-Member\n</code></pre> <p> </p> R\u00e9sultat de la damande des membres <p>Dans le cas de la commande Get-member et de Powershell en g\u00e9n\u00e9ral, nous avons un language orient\u00e9 objet.</p> <p>On r\u00e9cup\u00e8re les quelques informations :</p> <pre><code>Get-Date | Select-Object -Property Year, Month , Day\n</code></pre> <p>Cette commande nous donne un tableau de valeur : </p> <p> </p> Tableau de date <p>On stocke la valeur dans une variable temporaire : </p> <p><pre><code>$DATE = Get-Date\n\n$DATE.Day\n</code></pre> On r\u00e9cup\u00e8re uniquement la valeur de la date.</p> <p>Info</p> <p>On peux aussi r\u00e9cup\u00e8rer la valeur d'un autre fa\u00e7on : <pre><code>(Get-Date).Day\n</code></pre></p> <ul> <li> <p>Cherche une chaine de caract\u00e8res :</p> <pre><code>Get-Date -UFormat \"%Y:%m:%d:%R:%A\"\n</code></pre> </li> </ul> <p> </p> Chaine de caract\u00e8re obtenue <p>On prend le nom d'utilisateur :</p> <pre><code>$env:USERNAME\n</code></pre> <p>On va ensuite aller chercher les diff\u00e9rentes informations avec leur position :</p> <pre><code>\"{0,-20}:{1:yyyy}:{2:MM}\" -f $env:USERNAME, (Get-Date).Year , (Get-Date).Month\n</code></pre> <p>Info</p> <ul> <li>On utilise les <code>{}</code> pour donner la position + le formatage</li> <li>L'option <code>-f</code> permet de r\u00e9aliser le formatage</li> <li>Les diff\u00e9rentes informations sont s\u00e9par\u00e9es par une virgule <code>,</code></li> </ul> <p>Pour afficher et cr\u00e9er un fichier avec les informations voulue :</p> <pre><code>$export = \"{0,-20}:{1:yyyy}:{2}:{3}:{4}\" -f $env:USERNAME, (Get-Date),(Get-Date).Month,(Get-Date).Day,(Get-Date).DayOfWeek\nWrite-Output $export\n\n# Export dans un txt\n# On verifi si le fichier existe\n$file = \".\\export.txt\"\nif (!(Test-Path -Path $file)){\n    #Si il existe pas on le cr\u00e9er\n    New-Item -Path $file\n}\n# On ajoute notre ligne dans le fichier \nADD-content -path $file -value $export\n</code></pre>"}]}
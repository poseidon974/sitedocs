{"config":{"indexing":"full","lang":["fr"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Voici les diff\u00e9rents cours pr\u00e9sents et document\u00e9s Type Formation Cours Date Linux Administration avanc\u00e9e Installation avanc\u00e9e CENTOS9 01/12/2022 Linux Administration avanc\u00e9e RPM et YUM 02/12/2022 Windows PowerShell Cr\u00e9ation d'un dossier et d'un script 06/12/2022 Windows PowerShell Cr\u00e9ation d'un fichier avec user et date 06/12/2022 Linux Administration LVM 01/06/2022 Windows AD Cr\u00e9ation d'une GPO 07/12/2022 Linux S\u00e9curit\u00e9 Les permissions 26/01/2023 Linux S\u00e9curit\u00e9 SE Linux 26/01/2023","title":"Home"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/","text":"Mise en place des partitions \u00b6 D\u00e9couverte des disques \u00b6 Emplacement des disques \u00b6 /dev/sda sda = Premier disque sdb = Second disque De mani\u00e8re g\u00e9n\u00e9rale sd x avec le x qui est le disque (par ordre aphab\u00e9tique) Partitions des disques \u00b6 /dev/sda1 sda1 = Premi\u00e8re partition du disque sda2 = Seconde partition du disque De mani\u00e8re g\u00e9\u00e9nrale sd x z avec z qui le num\u00e9ro de la partition. Cr\u00e9ation des partitions \u00b6 Liste des partitions \u00b6 1 partition swap 1 partition filesystem 3 partition LVM 3 partitions RAID Commande : fdisk /dev/sdb Pour acc\u00e8der au menu : m pour l'aide de la commande Cr\u00e9ation de la nouvelle table en GPT : g Cr\u00e9ation de la nouvelle partition : n -> Num\u00e9ro de partition -> Premier secteur -> Dernier secteur (possibilit\u00e9 de mettre un espace en K,M,G,T,P) Cr\u00e9ation du type de la partition : t -> Num\u00e9ro de la partition \u00e0 modifier -> Num\u00e9ro ou alias de type de partition Mise en place de sauvegarde \u00b6 Mise en place de l'archive de sauvegarde \u00b6 Sauvegarde : tar -cvz -f /home.tar.gz /home -> -c = Cr\u00e9ation d'archive -> -v = Verbose -> -z = Compression du fichier -> -f = Nom de l'archive (Toujours cette option en derni\u00e8re) Test de l'archive : tar -tf /home.tar.gz -> -t = pour tester l'archive -> -f = sp\u00e9cification du fichier (Toujours cette option en derni\u00e8re) Mise en place du nouveau /home \u00b6 Vidange du r\u00e9pertoire \u00b6 Plusieurs fa\u00e7on de vider le r\u00e9pertoire /home : rm -rf /home ; mkdir /home ou rm -rf /home/* Attention \u00e0 ne pas mettre d'espace entre / et home car cela supprimerais tout le syst\u00e8me de fichier. Mise en place du formatage \u00b6 Formatage en EXT4 pour la partition FileSystem : mkfs.ext4 /dev/sdb2 Message d'erreur si la partition est d\u00e9j\u00e0 format\u00e9e Obtenir l'UUID d'une partition : lsblk -o uuid -n /dev/sdb2 Modification de fstab : nano /etc/fstab Montage de la partition et test si fstab est correct: sudo mount -av Restauration de l'archive \u00b6 sudo tar -C / -xf /home.tar.gz ls -l /home Vigilance sur la taille du syst\u00e8me de fichier sinon l'extraction ne focntionnera pas. LVM \u00b6 Commandes LVM2 \u00b6 Scan des partitions LVM : pvs alias => pvscan Cr\u00e9ation disques physiques pour les volumes logiques : pvcreate /dev/sdb3 /dev/sdb4 /dev/sdb5 alias => pvcreate /dev/sdb{3..5} Cr\u00e9ation d'un volume logique vgdata vgcreate vgdata /dev/sdb3 lsblk pour affihcer tout les volumes VG => Volume groupe L'extention de VG prends des volumes physiques sudo vgextend vgdata /dev/sdb4 LV => Logical Volume - pour utiliser les commandes \u00e0 partir de PV.... , on parle de volume physique. PV => Physical volume Commandes pour afficher les volumes \u00b6 pvscan lvscan pvscan Suppression des volumes \u00b6 La suppression des volumes entraine la suppression des donn\u00e9es stock\u00e9es sur le logical volume D\u00e9montage des volumes en premier : unmount \\data Suppression du volume logique : lvremove /dev/rootvg/lvdata Suppression du volume groupe : vgremove /dev/rootvg Suppression des volumes physique : pvremove /dev/sdb3 /dev/sdb4 /dev/sdb5 Modification du fstab pour ne pas demarrer en mode recovery RAID \u00b6 Installation \u00b6 Installation via ansible \u00b6 Installer ansible apt install ansible Installation de mdadm : ansible localhost -m package -a \"name=mdadm state=latest\" Cr\u00e9ation du raid \u00b6 Mise en place du raid avec 1 disque manaquant (d'o\u00f9 l'option missing ) : mdadm --create /dev/md0 --level 1 --raid-device 2 /dev/sdb6 missing Status du raid : mdadm --detail /dev/md0 Ajout d'un disque : mdadm --manage /dev/md0 --add /dev/sdb7 Disque HS : mdadm /dev/md0 --fail /dev/sdb6 Retirer le disque : mdadm /dev/md0 --remove /dev/sdb6 Montage de /data via ansible : ansible localhost -m mount -a \"src=/dev/md0 path=/data state=mounted\" Recherche dans la doc ansible-doc -l |grep -i --color filesystem Montage via l'UUID : ansible localhost -m mount -a \"src= '-U 07684c31-dd62-45be-82bb-a72cae950930 name=/data fstype=ext4 state=present'\" formatage avec l'UUID : ansible localhost -m filesystem -a \"dev=/dev/md0 fstype=ext4 state=present opts='-U 06b4a9c3-9487-4685-a672-d28b6df2b5f6'\" cible de anible playbook : ansible-playbook make-filesystem.yml Deployment ansible \u00b6 G\u00e9n\u00e9ration des cl\u00e9s SSH \u00b6 G\u00e9n\u00e9ration de la cl\u00e9 : ssh-keygen Mise en place de la cl\u00e9 : ssh-copy-id 127.0.0.1 Demande une derni\u00e8re fois un mot de passe pour confirmer l'ajout Mise en place des privil\u00e8ges : nano /etc/sudoers # User privilege specification root ALL =( ALL:ALL ) NOPASSWD: ALL # Allow members of group sudo to execute any command %sudo ALL =( ALL:ALL ) NOPASSWD: ALL rajout de l'option NOPASSWD: Test ansible ping \u00b6 Mise en place de l'inventaire : echo \"debian-locale ansible_host=127.0.0.1\" >> inventaire.txt Dans le fichier ansible.cfg , ajout de redirecteurs : 1 2 3 4 [defaults] deprecation_warnings = False //enl\u00e8vement des warnings inventory = inventaire.txt // redirecteur Commande de ping : ansible all -m ping -o Boot d'une machine \u00b6 D\u00e9marrage \u00b6 MBR : Master boot record Sous windows on utilise pas le bootloader. On va utiliser le premier secteur bootable sur le disque. (pas de programme d'ammorcage) RO = Read only dans les options de d\u00e9marrage D\u00e9marrage du syst\u00e8me : Construction du syst\u00e8me de base D\u00e9marrage des services Lancements de taches dites \"supervis\u00e9e\" comme le lancement d'une session Systemctl status permet d'obtenir des informations globalement sur la machine et donne l'\u00e9tat g\u00e9n\u00e9ral de tout les services lanc\u00e9s avec ceux qui sont failed et running. Mise en place d'un /data avec /etc/systemd/system/data.mount : 1 2 3 4 5 6 7 8 [Unit] [Mount] What = UUID=915bcbeb-c17a-44e9-9e4f-beb8b79b724c Where = /data Type = ext4 Options = defaults Passage avec ansible \u00b6 Mise en place de l'invetaire en yml avec ansible-inventory -y --list (option -y pour yaml/yml) Modification du fichier ansible.cfg pour int\u00e9grer l'invetaire en yml 1 2 3 4 [defaults] deprecation_warnings = False //enl\u00e8vement des warnings inventory = inventaire.yml // redirecteur Timer \u00b6 sudo nano /etc/systemd/system/compteur.timer Modifier une conf \u00b6 systemctl edit xx.socket Logs \u00b6 Mise en place de rsyslog avec envoi de msg sur un autre serveur \u00b6 Installation du package rsyslog-relp avec apt. Modification de la conf de /etc/rsyslog.conf : module(load=\"omrelp\") module(load=\"immark\" interval=\"180\") local1.info :omrelp:IP:PORT envoi d'un msg sudo logger -p local1.info -t \"tag-du-jour\" \"J'ai r\u00e9ussi \" Mise en place avec Ansible \u00b6 Mise en place d'un dossier roles mkdir roles Cr\u00e9ation des fichier li\u00e9s au roles ansible-galaxy role init roles/rsyslog Fichier de configuration des tasks 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 --- # tasks file for roles/rsyslog - name: maj derni\u00e8re version apt: name: \"*\" state: latest - name: install Rsyslog package: name: rsyslog state: latest - name: install Rsyslog_relp package: name: rsyslog-relp state: latest - name: D\u00e9marrer et activer rsyslog ansible.builtin.service: name: \"{{ rsyslog_service }}\" state: started enabled: yes - name: Mise en place de la Config template: src: rsyslog_relp.j2 dest: \"/etc/rsyslog.d/rsyslog-relp.conf\" owner: root group: root mode: \"0644\" notify: restart-rsyslog Mise en place des des variables dans defaults : 1 2 relp_port: 0000 relp_server: 1.2.3.4 Configuration d'un template : 1 2 3 4 5 6 7 8 9 [Unit] Description= Mise en place de RELP [Service] module(load=\"omrelp\") module(load=\"immark\" interval=\"180\") *.info :omrelp:{{relp_server}}:{{relp_port}} Logs \u00b6 Plusieurs application de logs : journalctl rsyslog => Les configuruations de rsyslog permettent de pouvoir conserver des donn\u00e9es suivant le poids d'un fichier, le nombre de jours, ...","title":"Mise en place des partitions"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#mise-en-place-des-partitions","text":"","title":"Mise en place des partitions"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#decouverte-des-disques","text":"","title":"D\u00e9couverte des disques"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#emplacement-des-disques","text":"/dev/sda sda = Premier disque sdb = Second disque De mani\u00e8re g\u00e9n\u00e9rale sd x avec le x qui est le disque (par ordre aphab\u00e9tique)","title":"Emplacement des disques"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#partitions-des-disques","text":"/dev/sda1 sda1 = Premi\u00e8re partition du disque sda2 = Seconde partition du disque De mani\u00e8re g\u00e9\u00e9nrale sd x z avec z qui le num\u00e9ro de la partition.","title":"Partitions des disques"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#creation-des-partitions","text":"","title":"Cr\u00e9ation des partitions"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#liste-des-partitions","text":"1 partition swap 1 partition filesystem 3 partition LVM 3 partitions RAID Commande : fdisk /dev/sdb Pour acc\u00e8der au menu : m pour l'aide de la commande Cr\u00e9ation de la nouvelle table en GPT : g Cr\u00e9ation de la nouvelle partition : n -> Num\u00e9ro de partition -> Premier secteur -> Dernier secteur (possibilit\u00e9 de mettre un espace en K,M,G,T,P) Cr\u00e9ation du type de la partition : t -> Num\u00e9ro de la partition \u00e0 modifier -> Num\u00e9ro ou alias de type de partition","title":"Liste des partitions"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#mise-en-place-de-sauvegarde","text":"","title":"Mise en place de sauvegarde"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#mise-en-place-de-larchive-de-sauvegarde","text":"Sauvegarde : tar -cvz -f /home.tar.gz /home -> -c = Cr\u00e9ation d'archive -> -v = Verbose -> -z = Compression du fichier -> -f = Nom de l'archive (Toujours cette option en derni\u00e8re) Test de l'archive : tar -tf /home.tar.gz -> -t = pour tester l'archive -> -f = sp\u00e9cification du fichier (Toujours cette option en derni\u00e8re)","title":"Mise en place de l'archive de sauvegarde"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#mise-en-place-du-nouveau-home","text":"","title":"Mise en place du nouveau /home"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#vidange-du-repertoire","text":"Plusieurs fa\u00e7on de vider le r\u00e9pertoire /home : rm -rf /home ; mkdir /home ou rm -rf /home/* Attention \u00e0 ne pas mettre d'espace entre / et home car cela supprimerais tout le syst\u00e8me de fichier.","title":"Vidange du r\u00e9pertoire"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#mise-en-place-du-formatage","text":"Formatage en EXT4 pour la partition FileSystem : mkfs.ext4 /dev/sdb2 Message d'erreur si la partition est d\u00e9j\u00e0 format\u00e9e Obtenir l'UUID d'une partition : lsblk -o uuid -n /dev/sdb2 Modification de fstab : nano /etc/fstab Montage de la partition et test si fstab est correct: sudo mount -av","title":"Mise en place du formatage"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#restauration-de-larchive","text":"sudo tar -C / -xf /home.tar.gz ls -l /home Vigilance sur la taille du syst\u00e8me de fichier sinon l'extraction ne focntionnera pas.","title":"Restauration de l'archive"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#lvm","text":"","title":"LVM"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#commandes-lvm2","text":"Scan des partitions LVM : pvs alias => pvscan Cr\u00e9ation disques physiques pour les volumes logiques : pvcreate /dev/sdb3 /dev/sdb4 /dev/sdb5 alias => pvcreate /dev/sdb{3..5} Cr\u00e9ation d'un volume logique vgdata vgcreate vgdata /dev/sdb3 lsblk pour affihcer tout les volumes VG => Volume groupe L'extention de VG prends des volumes physiques sudo vgextend vgdata /dev/sdb4 LV => Logical Volume - pour utiliser les commandes \u00e0 partir de PV.... , on parle de volume physique. PV => Physical volume","title":"Commandes LVM2"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#commandes-pour-afficher-les-volumes","text":"pvscan lvscan pvscan","title":"Commandes pour afficher les volumes"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#suppression-des-volumes","text":"La suppression des volumes entraine la suppression des donn\u00e9es stock\u00e9es sur le logical volume D\u00e9montage des volumes en premier : unmount \\data Suppression du volume logique : lvremove /dev/rootvg/lvdata Suppression du volume groupe : vgremove /dev/rootvg Suppression des volumes physique : pvremove /dev/sdb3 /dev/sdb4 /dev/sdb5 Modification du fstab pour ne pas demarrer en mode recovery","title":"Suppression des volumes"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#raid","text":"","title":"RAID"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#installation","text":"","title":"Installation"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#installation-via-ansible","text":"Installer ansible apt install ansible Installation de mdadm : ansible localhost -m package -a \"name=mdadm state=latest\"","title":"Installation via ansible"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#creation-du-raid","text":"Mise en place du raid avec 1 disque manaquant (d'o\u00f9 l'option missing ) : mdadm --create /dev/md0 --level 1 --raid-device 2 /dev/sdb6 missing Status du raid : mdadm --detail /dev/md0 Ajout d'un disque : mdadm --manage /dev/md0 --add /dev/sdb7 Disque HS : mdadm /dev/md0 --fail /dev/sdb6 Retirer le disque : mdadm /dev/md0 --remove /dev/sdb6 Montage de /data via ansible : ansible localhost -m mount -a \"src=/dev/md0 path=/data state=mounted\" Recherche dans la doc ansible-doc -l |grep -i --color filesystem Montage via l'UUID : ansible localhost -m mount -a \"src= '-U 07684c31-dd62-45be-82bb-a72cae950930 name=/data fstype=ext4 state=present'\" formatage avec l'UUID : ansible localhost -m filesystem -a \"dev=/dev/md0 fstype=ext4 state=present opts='-U 06b4a9c3-9487-4685-a672-d28b6df2b5f6'\" cible de anible playbook : ansible-playbook make-filesystem.yml","title":"Cr\u00e9ation du raid"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#deployment-ansible","text":"","title":"Deployment ansible"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#generation-des-cles-ssh","text":"G\u00e9n\u00e9ration de la cl\u00e9 : ssh-keygen Mise en place de la cl\u00e9 : ssh-copy-id 127.0.0.1 Demande une derni\u00e8re fois un mot de passe pour confirmer l'ajout Mise en place des privil\u00e8ges : nano /etc/sudoers # User privilege specification root ALL =( ALL:ALL ) NOPASSWD: ALL # Allow members of group sudo to execute any command %sudo ALL =( ALL:ALL ) NOPASSWD: ALL rajout de l'option NOPASSWD:","title":"G\u00e9n\u00e9ration des cl\u00e9s SSH"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#test-ansible-ping","text":"Mise en place de l'inventaire : echo \"debian-locale ansible_host=127.0.0.1\" >> inventaire.txt Dans le fichier ansible.cfg , ajout de redirecteurs : 1 2 3 4 [defaults] deprecation_warnings = False //enl\u00e8vement des warnings inventory = inventaire.txt // redirecteur Commande de ping : ansible all -m ping -o","title":"Test ansible ping"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#boot-dune-machine","text":"","title":"Boot d'une machine"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#demarrage","text":"MBR : Master boot record Sous windows on utilise pas le bootloader. On va utiliser le premier secteur bootable sur le disque. (pas de programme d'ammorcage) RO = Read only dans les options de d\u00e9marrage D\u00e9marrage du syst\u00e8me : Construction du syst\u00e8me de base D\u00e9marrage des services Lancements de taches dites \"supervis\u00e9e\" comme le lancement d'une session Systemctl status permet d'obtenir des informations globalement sur la machine et donne l'\u00e9tat g\u00e9n\u00e9ral de tout les services lanc\u00e9s avec ceux qui sont failed et running. Mise en place d'un /data avec /etc/systemd/system/data.mount : 1 2 3 4 5 6 7 8 [Unit] [Mount] What = UUID=915bcbeb-c17a-44e9-9e4f-beb8b79b724c Where = /data Type = ext4 Options = defaults","title":"D\u00e9marrage"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#passage-avec-ansible","text":"Mise en place de l'invetaire en yml avec ansible-inventory -y --list (option -y pour yaml/yml) Modification du fichier ansible.cfg pour int\u00e9grer l'invetaire en yml 1 2 3 4 [defaults] deprecation_warnings = False //enl\u00e8vement des warnings inventory = inventaire.yml // redirecteur","title":"Passage avec ansible"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#timer","text":"sudo nano /etc/systemd/system/compteur.timer","title":"Timer"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#modifier-une-conf","text":"systemctl edit xx.socket","title":"Modifier une conf"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#logs","text":"","title":"Logs"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#mise-en-place-de-rsyslog-avec-envoi-de-msg-sur-un-autre-serveur","text":"Installation du package rsyslog-relp avec apt. Modification de la conf de /etc/rsyslog.conf : module(load=\"omrelp\") module(load=\"immark\" interval=\"180\") local1.info :omrelp:IP:PORT envoi d'un msg sudo logger -p local1.info -t \"tag-du-jour\" \"J'ai r\u00e9ussi \"","title":"Mise en place de rsyslog avec envoi de msg sur un autre serveur"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#mise-en-place-avec-ansible","text":"Mise en place d'un dossier roles mkdir roles Cr\u00e9ation des fichier li\u00e9s au roles ansible-galaxy role init roles/rsyslog Fichier de configuration des tasks 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 --- # tasks file for roles/rsyslog - name: maj derni\u00e8re version apt: name: \"*\" state: latest - name: install Rsyslog package: name: rsyslog state: latest - name: install Rsyslog_relp package: name: rsyslog-relp state: latest - name: D\u00e9marrer et activer rsyslog ansible.builtin.service: name: \"{{ rsyslog_service }}\" state: started enabled: yes - name: Mise en place de la Config template: src: rsyslog_relp.j2 dest: \"/etc/rsyslog.d/rsyslog-relp.conf\" owner: root group: root mode: \"0644\" notify: restart-rsyslog Mise en place des des variables dans defaults : 1 2 relp_port: 0000 relp_server: 1.2.3.4 Configuration d'un template : 1 2 3 4 5 6 7 8 9 [Unit] Description= Mise en place de RELP [Service] module(load=\"omrelp\") module(load=\"immark\" interval=\"180\") *.info :omrelp:{{relp_server}}:{{relp_port}}","title":"Mise en place avec Ansible"},{"location":"Linux/Bachelor/Partionnement/Partition_LVM/#logs_1","text":"Plusieurs application de logs : journalctl rsyslog => Les configuruations de rsyslog permettent de pouvoir conserver des donn\u00e9es suivant le poids d'un fichier, le nombre de jours, ...","title":"Logs"},{"location":"Linux/Bachelor/Partionnement/RAID/","text":"RAID \u00b6 Installation \u00b6 Installation via ansible \u00b6 Installer ansible apt install ansible Installation de mdadm : ansible localhost -m package -a \"name=mdadm state=latest\" Cr\u00e9ation du raid \u00b6 Mise en place du raid avec 1 disque manaquant (d'o\u00f9 l'option missing ) : mdadm --create /dev/md0 --level 1 --raid-device 2 /dev/sdb6 missing Status du raid : mdadm --detail /dev/md0 Ajout d'un disque : mdadm --manage /dev/md0 --add /dev/sdb7 Disque HS : mdadm /dev/md0 --fail /dev/sdb6 Retirer le disque : mdadm /dev/md0 --remove /dev/sdb6 Montage de /data via ansible : ansible localhost -m mount -a \"src=/dev/md0 path=/data state=mounted\" Recherche dans la doc ansible-doc -l |grep -i --color filesystem Montage via l'UUID : ansible localhost -m mount -a \"src= '-U 07684c31-dd62-45be-82bb-a72cae950930 name=/data fstype=ext4 state=present'\" formatage avec l'UUID : ansible localhost -m filesystem -a \"dev=/dev/md0 fstype=ext4 state=present opts='-U 06b4a9c3-9487-4685-a672-d28b6df2b5f6'\" cible de anible playbook : ansible-playbook make-filesystem.yml","title":"RAID"},{"location":"Linux/Bachelor/Partionnement/RAID/#raid","text":"","title":"RAID"},{"location":"Linux/Bachelor/Partionnement/RAID/#installation","text":"","title":"Installation"},{"location":"Linux/Bachelor/Partionnement/RAID/#installation-via-ansible","text":"Installer ansible apt install ansible Installation de mdadm : ansible localhost -m package -a \"name=mdadm state=latest\"","title":"Installation via ansible"},{"location":"Linux/Bachelor/Partionnement/RAID/#creation-du-raid","text":"Mise en place du raid avec 1 disque manaquant (d'o\u00f9 l'option missing ) : mdadm --create /dev/md0 --level 1 --raid-device 2 /dev/sdb6 missing Status du raid : mdadm --detail /dev/md0 Ajout d'un disque : mdadm --manage /dev/md0 --add /dev/sdb7 Disque HS : mdadm /dev/md0 --fail /dev/sdb6 Retirer le disque : mdadm /dev/md0 --remove /dev/sdb6 Montage de /data via ansible : ansible localhost -m mount -a \"src=/dev/md0 path=/data state=mounted\" Recherche dans la doc ansible-doc -l |grep -i --color filesystem Montage via l'UUID : ansible localhost -m mount -a \"src= '-U 07684c31-dd62-45be-82bb-a72cae950930 name=/data fstype=ext4 state=present'\" formatage avec l'UUID : ansible localhost -m filesystem -a \"dev=/dev/md0 fstype=ext4 state=present opts='-U 06b4a9c3-9487-4685-a672-d28b6df2b5f6'\" cible de anible playbook : ansible-playbook make-filesystem.yml","title":"Cr\u00e9ation du raid"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/","text":"Deployment ansible \u00b6 G\u00e9n\u00e9ration des cl\u00e9s SSH \u00b6 G\u00e9n\u00e9ration de la cl\u00e9 : ssh-keygen Mise en place de la cl\u00e9 : ssh-copy-id 127.0.0.1 Demande une derni\u00e8re fois un mot de passe pour confirmer l'ajout Mise en place des privil\u00e8ges : nano /etc/sudoers # User privilege specification root ALL =( ALL:ALL ) NOPASSWD: ALL # Allow members of group sudo to execute any command %sudo ALL =( ALL:ALL ) NOPASSWD: ALL rajout de l'option NOPASSWD: Test ansible ping \u00b6 Mise en place de l'inventaire : echo \"debian-locale ansible_host=127.0.0.1\" >> inventaire.txt Dans le fichier ansible.cfg , ajout de redirecteurs : 1 2 3 4 [defaults] deprecation_warnings = False //enl\u00e8vement des warnings inventory = inventaire.txt // redirecteur Commande de ping : ansible all -m ping -o Boot d'une machine \u00b6 D\u00e9marrage \u00b6 MBR : Master boot record Sous windows on utilise pas le bootloader. On va utiliser le premier secteur bootable sur le disque. (pas de programme d'ammorcage) RO = Read only dans les options de d\u00e9marrage D\u00e9marrage du syst\u00e8me : Construction du syst\u00e8me de base D\u00e9marrage des services Lancements de taches dites \"supervis\u00e9e\" comme le lancement d'une session Systemctl status permet d'obtenir des informations globalement sur la machine et donne l'\u00e9tat g\u00e9n\u00e9ral de tout les services lanc\u00e9s avec ceux qui sont failed et running. Mise en place d'un /data avec /etc/systemd/system/data.mount : 1 2 3 4 5 6 7 8 [Unit] [Mount] What = UUID=915bcbeb-c17a-44e9-9e4f-beb8b79b724c Where = /data Type = ext4 Options = defaults Passage avec ansible \u00b6 Mise en place de l'invetaire en yml avec ansible-inventory -y --list (option -y pour yaml/yml) Modification du fichier ansible.cfg pour int\u00e9grer l'invetaire en yml 1 2 3 4 [defaults] deprecation_warnings = False //enl\u00e8vement des warnings inventory = inventaire.yml // redirecteur Timer \u00b6 sudo nano /etc/systemd/system/compteur.timer Modifier une conf \u00b6 systemctl edit xx.socket Logs \u00b6 Mise en place de rsyslog avec envoi de msg sur un autre serveur \u00b6 Installation du package rsyslog-relp avec apt. Modification de la conf de /etc/rsyslog.conf : module(load=\"omrelp\") module(load=\"immark\" interval=\"180\") local1.info :omrelp:IP:PORT envoi d'un msg sudo logger -p local1.info -t \"tag-du-jour\" \"J'ai r\u00e9ussi \" Mise en place avec Ansible \u00b6 Mise en place d'un dossier roles mkdir roles Cr\u00e9ation des fichier li\u00e9s au roles ansible-galaxy role init roles/rsyslog Fichier de configuration des tasks 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 --- # tasks file for roles/rsyslog - name: maj derni\u00e8re version apt: name: \"*\" state: latest - name: install Rsyslog package: name: rsyslog state: latest - name: install Rsyslog_relp package: name: rsyslog-relp state: latest - name: D\u00e9marrer et activer rsyslog ansible.builtin.service: name: \"{{ rsyslog_service }}\" state: started enabled: yes - name: Mise en place de la Config template: src: rsyslog_relp.j2 dest: \"/etc/rsyslog.d/rsyslog-relp.conf\" owner: root group: root mode: \"0644\" notify: restart-rsyslog Mise en place des des variables dans defaults : 1 2 relp_port: 0000 relp_server: 1.2.3.4 Configuration d'un template : 1 2 3 4 5 6 7 8 9 [Unit] Description= Mise en place de RELP [Service] module(load=\"omrelp\") module(load=\"immark\" interval=\"180\") *.info :omrelp:{{relp_server}}:{{relp_port}} Logs \u00b6 Plusieurs application de logs : journalctl rsyslog => Les configuruations de rsyslog permettent de pouvoir conserver des donn\u00e9es suivant le poids d'un fichier, le nombre de jours, ...","title":"Deployment ansible"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#deployment-ansible","text":"","title":"Deployment ansible"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#generation-des-cles-ssh","text":"G\u00e9n\u00e9ration de la cl\u00e9 : ssh-keygen Mise en place de la cl\u00e9 : ssh-copy-id 127.0.0.1 Demande une derni\u00e8re fois un mot de passe pour confirmer l'ajout Mise en place des privil\u00e8ges : nano /etc/sudoers # User privilege specification root ALL =( ALL:ALL ) NOPASSWD: ALL # Allow members of group sudo to execute any command %sudo ALL =( ALL:ALL ) NOPASSWD: ALL rajout de l'option NOPASSWD:","title":"G\u00e9n\u00e9ration des cl\u00e9s SSH"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#test-ansible-ping","text":"Mise en place de l'inventaire : echo \"debian-locale ansible_host=127.0.0.1\" >> inventaire.txt Dans le fichier ansible.cfg , ajout de redirecteurs : 1 2 3 4 [defaults] deprecation_warnings = False //enl\u00e8vement des warnings inventory = inventaire.txt // redirecteur Commande de ping : ansible all -m ping -o","title":"Test ansible ping"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#boot-dune-machine","text":"","title":"Boot d'une machine"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#demarrage","text":"MBR : Master boot record Sous windows on utilise pas le bootloader. On va utiliser le premier secteur bootable sur le disque. (pas de programme d'ammorcage) RO = Read only dans les options de d\u00e9marrage D\u00e9marrage du syst\u00e8me : Construction du syst\u00e8me de base D\u00e9marrage des services Lancements de taches dites \"supervis\u00e9e\" comme le lancement d'une session Systemctl status permet d'obtenir des informations globalement sur la machine et donne l'\u00e9tat g\u00e9n\u00e9ral de tout les services lanc\u00e9s avec ceux qui sont failed et running. Mise en place d'un /data avec /etc/systemd/system/data.mount : 1 2 3 4 5 6 7 8 [Unit] [Mount] What = UUID=915bcbeb-c17a-44e9-9e4f-beb8b79b724c Where = /data Type = ext4 Options = defaults","title":"D\u00e9marrage"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#passage-avec-ansible","text":"Mise en place de l'invetaire en yml avec ansible-inventory -y --list (option -y pour yaml/yml) Modification du fichier ansible.cfg pour int\u00e9grer l'invetaire en yml 1 2 3 4 [defaults] deprecation_warnings = False //enl\u00e8vement des warnings inventory = inventaire.yml // redirecteur","title":"Passage avec ansible"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#timer","text":"sudo nano /etc/systemd/system/compteur.timer","title":"Timer"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#modifier-une-conf","text":"systemctl edit xx.socket","title":"Modifier une conf"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#logs","text":"","title":"Logs"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#mise-en-place-de-rsyslog-avec-envoi-de-msg-sur-un-autre-serveur","text":"Installation du package rsyslog-relp avec apt. Modification de la conf de /etc/rsyslog.conf : module(load=\"omrelp\") module(load=\"immark\" interval=\"180\") local1.info :omrelp:IP:PORT envoi d'un msg sudo logger -p local1.info -t \"tag-du-jour\" \"J'ai r\u00e9ussi \"","title":"Mise en place de rsyslog avec envoi de msg sur un autre serveur"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#mise-en-place-avec-ansible","text":"Mise en place d'un dossier roles mkdir roles Cr\u00e9ation des fichier li\u00e9s au roles ansible-galaxy role init roles/rsyslog Fichier de configuration des tasks 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 --- # tasks file for roles/rsyslog - name: maj derni\u00e8re version apt: name: \"*\" state: latest - name: install Rsyslog package: name: rsyslog state: latest - name: install Rsyslog_relp package: name: rsyslog-relp state: latest - name: D\u00e9marrer et activer rsyslog ansible.builtin.service: name: \"{{ rsyslog_service }}\" state: started enabled: yes - name: Mise en place de la Config template: src: rsyslog_relp.j2 dest: \"/etc/rsyslog.d/rsyslog-relp.conf\" owner: root group: root mode: \"0644\" notify: restart-rsyslog Mise en place des des variables dans defaults : 1 2 relp_port: 0000 relp_server: 1.2.3.4 Configuration d'un template : 1 2 3 4 5 6 7 8 9 [Unit] Description= Mise en place de RELP [Service] module(load=\"omrelp\") module(load=\"immark\" interval=\"180\") *.info :omrelp:{{relp_server}}:{{relp_port}}","title":"Mise en place avec Ansible"},{"location":"Linux/Bachelor/deploiement_ansible/Ansible/#logs_1","text":"Plusieurs application de logs : journalctl rsyslog => Les configuruations de rsyslog permettent de pouvoir conserver des donn\u00e9es suivant le poids d'un fichier, le nombre de jours, ...","title":"Logs"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/","text":"Installation de Centos \u00b6 kickstart (redhat) = methode d'installation qui permet de faire passer les questions d'installation utilisation avec la modification de l'ecran d'installation Proc\u00e9dure \u00b6 installation manuellement R\u00e9cuparation du fichier /rot/anaconda-ks.cfg --> /srv/ks.cfg Mettre le fichier \u00e0 disposition avec un client http = conteneur docker Installation nouvelle VM avec l'utilisation du fichier KS inst.ks=https://...../ks.cfg si probl\u00e8me r\u00e9solution : inst.resolution=1080x1920 Cahier des charges \u00b6 3 partitions : /boot : 500Mo, format ext2 Swap : 1Go Syst\u00e8me de fichier racine (/), ext4, 3 Go, mais sur du LVM, volume groupe = rootvg, volume logique = rootlv Rappels \u00b6 LVM : Logical Volume Manager PV : Physical volume VG : Volume Volume (prends l'int\u00e9gralit\u00e9 des PV) LG : Logical Volume (Volumes logiques cr\u00e9es sur le VG et permet d'utiliser des systemes de fichier diff\u00e9rents) exemples : LV1 /leo (ext4) LV2 /data1 (EXT3) LV3 /data2 (EXT4) Sch\u00e9ma de LVM Modification du nom de la machine Dans le fichier /etc/hostname , on peux changer le nom ou avec la commande hostname set-hostname nomdelamachine Installation CENTOS9 \u00b6 Choix du clavier Mise en place du partitionnement Installation docker \u00b6 Rappel sur docker Site de documentation docker : https://docs.docker.com Selon la firme de recherche sur l'industrie 451 Research, \u00ab Docker est un outil qui peut empaqueter une application et ses d\u00e9pendances dans un conteneur isol\u00e9, qui pourra \u00eatre ex\u00e9cut\u00e9 sur n'importe quel serveur \u00bb. Il ne s'agit pas de virtualisation, mais de conteneurisation, une forme plus l\u00e9g\u00e8re qui s'appuie sur certaines parties de la machine h\u00f4te pour son fonctionnement. Copier le fichier ananconda cp anaconda-ks.cfg /srv/kickstart/ks.cfg installer docker avec CURL curl -sSL https://get.docker.com | sudo bash ou sinon : curl -sSl -o get-docker.sh https://get.docker.com controle : get-docker.sh execution : bash get-docker.sh Demarrage et automatisation de docker au boot systemctl enable --now docker.service D\u00e9marrage d'un conteneur de serveur web Apache - > docker container run -d --name websrv --publish 80:80 --volume /srv/kickstart:/usr/local/apache2/htdocs httpd Ngnix - > docker container run -d --name websrv --publish 80:80 --volume /srv/kickstart:/usr/share/nginx/html nginx Verficiation des user dans docker docker container top websrv Mise \u00e0 jour des permissions chmod 644 /srv/kickstart/ks.cfg Installation de micro curl https://getmic.ro | bash mv micro /usr/local/bin ln -s /usr/local/bin/micro /usr/local/sbin/micro Changement pour enlever le mot de passe de user sed -i -e '/ %wheel/s, ,# ,' -e '/^# %wheel.*NOPASSWD/s,^# ,,' /etc/sudoers Le -i prend en compte pour l'execution Mise en place de l'anaconda pour installer d'autres machines \u00b6 Cahier des charges \u00b6 \"micro\" doit etre install\u00e9 dans /usr/local/bin Lien symbolique dans /usr/local/bin User n'a pas \u00e0 s'identifier pour sudo ... No PASSWD On ne peut se connecter en trannt que \"user\" avec une cl\u00e9 punlique definie ici Extention du volume groupe \u00b6 Cr\u00e9ation du volume dans le sdb pvcreate /dev/sdb Extentention du volume groupe sur le nouveau disque vgextend /dev/rootvg /dev/sdb Extention du volume logique lvextend -l 100%FREE -r /dev/rootvg/rootlv modification du SSH \u00b6 Cr\u00e9ation des dossier ssh (/.ssh/authorized_keys) .ssh avec les droits 700 authorized_keys avec les droits 600 Exemple de fichier anaconda : # Generated by Anaconda 34.25.2.2 # Generated by pykickstart v3.32 #version=RHEL9 # Use graphical install graphical repo --name = \"AppStream\" --baseurl=file:///run/install/sources/mount-0000-cdrom/AppStream %addon com_redhat_kdump --enable --reserve-mb = 'auto' %end # Keyboard layouts keyboard --xlayouts = 'fr (oss)' # System language lang fr_FR.UTF-8 # Network information network --hostname = LG-stream9-1.local # Use CDROM installation media cdrom %packages @^minimal-environment %end # Run the Setup Agent on first boot firstboot --enable # Generated using Blivet version 3.6.0 ignoredisk --only-use = sda # Partition clearing information clearpart --none --initlabel # Disk partitioning information part pv.1220 --fstype = \"lvmpv\" --ondisk=sda --size=7690 part /boot/efi --fstype = \"efi\" --ondisk=sda --size=1024 --fsoptions=\"umask=0077,shortname=winnt\" part swap --fstype = \"swap\" --ondisk=sda --size=1024 part /boot --fstype = \"ext2\" --ondisk=sda --size=500 volgroup rootvg --pesize = 4096 pv.1220 logvol / --fstype = \"ext4\" --size=3072 --name=rootlv --vgname=rootvg # System timezone timezone Europe/Paris --utc # Root password rootpw --iscrypted --allow-ssh $6$2y5hbbXM4dYt4c0v$usoQguNqD5QySTU5sbwDHMPuHU4tBs0mwPqUU574s83Vr1Tz5aJ//zIwtIEPdqsaTwpiBDQwnT.LQ/9PMC95o. user --groups = wheel --name=user --password=$6$IW2fEdwd1zcdKMCW$ecnGuYPR.PvRDy354ttoEJbnYuFHJm9HpAA6ZT2sHF2sqGEsHWnvnAYdvr6EdVFipZKkjchbaQOMyRERyZAR91 --iscrypted --gecos=\"user\" Debian \u00b6 Preseed (debian) = methode d'installation qui permet de faire passer les questions d'installation","title":"Installation de Centos"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#installation-de-centos","text":"kickstart (redhat) = methode d'installation qui permet de faire passer les questions d'installation utilisation avec la modification de l'ecran d'installation","title":"Installation de Centos"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#procedure","text":"installation manuellement R\u00e9cuparation du fichier /rot/anaconda-ks.cfg --> /srv/ks.cfg Mettre le fichier \u00e0 disposition avec un client http = conteneur docker Installation nouvelle VM avec l'utilisation du fichier KS inst.ks=https://...../ks.cfg si probl\u00e8me r\u00e9solution : inst.resolution=1080x1920","title":"Proc\u00e9dure"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#cahier-des-charges","text":"3 partitions : /boot : 500Mo, format ext2 Swap : 1Go Syst\u00e8me de fichier racine (/), ext4, 3 Go, mais sur du LVM, volume groupe = rootvg, volume logique = rootlv","title":"Cahier des charges"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#rappels","text":"LVM : Logical Volume Manager PV : Physical volume VG : Volume Volume (prends l'int\u00e9gralit\u00e9 des PV) LG : Logical Volume (Volumes logiques cr\u00e9es sur le VG et permet d'utiliser des systemes de fichier diff\u00e9rents) exemples : LV1 /leo (ext4) LV2 /data1 (EXT3) LV3 /data2 (EXT4) Sch\u00e9ma de LVM Modification du nom de la machine Dans le fichier /etc/hostname , on peux changer le nom ou avec la commande hostname set-hostname nomdelamachine","title":"Rappels"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#installation-centos9","text":"Choix du clavier Mise en place du partitionnement","title":"Installation CENTOS9"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#installation-docker","text":"Rappel sur docker Site de documentation docker : https://docs.docker.com Selon la firme de recherche sur l'industrie 451 Research, \u00ab Docker est un outil qui peut empaqueter une application et ses d\u00e9pendances dans un conteneur isol\u00e9, qui pourra \u00eatre ex\u00e9cut\u00e9 sur n'importe quel serveur \u00bb. Il ne s'agit pas de virtualisation, mais de conteneurisation, une forme plus l\u00e9g\u00e8re qui s'appuie sur certaines parties de la machine h\u00f4te pour son fonctionnement. Copier le fichier ananconda cp anaconda-ks.cfg /srv/kickstart/ks.cfg installer docker avec CURL curl -sSL https://get.docker.com | sudo bash ou sinon : curl -sSl -o get-docker.sh https://get.docker.com controle : get-docker.sh execution : bash get-docker.sh Demarrage et automatisation de docker au boot systemctl enable --now docker.service D\u00e9marrage d'un conteneur de serveur web Apache - > docker container run -d --name websrv --publish 80:80 --volume /srv/kickstart:/usr/local/apache2/htdocs httpd Ngnix - > docker container run -d --name websrv --publish 80:80 --volume /srv/kickstart:/usr/share/nginx/html nginx Verficiation des user dans docker docker container top websrv Mise \u00e0 jour des permissions chmod 644 /srv/kickstart/ks.cfg Installation de micro curl https://getmic.ro | bash mv micro /usr/local/bin ln -s /usr/local/bin/micro /usr/local/sbin/micro Changement pour enlever le mot de passe de user sed -i -e '/ %wheel/s, ,# ,' -e '/^# %wheel.*NOPASSWD/s,^# ,,' /etc/sudoers Le -i prend en compte pour l'execution","title":"Installation docker"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#mise-en-place-de-lanaconda-pour-installer-dautres-machines","text":"","title":"Mise en place de l'anaconda pour installer d'autres machines"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#cahier-des-charges_1","text":"\"micro\" doit etre install\u00e9 dans /usr/local/bin Lien symbolique dans /usr/local/bin User n'a pas \u00e0 s'identifier pour sudo ... No PASSWD On ne peut se connecter en trannt que \"user\" avec une cl\u00e9 punlique definie ici","title":"Cahier des charges"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#extention-du-volume-groupe","text":"Cr\u00e9ation du volume dans le sdb pvcreate /dev/sdb Extentention du volume groupe sur le nouveau disque vgextend /dev/rootvg /dev/sdb Extention du volume logique lvextend -l 100%FREE -r /dev/rootvg/rootlv","title":"Extention du volume groupe"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#modification-du-ssh","text":"Cr\u00e9ation des dossier ssh (/.ssh/authorized_keys) .ssh avec les droits 700 authorized_keys avec les droits 600 Exemple de fichier anaconda : # Generated by Anaconda 34.25.2.2 # Generated by pykickstart v3.32 #version=RHEL9 # Use graphical install graphical repo --name = \"AppStream\" --baseurl=file:///run/install/sources/mount-0000-cdrom/AppStream %addon com_redhat_kdump --enable --reserve-mb = 'auto' %end # Keyboard layouts keyboard --xlayouts = 'fr (oss)' # System language lang fr_FR.UTF-8 # Network information network --hostname = LG-stream9-1.local # Use CDROM installation media cdrom %packages @^minimal-environment %end # Run the Setup Agent on first boot firstboot --enable # Generated using Blivet version 3.6.0 ignoredisk --only-use = sda # Partition clearing information clearpart --none --initlabel # Disk partitioning information part pv.1220 --fstype = \"lvmpv\" --ondisk=sda --size=7690 part /boot/efi --fstype = \"efi\" --ondisk=sda --size=1024 --fsoptions=\"umask=0077,shortname=winnt\" part swap --fstype = \"swap\" --ondisk=sda --size=1024 part /boot --fstype = \"ext2\" --ondisk=sda --size=500 volgroup rootvg --pesize = 4096 pv.1220 logvol / --fstype = \"ext4\" --size=3072 --name=rootlv --vgname=rootvg # System timezone timezone Europe/Paris --utc # Root password rootpw --iscrypted --allow-ssh $6$2y5hbbXM4dYt4c0v$usoQguNqD5QySTU5sbwDHMPuHU4tBs0mwPqUU574s83Vr1Tz5aJ//zIwtIEPdqsaTwpiBDQwnT.LQ/9PMC95o. user --groups = wheel --name=user --password=$6$IW2fEdwd1zcdKMCW$ecnGuYPR.PvRDy354ttoEJbnYuFHJm9HpAA6ZT2sHF2sqGEsHWnvnAYdvr6EdVFipZKkjchbaQOMyRERyZAR91 --iscrypted --gecos=\"user\"","title":"modification du SSH"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/Installation%20avanc%C3%A9e%20CENTOS%209/Installation/#debian","text":"Preseed (debian) = methode d'installation qui permet de faire passer les questions d'installation","title":"Debian"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/","text":"Programme du jour \u00b6 Manipuler rpm et yum Compiler un logiciel libre (\u00e0 partir des sources) Cr\u00e9er un pakcage RPM Cr\u00e9er un d\u00e9p\u00f4t pour mettre \u00e0 dispo mes packages D\u00e9clarer mon d\u00e9p\u00f4t sur les pc clients Manipuler rpm et yum \u00b6 RPM \u00b6 RPM : commande pour manipuler des package et savoir les informations sur ceux-ci Options : -q query => Information de version -qi => descriptif sur le paquage -qa => liste de tout les paquages install\u00e9s -ql => liste des fihcier install\u00e9 le paquet -qc => Liste des fihciers de config -qd => Liste des fichiers de docs -qf => savoir quel fichier \u00e0 install\u00e9 le package --requires (-R) => savoir les paquages dont il a besoin --provides (-P) => d\u00e9pendances pour qui ? --scripts => fichier spec avec les scripts de d\u00e9sinstall, install, preinstall YUM \u00b6 Yum : surcouche de rpm DNF = reprise de yum qui etait sur python 2.3 Options : install update upgrade (attention cela peut remplacer des paquets) remove list (liste tout les paquets) search (liste les paquets avec par exemple http dans les descriptions) provides Extraire une archive test de l'archive tar -tvzf ARCHIVE | tail options : - t pour tester ou lister (--list) - v versbose - f file - z compression - x pour extraire Le tail est utilis\u00e9 pour etre sur que tout les fichiers soient dans le meme dossier racine Extraction tar -xvzf ARCHIVE Verification des signatures GPG : \u00b6 Importer la cl\u00e9 avec WGET : wget https://download.samba.org/pub/rsync/src/rsync-3.2.7.tar.gz.asc Verification de la signature : gpg --verify rsync-3.2.7.tar.gz.asc Copie de la cl\u00e9 pour enregistrer la cl\u00e9 via un serveur de cl\u00e9s gpg --receive-keys 0048C8B026D4C96F0E589C2F6C859FB14B96A8C5 V\u00e9rifier \u00e0 nouveau la cl\u00e9 Paquet rsync \u00b6 Erreurs lors de la configuration Installation de GCC compilateur C dnf -y install gcc Nouvelle erreur lors de la configuration : On cherche les paquets openssl : yum provides \"*/openssl/md4.h\" On trouve ensuite les paquets openssl-devel dnf -y install gcc openssl-devel On retrouve plusieurs erreurs suppl\u00e9mentaires zstd lz4 xxhash Pour xxhash on va sur le site https://pkgs.org et on cherche un paquet qui se rapporte xxhash-devel On trouve le repo CRB : Commande compl\u00e8te avec tout les arguments : dnf --enablerepo=\"crb\" -y install gcc openssl-devel lz4-devel libzstd-devel xxhash-devel On retrouve ensuite le code retour avec la configuration termin\u00e9e : epel-release permet d'aller chercher des paquets qui ne sont pas soutenu par REDHAT mais par une autre communaut\u00e9 comme la communaut\u00e9 FEDORA Petite astuce pour savoir le nombre de coeur : grep -c ^processor /proc/cpuinfo RPM build \u00b6 Package rsync (non vide) \u00b6 3 options : b pour partir d'un fichier spec r pour partir d'un fichier sources package t pour partir d\"un tarball On build avec RPM : rpmbuild -tb rsync-3.y.z.tar.gz Exemple du fichier SPEC modifi\u00e9 : Attention, le %files n'accepte pas les doubles fichiers sur la m\u00eame ligne : RPM -ivh (v pour verbose ; h pour la barre de progressions) Package rsync (vide) \u00b6 Installation de rpmdev : dnf -y install rpmdevtools Cr\u00e9ation du fichier (--output pour set le nom et l'endoit du fichier) : rpmdev-newspec --type minimal --output rpmbuild/SPECS/vide.spec Modification du fichier SPEC : Cr\u00e9ation d'un repo \u00b6 Installation de la commande createrepo : dnf install creatrepo_c Installation du repo : Createrepo rpmbuild/RPMS Lancement d'un conteneur docker en restart always : docker container run -d --name repo --publish 8001:80 --volume /root/rpmbuild/RPMS/:/usr/local/apache2/htdocs --restart always httpd Cr\u00e9er le fichier /etc/yum.repos.d/mondepot.repo 1 2 3 [mondepot] name = Mon beau d\u00e9pot baseurl = http://IP:8001","title":"Programme du jour"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#programme-du-jour","text":"Manipuler rpm et yum Compiler un logiciel libre (\u00e0 partir des sources) Cr\u00e9er un pakcage RPM Cr\u00e9er un d\u00e9p\u00f4t pour mettre \u00e0 dispo mes packages D\u00e9clarer mon d\u00e9p\u00f4t sur les pc clients","title":"Programme du jour"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#manipuler-rpm-et-yum","text":"","title":"Manipuler rpm et yum"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#rpm","text":"RPM : commande pour manipuler des package et savoir les informations sur ceux-ci Options : -q query => Information de version -qi => descriptif sur le paquage -qa => liste de tout les paquages install\u00e9s -ql => liste des fihcier install\u00e9 le paquet -qc => Liste des fihciers de config -qd => Liste des fichiers de docs -qf => savoir quel fichier \u00e0 install\u00e9 le package --requires (-R) => savoir les paquages dont il a besoin --provides (-P) => d\u00e9pendances pour qui ? --scripts => fichier spec avec les scripts de d\u00e9sinstall, install, preinstall","title":"RPM"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#yum","text":"Yum : surcouche de rpm DNF = reprise de yum qui etait sur python 2.3 Options : install update upgrade (attention cela peut remplacer des paquets) remove list (liste tout les paquets) search (liste les paquets avec par exemple http dans les descriptions) provides Extraire une archive test de l'archive tar -tvzf ARCHIVE | tail options : - t pour tester ou lister (--list) - v versbose - f file - z compression - x pour extraire Le tail est utilis\u00e9 pour etre sur que tout les fichiers soient dans le meme dossier racine Extraction tar -xvzf ARCHIVE","title":"YUM"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#verification-des-signatures-gpg","text":"Importer la cl\u00e9 avec WGET : wget https://download.samba.org/pub/rsync/src/rsync-3.2.7.tar.gz.asc Verification de la signature : gpg --verify rsync-3.2.7.tar.gz.asc Copie de la cl\u00e9 pour enregistrer la cl\u00e9 via un serveur de cl\u00e9s gpg --receive-keys 0048C8B026D4C96F0E589C2F6C859FB14B96A8C5 V\u00e9rifier \u00e0 nouveau la cl\u00e9","title":"Verification des signatures GPG :"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#paquet-rsync","text":"Erreurs lors de la configuration Installation de GCC compilateur C dnf -y install gcc Nouvelle erreur lors de la configuration : On cherche les paquets openssl : yum provides \"*/openssl/md4.h\" On trouve ensuite les paquets openssl-devel dnf -y install gcc openssl-devel On retrouve plusieurs erreurs suppl\u00e9mentaires zstd lz4 xxhash Pour xxhash on va sur le site https://pkgs.org et on cherche un paquet qui se rapporte xxhash-devel On trouve le repo CRB : Commande compl\u00e8te avec tout les arguments : dnf --enablerepo=\"crb\" -y install gcc openssl-devel lz4-devel libzstd-devel xxhash-devel On retrouve ensuite le code retour avec la configuration termin\u00e9e : epel-release permet d'aller chercher des paquets qui ne sont pas soutenu par REDHAT mais par une autre communaut\u00e9 comme la communaut\u00e9 FEDORA Petite astuce pour savoir le nombre de coeur : grep -c ^processor /proc/cpuinfo","title":"Paquet rsync"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#rpm-build","text":"","title":"RPM build"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#package-rsync-non-vide","text":"3 options : b pour partir d'un fichier spec r pour partir d'un fichier sources package t pour partir d\"un tarball On build avec RPM : rpmbuild -tb rsync-3.y.z.tar.gz Exemple du fichier SPEC modifi\u00e9 : Attention, le %files n'accepte pas les doubles fichiers sur la m\u00eame ligne : RPM -ivh (v pour verbose ; h pour la barre de progressions)","title":"Package rsync (non vide)"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#package-rsync-vide","text":"Installation de rpmdev : dnf -y install rpmdevtools Cr\u00e9ation du fichier (--output pour set le nom et l'endoit du fichier) : rpmdev-newspec --type minimal --output rpmbuild/SPECS/vide.spec Modification du fichier SPEC :","title":"Package rsync (vide)"},{"location":"Linux/Master/Administration%20avanc%C3%A9e/RPM-YUM/Index/#creation-dun-repo","text":"Installation de la commande createrepo : dnf install creatrepo_c Installation du repo : Createrepo rpmbuild/RPMS Lancement d'un conteneur docker en restart always : docker container run -d --name repo --publish 8001:80 --volume /root/rpmbuild/RPMS/:/usr/local/apache2/htdocs --restart always httpd Cr\u00e9er le fichier /etc/yum.repos.d/mondepot.repo 1 2 3 [mondepot] name = Mon beau d\u00e9pot baseurl = http://IP:8001","title":"Cr\u00e9ation d'un repo"},{"location":"Linux/Master/Administration%20r%C3%A9seau/DNS/","text":"hide: - footer","title":"DNS"},{"location":"Linux/Master/Administration%20r%C3%A9seau/NMCLI/","text":"Configuration r\u00e9seau \u00b6 Configuration d'une IP fixe avec nmcli \u00b6 Info nmcli est un outil qui permet de g\u00e9rer la configuration r\u00e9seau en interagissant avec le deamon NetworkManager . nmcli est utilis\u00e9 pour cr\u00e9er, afficher, modifier, supprimer, activer et d\u00e9sactiver les connexions r\u00e9seau, ainsi que pour contr\u00f4ler et afficher l'\u00e9tat des p\u00e9riph\u00e9riques r\u00e9seau. Pour ajouter une IP fixe, nmcli propose une gestion de profile permettant d'activer une configuration personnalis\u00e9e pour chaque r\u00e9seau souhait\u00e9. Ici, nous souhaitons avoir les informations suivantes : Adresse IP : 10.56.126.223 Masque : 255.255.255.0 Gateway : 10.56.126.254 DNS : 1.1.1.1 Ajout d'un profil pour une connexion ip fixe : nmcli connection add type ethernet con-name ipfixe ifname eth0 ipv4.addresses 10 .56.126.223/24 ipv4.gateway 10 .56.126.254 ipv4.dns 1 .1.1.1 ipv4.method manual On observe ensuite les diff\u00e9rentes connection avec nmcli connection show : 1 2 3 4 5 NAME UUID TYPE DEVICE ipfixe 693bdc04-28e0-4e83-9b58-fef659d8f33c ethernet eth0 docker0 0250129c-212a-4ecc-a7f3-35649a492f08 bridge docker0 lo 45cc8d65-2e4e-40ce-bdbd-1c90b23dada8 loopback lo eth0 40d5bcc8-ca0c-42a9-9fad-388b15a5e856 ethernet -- On active la connextion avec : nmcli connection up ipfixe Network Manager \u00b6 Installation du package systemd-networkd pour obtenir la commande networkctl : dnf -y install systemd-networkd Pour observer les diff\u00e9rentes cartes r\u00e9seaux, on utlise networkctl : 1 2 3 4 5 6 IDX LINK TYPE OPERATIONAL SETUP 1 lo loopback carrier unmanaged 2 eth0 ether routable unmanaged 3 eth1 ether carrier unmanaged 4 docker0 bridge routable unmanaged 6 vethda849ef ether enslaved unmanaged Empecher le management des cartes tout le temps : Ajout d'un fichier dans /etc/NetworkManager/conf.d/99-unmanaged.conf [ keyfile ] unmanaged-devices = mac:00:15:5d:85:01:0f,mac:00:15:5d:85:01:10 Suppression des profiles avec nmcli : nmcli connection delete #nomdelaconnexion Configuration d'une carte avec un fichier de configuration dans /etc/systemd/network/ avec un fichier en .network : # Configuration du LAN 1 [ Match ] MACAddress = 00 :15:5d:85:01:0f [ Network ] Address = 192 .168.131.254/24 # Configuration du LAN 2 [ Match ] MACAddress = 00 :15:5d:85:01:10 [ Network ] Address = 192 .168.132.254/24 Tip Pour continuer le tp, on utilise 3 machines diff\u00e9rentes afin d'avoir la possibilit\u00e9 de communiquer entre elles. Modification des fichiers de configuration de network : # Configuration du LAN 1 [ Match ] MACAddress = 00 :15:5d:85:01:0f [ Network ] Address = 192 .168.131.1/24 Gateway = 192 .168.131.254 On active le routage car par d\u00e9faut le routage n'est pas activ\u00e9 sur linux : sysctl -w net.ipv4.ip_forward = 1 Rendre le param\u00e8tre persistant dans etc/sysctl.d/01-routage.conf : net.ipv4.ip_forward = 1 Mettre en place une r\u00e8gle de firewall pour enlever le message \"paquet filtr\u00e9\" : firewall-cmd --zone = trusted --add-source = 192 .168.0.0/16 --permanent Ajout d'une ou plusieurs routes statiques permanantes avec nmcli pour permettre \u00e0 plusieurs sous-r\u00e9seaux de communiquer entre eux : nmcli connection modify eth2 +ipv4.routes \"192.168.101.0/24 10.56.126.220\"","title":"Configuration r\u00e9seau"},{"location":"Linux/Master/Administration%20r%C3%A9seau/NMCLI/#configuration-reseau","text":"","title":"Configuration r\u00e9seau"},{"location":"Linux/Master/Administration%20r%C3%A9seau/NMCLI/#configuration-dune-ip-fixe-avec-nmcli","text":"Info nmcli est un outil qui permet de g\u00e9rer la configuration r\u00e9seau en interagissant avec le deamon NetworkManager . nmcli est utilis\u00e9 pour cr\u00e9er, afficher, modifier, supprimer, activer et d\u00e9sactiver les connexions r\u00e9seau, ainsi que pour contr\u00f4ler et afficher l'\u00e9tat des p\u00e9riph\u00e9riques r\u00e9seau. Pour ajouter une IP fixe, nmcli propose une gestion de profile permettant d'activer une configuration personnalis\u00e9e pour chaque r\u00e9seau souhait\u00e9. Ici, nous souhaitons avoir les informations suivantes : Adresse IP : 10.56.126.223 Masque : 255.255.255.0 Gateway : 10.56.126.254 DNS : 1.1.1.1 Ajout d'un profil pour une connexion ip fixe : nmcli connection add type ethernet con-name ipfixe ifname eth0 ipv4.addresses 10 .56.126.223/24 ipv4.gateway 10 .56.126.254 ipv4.dns 1 .1.1.1 ipv4.method manual On observe ensuite les diff\u00e9rentes connection avec nmcli connection show : 1 2 3 4 5 NAME UUID TYPE DEVICE ipfixe 693bdc04-28e0-4e83-9b58-fef659d8f33c ethernet eth0 docker0 0250129c-212a-4ecc-a7f3-35649a492f08 bridge docker0 lo 45cc8d65-2e4e-40ce-bdbd-1c90b23dada8 loopback lo eth0 40d5bcc8-ca0c-42a9-9fad-388b15a5e856 ethernet -- On active la connextion avec : nmcli connection up ipfixe","title":"Configuration d'une IP fixe avec nmcli"},{"location":"Linux/Master/Administration%20r%C3%A9seau/NMCLI/#network-manager","text":"Installation du package systemd-networkd pour obtenir la commande networkctl : dnf -y install systemd-networkd Pour observer les diff\u00e9rentes cartes r\u00e9seaux, on utlise networkctl : 1 2 3 4 5 6 IDX LINK TYPE OPERATIONAL SETUP 1 lo loopback carrier unmanaged 2 eth0 ether routable unmanaged 3 eth1 ether carrier unmanaged 4 docker0 bridge routable unmanaged 6 vethda849ef ether enslaved unmanaged Empecher le management des cartes tout le temps : Ajout d'un fichier dans /etc/NetworkManager/conf.d/99-unmanaged.conf [ keyfile ] unmanaged-devices = mac:00:15:5d:85:01:0f,mac:00:15:5d:85:01:10 Suppression des profiles avec nmcli : nmcli connection delete #nomdelaconnexion Configuration d'une carte avec un fichier de configuration dans /etc/systemd/network/ avec un fichier en .network : # Configuration du LAN 1 [ Match ] MACAddress = 00 :15:5d:85:01:0f [ Network ] Address = 192 .168.131.254/24 # Configuration du LAN 2 [ Match ] MACAddress = 00 :15:5d:85:01:10 [ Network ] Address = 192 .168.132.254/24 Tip Pour continuer le tp, on utilise 3 machines diff\u00e9rentes afin d'avoir la possibilit\u00e9 de communiquer entre elles. Modification des fichiers de configuration de network : # Configuration du LAN 1 [ Match ] MACAddress = 00 :15:5d:85:01:0f [ Network ] Address = 192 .168.131.1/24 Gateway = 192 .168.131.254 On active le routage car par d\u00e9faut le routage n'est pas activ\u00e9 sur linux : sysctl -w net.ipv4.ip_forward = 1 Rendre le param\u00e8tre persistant dans etc/sysctl.d/01-routage.conf : net.ipv4.ip_forward = 1 Mettre en place une r\u00e8gle de firewall pour enlever le message \"paquet filtr\u00e9\" : firewall-cmd --zone = trusted --add-source = 192 .168.0.0/16 --permanent Ajout d'une ou plusieurs routes statiques permanantes avec nmcli pour permettre \u00e0 plusieurs sous-r\u00e9seaux de communiquer entre eux : nmcli connection modify eth2 +ipv4.routes \"192.168.101.0/24 10.56.126.220\"","title":"Network Manager"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/","text":"S\u00e9curit\u00e9 de SSH \u00b6 Changement du port de SSH \u00b6 Warning Cette solution pour s\u00e9curiser SSH n'est pas recommand\u00e9 car cela ne procure pas beaucoup de s\u00e9curit\u00e9 Localisation du fichier de configguration de SSH /etc/ssh/sshd_config Pour modifier le port, on modifie la ligne : #Port 22 On enregistre ensuite le fichier et on execute la policy de SE linux : semanage port -a -t ssh_port_t -p tcp #PORTNUMBER On restart aussi le service : sudo systemctl restart sshd Fail2ban \u00b6 Info Pour chercher des packages qui ne sont pas pr\u00e9sent sur les dep\u00f4ts par d\u00e9faut : dpkg.org Installation d'un d\u00e9pot suppl\u00e9mentaire : dnf install epel-release On cherche le repo fail2ban et de quoi il est compos\u00e9: 1 2 dnf search fail2ban dnf info fail2ban Installation de bail2ban : dnf install fail2ban-firewalld Info Systemd \u00e0 la main sur cron, fstab, les services et aussi les logs Dans le service journald, on cherche les envois de logs avec grep Forward /etc/systemd/journald.conf . Cela nous retourne : 1 2 3 4 #ForwardToSyslog=no #ForwardToKMsg=no #ForwardToConsole=no #ForwardToWall=yes Pour obtenir les logs de sshd avec systemctl : journalctl --unit sshd.service Installation d'un package suppl\u00e9mentaire : dnf install -y fail2ban-systemd Tip Le service de fail2ban n'est pas en d\u00e9marrage automatique d\u00e8s son installation. Mise en route du service fail2ban : systemctl start fail2ban Observation des prisons fail2ban-client status : 1 2 3 Status | - Number of jail: 0 ` - Jail list: Localisation des fichiers de configuation des fichiers de fail2ban : /etc/fail2ban/ Interdiction On ne travaille pas sur le fichier de configuration direct, on utilise le dossier en .d \u00e0 la fin Affichage de pages de man install\u00e9es avec le package rpm -ql fail2ban-server | grep /man et on cherche la documentation sur les jails : 1 2 3 4 5 6 /usr/share/man/man1/fail2ban-client.1.gz /usr/share/man/man1/fail2ban-python.1.gz /usr/share/man/man1/fail2ban-regex.1.gz /usr/share/man/man1/fail2ban-server.1.gz /usr/share/man/man1/fail2ban.1.gz /usr/share/man/man5/jail.conf.5.gz Ajout d'un fichier de configuration dans le dossier jail.d : 1 2 3 4 5 6 7 8 [ sshd ] enabled = true # Mise en place d'un blocage de 30 minutes si il y a 5 essais erron\u00e9s en 5 minutes bantime = 1800 findtime = 300 maxretry = 5 On restart le service fail2ban : systemctl restart fail2ban.service On peut observer les jail: fail2ban-client get sshd banned On d\u00e9ban juste d'un jail avec la commande : fail2ban-cleint set sshd unbanip #ipdelamachine On d\u00e9ban une ip de toutes les jails: fail2ban-clent unban #ipdelamachine Info On d\u00e9sactive fail2ban pour la suite du tp. SSHGuard \u00b6 Recherche de SSHGuard : dnf search sshguard Dans la liste on cherche ce qui se rapporte au firewall : 1 2 3 4 5 6 ======================================== Nom correspond exactement \u00e0 : sshguard ======================================== sshguard.x86_64 : Protects hosts from brute-force attacks against SSH and other services ========================================= Nom & R\u00e9sum\u00e9 correspond \u00e0 : sshguard ========================================= sshguard-firewalld.x86_64 : Configuration for firewalld backend of SSHGuard sshguard-iptables.x86_64 : Configuration for iptables backend of SSHGuard sshguard-nftables.x86_64 : Configuration for nftables backend of SSHGuard PortKnocker \u00b6 Installation du serveur knock \u00b6 Info Port_knocker permet d\u2019ouvrir et de fermer les ports d\u2019une machine de fa\u00e7on dynamique. Il agit avec un client qui vient \"frapper\" \u00e0 la porte de la machine sur plusieurs ports. Si la s\u00e9quence est correcte, port-knocker ouvre le port qui correspond \u00e0 la s\u00e9quence pendant un certain temps avant de le d\u00e9sactiver. Recherche du pakcge knockd : dnf search knock Installation de knock et de son serveur : dnf -y install knock dnf -y install knock-server Tip Attention le service n'est pas d\u00e9marr\u00e9 par d\u00e9faut \u00e0 l'installation. Pour le d\u00e9marrer, utiliser : systemctl start knockd Localisation des fichiers de configurations : /etc/knockd.conf On observe le fichier de configuration : 1 2 3 4 5 6 7 8 9 10 [ options ] UseSyslog [ opencloseSSH ] sequence = 2222 :udp,3333:tcp,4444:udp seq_timeout = 15 tcpflags = syn,ack start_command = /sbin/iptables -A INPUT -s %IP% -p tcp --dport ssh -j ACCEPT cmd_timeout = 10 stop_command = /sbin/iptables -D INPUT -s %IP% -p tcp --dport ssh -j ACCEPT Sur la configuration, on observe la s\u00e9quence utilis\u00e9e avec les ports suivants: 2222:udp,3333:tcp,4444:udp . De plus, on remarque 2 commandes iptables permettant d'ajouter (option -A) et de supprimer (option -D) une ip dans le fichier iptables Warning Pour que le port knocking fontionne correctement, il faut que tout les ports de la machine soient ferm\u00e9s. On utlise la commade iptables pour fermer tout les ports : iptables -P INPUT DROP On r\u00e9alise notre propre fichier de configuration. Au pr\u00e9lable, comme il n'y a pas de dossier en .d pour faire des configurations annexe, on copie le fichier de configuration pour en faire une sauvegarde. Modification du fichier knockd.config : 1 2 3 4 5 6 7 [ opencloseSSH ] sequence = 2222 :tcp,3333:udp,4444:tcp seq_timeout = 15 start_command = /bin/firewall-cmd --zone = public --add-rich-rule 'rule family=ipv4 source address=%IP% service name=ssh accept' tcpflags = syn cmd_timeout = 10 stop_command = /bin/firewall-cmd --zone = public --remove-rich-rule 'rule family=ipv4 source address=%IP% service name=ssh accept' Warning Comme ici on utilise firewall-cmd , on d\u00e9sactive sur la zone publique ssh firewall-cmd --zone = public --remove-service = ssh Ici nous avons utilis\u00e9 firewall-cmd pour remplacer iptables . Les start_command et stop_command permettent d'ajouter avec les rich-rules le service SSH. Sur la s\u00e9quence, les ports sont en tcp et udp. Warning Lorsque le port n'est pas sp\u00e9cifi\u00e9, celui-ci prend par d\u00e9faut la valeur TCP .* Connexion avec knock \u00b6 Pour la connexion client, nous avons besoin du package knock . On toc \u00e0 la porte de la machine : knock 10 .56.126.74 2222 :tcp 3333 :udp 4444 :tcp Si on decompose la commande, on retrouve l'ip de destination puis les diff\u00e9rents ports avec les protocoles si ce n'est pas du TCP . Warning Une fois la commande de knock envoy\u00e9e, il faut envoyer la commande ssh dans le laps de temps o\u00f9 le port est ouvert","title":"S\u00e9curit\u00e9 de SSH"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#securite-de-ssh","text":"","title":"S\u00e9curit\u00e9 de SSH"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#changement-du-port-de-ssh","text":"Warning Cette solution pour s\u00e9curiser SSH n'est pas recommand\u00e9 car cela ne procure pas beaucoup de s\u00e9curit\u00e9 Localisation du fichier de configguration de SSH /etc/ssh/sshd_config Pour modifier le port, on modifie la ligne : #Port 22 On enregistre ensuite le fichier et on execute la policy de SE linux : semanage port -a -t ssh_port_t -p tcp #PORTNUMBER On restart aussi le service : sudo systemctl restart sshd","title":"Changement du port de SSH"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#fail2ban","text":"Info Pour chercher des packages qui ne sont pas pr\u00e9sent sur les dep\u00f4ts par d\u00e9faut : dpkg.org Installation d'un d\u00e9pot suppl\u00e9mentaire : dnf install epel-release On cherche le repo fail2ban et de quoi il est compos\u00e9: 1 2 dnf search fail2ban dnf info fail2ban Installation de bail2ban : dnf install fail2ban-firewalld Info Systemd \u00e0 la main sur cron, fstab, les services et aussi les logs Dans le service journald, on cherche les envois de logs avec grep Forward /etc/systemd/journald.conf . Cela nous retourne : 1 2 3 4 #ForwardToSyslog=no #ForwardToKMsg=no #ForwardToConsole=no #ForwardToWall=yes Pour obtenir les logs de sshd avec systemctl : journalctl --unit sshd.service Installation d'un package suppl\u00e9mentaire : dnf install -y fail2ban-systemd Tip Le service de fail2ban n'est pas en d\u00e9marrage automatique d\u00e8s son installation. Mise en route du service fail2ban : systemctl start fail2ban Observation des prisons fail2ban-client status : 1 2 3 Status | - Number of jail: 0 ` - Jail list: Localisation des fichiers de configuation des fichiers de fail2ban : /etc/fail2ban/ Interdiction On ne travaille pas sur le fichier de configuration direct, on utilise le dossier en .d \u00e0 la fin Affichage de pages de man install\u00e9es avec le package rpm -ql fail2ban-server | grep /man et on cherche la documentation sur les jails : 1 2 3 4 5 6 /usr/share/man/man1/fail2ban-client.1.gz /usr/share/man/man1/fail2ban-python.1.gz /usr/share/man/man1/fail2ban-regex.1.gz /usr/share/man/man1/fail2ban-server.1.gz /usr/share/man/man1/fail2ban.1.gz /usr/share/man/man5/jail.conf.5.gz Ajout d'un fichier de configuration dans le dossier jail.d : 1 2 3 4 5 6 7 8 [ sshd ] enabled = true # Mise en place d'un blocage de 30 minutes si il y a 5 essais erron\u00e9s en 5 minutes bantime = 1800 findtime = 300 maxretry = 5 On restart le service fail2ban : systemctl restart fail2ban.service On peut observer les jail: fail2ban-client get sshd banned On d\u00e9ban juste d'un jail avec la commande : fail2ban-cleint set sshd unbanip #ipdelamachine On d\u00e9ban une ip de toutes les jails: fail2ban-clent unban #ipdelamachine Info On d\u00e9sactive fail2ban pour la suite du tp.","title":"Fail2ban"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#sshguard","text":"Recherche de SSHGuard : dnf search sshguard Dans la liste on cherche ce qui se rapporte au firewall : 1 2 3 4 5 6 ======================================== Nom correspond exactement \u00e0 : sshguard ======================================== sshguard.x86_64 : Protects hosts from brute-force attacks against SSH and other services ========================================= Nom & R\u00e9sum\u00e9 correspond \u00e0 : sshguard ========================================= sshguard-firewalld.x86_64 : Configuration for firewalld backend of SSHGuard sshguard-iptables.x86_64 : Configuration for iptables backend of SSHGuard sshguard-nftables.x86_64 : Configuration for nftables backend of SSHGuard","title":"SSHGuard"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#portknocker","text":"","title":"PortKnocker"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#installation-du-serveur-knock","text":"Info Port_knocker permet d\u2019ouvrir et de fermer les ports d\u2019une machine de fa\u00e7on dynamique. Il agit avec un client qui vient \"frapper\" \u00e0 la porte de la machine sur plusieurs ports. Si la s\u00e9quence est correcte, port-knocker ouvre le port qui correspond \u00e0 la s\u00e9quence pendant un certain temps avant de le d\u00e9sactiver. Recherche du pakcge knockd : dnf search knock Installation de knock et de son serveur : dnf -y install knock dnf -y install knock-server Tip Attention le service n'est pas d\u00e9marr\u00e9 par d\u00e9faut \u00e0 l'installation. Pour le d\u00e9marrer, utiliser : systemctl start knockd Localisation des fichiers de configurations : /etc/knockd.conf On observe le fichier de configuration : 1 2 3 4 5 6 7 8 9 10 [ options ] UseSyslog [ opencloseSSH ] sequence = 2222 :udp,3333:tcp,4444:udp seq_timeout = 15 tcpflags = syn,ack start_command = /sbin/iptables -A INPUT -s %IP% -p tcp --dport ssh -j ACCEPT cmd_timeout = 10 stop_command = /sbin/iptables -D INPUT -s %IP% -p tcp --dport ssh -j ACCEPT Sur la configuration, on observe la s\u00e9quence utilis\u00e9e avec les ports suivants: 2222:udp,3333:tcp,4444:udp . De plus, on remarque 2 commandes iptables permettant d'ajouter (option -A) et de supprimer (option -D) une ip dans le fichier iptables Warning Pour que le port knocking fontionne correctement, il faut que tout les ports de la machine soient ferm\u00e9s. On utlise la commade iptables pour fermer tout les ports : iptables -P INPUT DROP On r\u00e9alise notre propre fichier de configuration. Au pr\u00e9lable, comme il n'y a pas de dossier en .d pour faire des configurations annexe, on copie le fichier de configuration pour en faire une sauvegarde. Modification du fichier knockd.config : 1 2 3 4 5 6 7 [ opencloseSSH ] sequence = 2222 :tcp,3333:udp,4444:tcp seq_timeout = 15 start_command = /bin/firewall-cmd --zone = public --add-rich-rule 'rule family=ipv4 source address=%IP% service name=ssh accept' tcpflags = syn cmd_timeout = 10 stop_command = /bin/firewall-cmd --zone = public --remove-rich-rule 'rule family=ipv4 source address=%IP% service name=ssh accept' Warning Comme ici on utilise firewall-cmd , on d\u00e9sactive sur la zone publique ssh firewall-cmd --zone = public --remove-service = ssh Ici nous avons utilis\u00e9 firewall-cmd pour remplacer iptables . Les start_command et stop_command permettent d'ajouter avec les rich-rules le service SSH. Sur la s\u00e9quence, les ports sont en tcp et udp. Warning Lorsque le port n'est pas sp\u00e9cifi\u00e9, celui-ci prend par d\u00e9faut la valeur TCP .*","title":"Installation du serveur knock"},{"location":"Linux/Master/Administration%20r%C3%A9seau/SSH/#connexion-avec-knock","text":"Pour la connexion client, nous avons besoin du package knock . On toc \u00e0 la porte de la machine : knock 10 .56.126.74 2222 :tcp 3333 :udp 4444 :tcp Si on decompose la commande, on retrouve l'ip de destination puis les diff\u00e9rents ports avec les protocoles si ce n'est pas du TCP . Warning Une fois la commande de knock envoy\u00e9e, il faut envoyer la commande ssh dans le laps de temps o\u00f9 le port est ouvert","title":"Connexion avec knock"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/","text":"Se linux \u00b6 Introduction \u00b6 SE Linux se base sur la s\u00e9curit\u00e9 de type MAC (Mandatory Access Control). La commande sestatus permet d'obtenir des informations concernant la protection de SE Linux Exemple de protection SE Linux SE Linux poss\u00e8de 2 modes : Enforcing : cette option bloque et log Permissive : cette option laisse tout faire et log Pour forcer le mode permissive on utilise la commande : Solution 1 Solution 2 setenforce 0 setenforce Permissive Pour forcer le mode enforcing on utilise la commande : Solution 1 Solution 2 setenforce 1 setenforce Enforcing Chaque fihcier et prossesus ont un label de s\u00e9curit\u00e9 (security context) avec une forme : user:role:type(files)/domaine(processus):mls Cette forme peut-etre lue avec les commandes : ls -Z /etc/hosts et ps -Zfax Info Z pour lister les labels f affiche sous forme d'arbre a pour lister les porcessus des autres utilisateurs x affiche les processus qui n'ont pas de terminal de controle Lister les r\u00e8gles d'une strat\u00e9gie : chcon -R -t Info -R pour recurcive -t pour le type Manipulations \u00b6 Mise \u00e0 z\u00e9ro de audit.log \u00b6 Arret du service auditd : systemctl stop auditd Si le service ne veux pas \u00eatre arr\u00e9t\u00e9 par le biais de systemctl , utilisez : service auditd stop Supprimez le fichier \\var\\log\\audit\\audit.log rm \\v ar \\l og \\a udit \\a udit.log On regarde ensuite les labels de s\u00e9curit\u00e9 du fichier : ls -lZ \\v ar \\l og \\a udit \\a udit.log Mise \u00e0 z\u00e9ro de SElinux \u00b6 Reconstitution des labels de s\u00e9curit\u00e9 \u00b6 Danger La reconsititution des labels de s\u00e9curit\u00e9s concerne tout les fichiers. Si des labels de s\u00e9curit\u00e9 ont \u00e9t\u00e9 modifi\u00e9s manuellement , ceux-ci seront r\u00e9initialis\u00e9s par la reconsititution sauf si ceux-ci ont \u00e9t\u00e9 rentr\u00e9s dans les configurations persistantes . Pour reconstruire les labels de s\u00e9curit\u00e9 : restorecon -R / Pour reconstruire les labels de s\u00e9curit\u00e9 au prochain d\u00e9marrage : touch /.autorelabel Au red\u00e9marrage on peut observe le relabel : Message au red\u00e9marrage de l'autorelabel Les templates sont stocker dans /etc/selinux/targeted . Contenu du dossier targeted Exemple d'un fichier (ici /etc/selinux/targeted/contexts/systemd_contexts ) : runtime = system_u:object_r:systemd_runtime_unit_file_t:s0 Travail sur un serveur FTP \u00b6 Abstract Installation du serveur : vsftpd On observe ensuite les labels de s\u00e9curit\u00e9 sur les dossiers /var/ftp et /var/ftp/pub . On remmarque que sur les labels de s\u00e9curit\u00e9, on retrouve un label public_content_t . On demarre le service avec systemctl start vsftpd . Note Le firewall bloque peut-\u00eatre les connexion au ftp via le navigateur (ftp:// ipmachine ). On active le service firewall FTP : firewall-cmd --add-service = ftp On se connecte avec un client ftp et une session comme root. On obteint un succ\u00e8s de connexion. On s'int\u00e9rresse maintenant au fichier de configuration /etc/vsftpd/vsftpd.conf . On retrouve la ligne : anonymous_enable = NO La ligne ci-dessus doit \u00eatre comment\u00e9e afin de pouvoir autoriser les connexions anonymes. Warning Il faut restart le service afin de prendre en compte le changement de configuration. On va cr\u00e9er les dossiers pour d\u00e9placer l'attache du ftp dans /home/ftp/pub Info On peut utiliser mkdir -p avec l'option -p qui permet de cr\u00e9er les parents du dossier voulu. On ajoute une ligne dans /etc/vsftpd/vsftpd.conf pour lier le ftp dans le dossier cr\u00e9er pr\u00e9c\u00e9dement : anon_root = /home/ftp On regarde les labels de s\u00e9urit\u00e9 sur le dossier ls -lZ /home/ftp/ drwxr-xr-x. 2 root root unconfined_u:object_r:user_home_t:s0 4096 27 janv. 09 :34 pub Info A partir de redhat 9, on \u00e0 maintenant acc\u00e8s au FTP . On cherche \u00e0 lister les diff\u00e9rents modules de SE Linux avec la commande avec l'installation de tools: dnf -y install setools-console On va lister tout les r\u00e8gles d'autorisations : sesearch --allow -s ftpd_t | grep \" ftpd\" Et on obteint une information concernant la r\u00e8gle ci-dessus : 1 2 allow ftpd_t user_home_t:dir { create link rename reparent rmdir setattr unlink watch watch_reads } ; allow ftpd_t user_home_t:file { create ioctl link lock map open read rename setattr unlink watch watch_reads write } ; On peux filtrer aussi avec : sesearch --allow -s ftpd_t -t user_home_t On obteint : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 allow daemon user_home_t:file { append getattr } ; allow domain file_type:blk_file map ; [ domain_can_mmap_files ] :True allow domain file_type:chr_file map ; [ domain_can_mmap_files ] :True allow domain file_type:file map ; [ domain_can_mmap_files ] :True allow domain file_type:lnk_file map ; [ domain_can_mmap_files ] :True allow ftpd_t file_type:filesystem getattr ; allow ftpd_t non_security_file_type:dir { add_name create getattr ioctl link lock open read remove_name rename reparent rmdir search setattr unlink watch watch_reads write } ; [ ftpd_full_access ] :True allow ftpd_t non_security_file_type:dir { add_name getattr ioctl lock open read remove_name search write } ; [ ftpd_full_access ] :True allow ftpd_t non_security_file_type:dir { add_name getattr ioctl lock open read remove_name search write } ; [ ftpd_full_access ] :True allow ftpd_t non_security_file_type:file { append create getattr ioctl link lock open read rename setattr unlink watch watch_reads write } ; [ ftpd_full_access ] :True allow ftpd_t non_security_file_type:lnk_file { append create getattr ioctl link lock read rename setattr unlink watch watch_reads write } ; [ ftpd_full_access ] :True allow ftpd_t user_home_t:dir { create link rename reparent rmdir setattr unlink watch watch_reads } ; allow ftpd_t user_home_t:file { create ioctl link lock map open read rename setattr unlink watch watch_reads write } ; allow userdom_filetrans_type user_home_t:dir { add_name getattr ioctl lock open read remove_name search write } ; Exploration de SElinux avec les ports \u00b6 Installation de apache avec le package httpd . Une fois l'installation termin\u00e9e, on modifie le port de Apache dans le fichier de configuration ( /etc/httpd/conf/httpd.conf ) : Listen 8888 Warning Pour activer la modification, il faut red\u00e9marrer le service ou le d\u00e9marrer si cela n'a pas \u00e9t\u00e9 fait \u00e0 l'installation Pour red\u00e9marrer : systemctl restart httpd Pour d\u00e9marrer le service : systemctl start httpd Avec le restart, on obteint une erreur de configuration : 1 2 Job for httpd.service failed because the control process exited with error code. See \"systemctl status httpd.service\" and \"journalctl -xeu httpd.service\" for details. Si on observe les logs avec journalctl -u httpd | tail , on remarque que le port 8888 provoque un probl\u00e8me : 1 2 3 4 5 6 7 8 janv. 27 11 :15:33 LG-stream9-1.local systemd [ 1 ] : Starting The Apache HTTP Server... janv. 27 11 :15:35 LG-stream9-1.local httpd [ 1865 ] : ( 13 ) Permission denied: AH00072: make_sock: could not bind to address [ :: ] :8888 janv. 27 11 :15:35 LG-stream9-1.local httpd [ 1865 ] : ( 13 ) Permission denied: AH00072: make_sock: could not bind to address 0 .0.0.0:8888 janv. 27 11 :15:35 LG-stream9-1.local httpd [ 1865 ] : no listening sockets available, shutting down janv. 27 11 :15:35 LG-stream9-1.local httpd [ 1865 ] : AH00015: Unable to open logs janv. 27 11 :15:35 LG-stream9-1.local systemd [ 1 ] : httpd.service: Main process exited, code = exited, status = 1 /FAILURE janv. 27 11 :15:35 LG-stream9-1.local systemd [ 1 ] : httpd.service: Failed with result 'exit-code' . janv. 27 11 :15:35 LG-stream9-1.local systemd [ 1 ] : Failed to start The Apache HTTP Server. On cherche aussi dans /var/log/audit/audit.log avec la commane grep avc /var/log/audit/audit.log 1 2 type = AVC msg = audit ( 1674814535 .950:140 ) : avc: denied { name_bind } for pid = 1865 comm = \"httpd\" src = 8888 scontext = system_u:system_r:httpd_t:s0 tcontext = system_u:object_r:unreserved_port_t:s0 tclass = tcp_socket permissive = 0 type = AVC msg = audit ( 1674814535 .953:141 ) : avc: denied { name_bind } for pid = 1865 comm = \"httpd\" src = 8888 scontext = system_u:system_r:httpd_t:s0 tcontext = system_u:object_r:unreserved_port_t:s0 tclass = tcp_socket permissive = 0 On utilise audit2 pour comprendre le probl\u00e8me avec la commande ( grep avc /var/log/audit/audit.log | tail -n -1 | audit2why ): 1 2 3 4 5 6 Was caused by: The boolean nis_enabled was set incorrectly. Description: Allow nis to enabled Allow access by executing: # setsebool -P nis_enabled 1 Puis on cherche de savoir comment r\u00e9soudre ce probl\u00e8me avec audit2 avec la commande ( grep avc /var/log/audit/audit.log | tail -n -1 | audit2allow ): 1 2 3 4 #============= httpd_t ============== #!!!! This avc can be allowed using the boolean 'nis_enabled' allow httpd_t unreserved_port_t:tcp_socket name_bind ; Danger Attention cela provoque une faille de s\u00e9curit\u00e9. Nous allons donc passer par semanage . Pour lister tout les ports avec semanage ( semanage port -l | grep http ) : 1 2 3 4 5 http_cache_port_t tcp 8080 , 8118 , 8123 , 10001 -10010 http_cache_port_t udp 3130 http_port_t tcp 80 , 81 , 443 , 488 , 8008 , 8009 , 8443 , 9000 pegasus_http_port_t tcp 5988 pegasus_https_port_t tcp 5989 Ici on peut d\u00e9couvrir tout les ports, on modifie alors le label http pour autoriser le port 8888 : semanage port -a -t http_port_t -p tcp 8888 Si on observe les ports, on le retrouve dans la liste : 1 2 3 4 5 http_cache_port_t tcp 8080 , 8118 , 8123 , 10001 -10010 http_cache_port_t udp 3130 http_port_t tcp 8888 , 80 , 81 , 443 , 488 , 8008 , 8009 , 8443 , 9000 pegasus_http_port_t tcp 5988 pegasus_https_port_t tcp 5989 On red\u00e9marre alors le service httpd et on obteint aucune erreurs. Les bool\u00e9ens dans SElinux \u00b6 Pr\u00e9requis pour r\u00e9aliser cette activit\u00e9 Il est n\u00e9c\u00e9ssaire d'avoir un serveur web (par exemple httpd autrement dit apache). Ici nous utilisons le serveur web pr\u00e9c\u00e9dement install\u00e9 et sur le port 8888. Normalement, le port par d\u00e9faut est 80. Cr\u00e9ation d'un fichier /var/www/cgi-bin/env.cgi contenant : 1 2 3 4 5 #!/bin/bash echo -e \"Content-Type: text/plain\\n\\n\" set On rend ensuite le fichier executable pour tout le monde : chmod 755 /var/www/cgi-bin/env.cgi Puis on test avec un curl : curl http://127.0.0.1:8888/cgi-bin/env.cgi Attention au firewall Attention le firewall peut bloquer la communication sur le port 8888. Il faut autoriser le trafic sur le port : firewall-cmd --add-port = 8888 /tcp Petite modification du fichier /var/www/cgi-bin/env.cgi pour executer des requetes dans l'URL: 1 2 3 4 5 6 7 #!/bin/bash echo -e \"Content-Type: text/plain\\n\\n\" echo \"La commande est : $QUERY_STRING \" CMD = $( echo $QUERY_STRING | sed 's,%20, ,g' ) $CMD Si on test le script dans le navigateur avec la commande curl http://172.19.252.60:8888/cgi-bin/env.cgi?ls : Exemple avec la commande ls Danger Attention, les commandes sont execut\u00e9es avec l'identit\u00e9 du user wwwdata . Le utlisateur poss\u00e8de donc tout les droits de cr\u00e9ations et autres li\u00e9s \u00e0 wwwdata . Pour la s\u00e9curit\u00e9, on va d\u00e9sactiver toutes les executions des .cgi : getsebool -a | grep http On d\u00e9sactive alors l'execution des CGI : setsebool -P httpd_enable_cgi off Tip Attention au mode de selinux car si il est en permissive cela laissera actif l'execution des CGI.","title":"Se linux"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#se-linux","text":"","title":"Se linux"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#introduction","text":"SE Linux se base sur la s\u00e9curit\u00e9 de type MAC (Mandatory Access Control). La commande sestatus permet d'obtenir des informations concernant la protection de SE Linux Exemple de protection SE Linux SE Linux poss\u00e8de 2 modes : Enforcing : cette option bloque et log Permissive : cette option laisse tout faire et log Pour forcer le mode permissive on utilise la commande : Solution 1 Solution 2 setenforce 0 setenforce Permissive Pour forcer le mode enforcing on utilise la commande : Solution 1 Solution 2 setenforce 1 setenforce Enforcing Chaque fihcier et prossesus ont un label de s\u00e9curit\u00e9 (security context) avec une forme : user:role:type(files)/domaine(processus):mls Cette forme peut-etre lue avec les commandes : ls -Z /etc/hosts et ps -Zfax Info Z pour lister les labels f affiche sous forme d'arbre a pour lister les porcessus des autres utilisateurs x affiche les processus qui n'ont pas de terminal de controle Lister les r\u00e8gles d'une strat\u00e9gie : chcon -R -t Info -R pour recurcive -t pour le type","title":"Introduction"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#manipulations","text":"","title":"Manipulations"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#mise-a-zero-de-auditlog","text":"Arret du service auditd : systemctl stop auditd Si le service ne veux pas \u00eatre arr\u00e9t\u00e9 par le biais de systemctl , utilisez : service auditd stop Supprimez le fichier \\var\\log\\audit\\audit.log rm \\v ar \\l og \\a udit \\a udit.log On regarde ensuite les labels de s\u00e9curit\u00e9 du fichier : ls -lZ \\v ar \\l og \\a udit \\a udit.log","title":"Mise \u00e0 z\u00e9ro de audit.log"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#mise-a-zero-de-selinux","text":"","title":"Mise \u00e0 z\u00e9ro de SElinux"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#reconstitution-des-labels-de-securite","text":"Danger La reconsititution des labels de s\u00e9curit\u00e9s concerne tout les fichiers. Si des labels de s\u00e9curit\u00e9 ont \u00e9t\u00e9 modifi\u00e9s manuellement , ceux-ci seront r\u00e9initialis\u00e9s par la reconsititution sauf si ceux-ci ont \u00e9t\u00e9 rentr\u00e9s dans les configurations persistantes . Pour reconstruire les labels de s\u00e9curit\u00e9 : restorecon -R / Pour reconstruire les labels de s\u00e9curit\u00e9 au prochain d\u00e9marrage : touch /.autorelabel Au red\u00e9marrage on peut observe le relabel : Message au red\u00e9marrage de l'autorelabel Les templates sont stocker dans /etc/selinux/targeted . Contenu du dossier targeted Exemple d'un fichier (ici /etc/selinux/targeted/contexts/systemd_contexts ) : runtime = system_u:object_r:systemd_runtime_unit_file_t:s0","title":"Reconstitution des labels de s\u00e9curit\u00e9"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#travail-sur-un-serveur-ftp","text":"Abstract Installation du serveur : vsftpd On observe ensuite les labels de s\u00e9curit\u00e9 sur les dossiers /var/ftp et /var/ftp/pub . On remmarque que sur les labels de s\u00e9curit\u00e9, on retrouve un label public_content_t . On demarre le service avec systemctl start vsftpd . Note Le firewall bloque peut-\u00eatre les connexion au ftp via le navigateur (ftp:// ipmachine ). On active le service firewall FTP : firewall-cmd --add-service = ftp On se connecte avec un client ftp et une session comme root. On obteint un succ\u00e8s de connexion. On s'int\u00e9rresse maintenant au fichier de configuration /etc/vsftpd/vsftpd.conf . On retrouve la ligne : anonymous_enable = NO La ligne ci-dessus doit \u00eatre comment\u00e9e afin de pouvoir autoriser les connexions anonymes. Warning Il faut restart le service afin de prendre en compte le changement de configuration. On va cr\u00e9er les dossiers pour d\u00e9placer l'attache du ftp dans /home/ftp/pub Info On peut utiliser mkdir -p avec l'option -p qui permet de cr\u00e9er les parents du dossier voulu. On ajoute une ligne dans /etc/vsftpd/vsftpd.conf pour lier le ftp dans le dossier cr\u00e9er pr\u00e9c\u00e9dement : anon_root = /home/ftp On regarde les labels de s\u00e9urit\u00e9 sur le dossier ls -lZ /home/ftp/ drwxr-xr-x. 2 root root unconfined_u:object_r:user_home_t:s0 4096 27 janv. 09 :34 pub Info A partir de redhat 9, on \u00e0 maintenant acc\u00e8s au FTP . On cherche \u00e0 lister les diff\u00e9rents modules de SE Linux avec la commande avec l'installation de tools: dnf -y install setools-console On va lister tout les r\u00e8gles d'autorisations : sesearch --allow -s ftpd_t | grep \" ftpd\" Et on obteint une information concernant la r\u00e8gle ci-dessus : 1 2 allow ftpd_t user_home_t:dir { create link rename reparent rmdir setattr unlink watch watch_reads } ; allow ftpd_t user_home_t:file { create ioctl link lock map open read rename setattr unlink watch watch_reads write } ; On peux filtrer aussi avec : sesearch --allow -s ftpd_t -t user_home_t On obteint : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 allow daemon user_home_t:file { append getattr } ; allow domain file_type:blk_file map ; [ domain_can_mmap_files ] :True allow domain file_type:chr_file map ; [ domain_can_mmap_files ] :True allow domain file_type:file map ; [ domain_can_mmap_files ] :True allow domain file_type:lnk_file map ; [ domain_can_mmap_files ] :True allow ftpd_t file_type:filesystem getattr ; allow ftpd_t non_security_file_type:dir { add_name create getattr ioctl link lock open read remove_name rename reparent rmdir search setattr unlink watch watch_reads write } ; [ ftpd_full_access ] :True allow ftpd_t non_security_file_type:dir { add_name getattr ioctl lock open read remove_name search write } ; [ ftpd_full_access ] :True allow ftpd_t non_security_file_type:dir { add_name getattr ioctl lock open read remove_name search write } ; [ ftpd_full_access ] :True allow ftpd_t non_security_file_type:file { append create getattr ioctl link lock open read rename setattr unlink watch watch_reads write } ; [ ftpd_full_access ] :True allow ftpd_t non_security_file_type:lnk_file { append create getattr ioctl link lock read rename setattr unlink watch watch_reads write } ; [ ftpd_full_access ] :True allow ftpd_t user_home_t:dir { create link rename reparent rmdir setattr unlink watch watch_reads } ; allow ftpd_t user_home_t:file { create ioctl link lock map open read rename setattr unlink watch watch_reads write } ; allow userdom_filetrans_type user_home_t:dir { add_name getattr ioctl lock open read remove_name search write } ;","title":"Travail sur un serveur FTP"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#exploration-de-selinux-avec-les-ports","text":"Installation de apache avec le package httpd . Une fois l'installation termin\u00e9e, on modifie le port de Apache dans le fichier de configuration ( /etc/httpd/conf/httpd.conf ) : Listen 8888 Warning Pour activer la modification, il faut red\u00e9marrer le service ou le d\u00e9marrer si cela n'a pas \u00e9t\u00e9 fait \u00e0 l'installation Pour red\u00e9marrer : systemctl restart httpd Pour d\u00e9marrer le service : systemctl start httpd Avec le restart, on obteint une erreur de configuration : 1 2 Job for httpd.service failed because the control process exited with error code. See \"systemctl status httpd.service\" and \"journalctl -xeu httpd.service\" for details. Si on observe les logs avec journalctl -u httpd | tail , on remarque que le port 8888 provoque un probl\u00e8me : 1 2 3 4 5 6 7 8 janv. 27 11 :15:33 LG-stream9-1.local systemd [ 1 ] : Starting The Apache HTTP Server... janv. 27 11 :15:35 LG-stream9-1.local httpd [ 1865 ] : ( 13 ) Permission denied: AH00072: make_sock: could not bind to address [ :: ] :8888 janv. 27 11 :15:35 LG-stream9-1.local httpd [ 1865 ] : ( 13 ) Permission denied: AH00072: make_sock: could not bind to address 0 .0.0.0:8888 janv. 27 11 :15:35 LG-stream9-1.local httpd [ 1865 ] : no listening sockets available, shutting down janv. 27 11 :15:35 LG-stream9-1.local httpd [ 1865 ] : AH00015: Unable to open logs janv. 27 11 :15:35 LG-stream9-1.local systemd [ 1 ] : httpd.service: Main process exited, code = exited, status = 1 /FAILURE janv. 27 11 :15:35 LG-stream9-1.local systemd [ 1 ] : httpd.service: Failed with result 'exit-code' . janv. 27 11 :15:35 LG-stream9-1.local systemd [ 1 ] : Failed to start The Apache HTTP Server. On cherche aussi dans /var/log/audit/audit.log avec la commane grep avc /var/log/audit/audit.log 1 2 type = AVC msg = audit ( 1674814535 .950:140 ) : avc: denied { name_bind } for pid = 1865 comm = \"httpd\" src = 8888 scontext = system_u:system_r:httpd_t:s0 tcontext = system_u:object_r:unreserved_port_t:s0 tclass = tcp_socket permissive = 0 type = AVC msg = audit ( 1674814535 .953:141 ) : avc: denied { name_bind } for pid = 1865 comm = \"httpd\" src = 8888 scontext = system_u:system_r:httpd_t:s0 tcontext = system_u:object_r:unreserved_port_t:s0 tclass = tcp_socket permissive = 0 On utilise audit2 pour comprendre le probl\u00e8me avec la commande ( grep avc /var/log/audit/audit.log | tail -n -1 | audit2why ): 1 2 3 4 5 6 Was caused by: The boolean nis_enabled was set incorrectly. Description: Allow nis to enabled Allow access by executing: # setsebool -P nis_enabled 1 Puis on cherche de savoir comment r\u00e9soudre ce probl\u00e8me avec audit2 avec la commande ( grep avc /var/log/audit/audit.log | tail -n -1 | audit2allow ): 1 2 3 4 #============= httpd_t ============== #!!!! This avc can be allowed using the boolean 'nis_enabled' allow httpd_t unreserved_port_t:tcp_socket name_bind ; Danger Attention cela provoque une faille de s\u00e9curit\u00e9. Nous allons donc passer par semanage . Pour lister tout les ports avec semanage ( semanage port -l | grep http ) : 1 2 3 4 5 http_cache_port_t tcp 8080 , 8118 , 8123 , 10001 -10010 http_cache_port_t udp 3130 http_port_t tcp 80 , 81 , 443 , 488 , 8008 , 8009 , 8443 , 9000 pegasus_http_port_t tcp 5988 pegasus_https_port_t tcp 5989 Ici on peut d\u00e9couvrir tout les ports, on modifie alors le label http pour autoriser le port 8888 : semanage port -a -t http_port_t -p tcp 8888 Si on observe les ports, on le retrouve dans la liste : 1 2 3 4 5 http_cache_port_t tcp 8080 , 8118 , 8123 , 10001 -10010 http_cache_port_t udp 3130 http_port_t tcp 8888 , 80 , 81 , 443 , 488 , 8008 , 8009 , 8443 , 9000 pegasus_http_port_t tcp 5988 pegasus_https_port_t tcp 5989 On red\u00e9marre alors le service httpd et on obteint aucune erreurs.","title":"Exploration de SElinux avec les ports"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/SElinux/#les-booleens-dans-selinux","text":"Pr\u00e9requis pour r\u00e9aliser cette activit\u00e9 Il est n\u00e9c\u00e9ssaire d'avoir un serveur web (par exemple httpd autrement dit apache). Ici nous utilisons le serveur web pr\u00e9c\u00e9dement install\u00e9 et sur le port 8888. Normalement, le port par d\u00e9faut est 80. Cr\u00e9ation d'un fichier /var/www/cgi-bin/env.cgi contenant : 1 2 3 4 5 #!/bin/bash echo -e \"Content-Type: text/plain\\n\\n\" set On rend ensuite le fichier executable pour tout le monde : chmod 755 /var/www/cgi-bin/env.cgi Puis on test avec un curl : curl http://127.0.0.1:8888/cgi-bin/env.cgi Attention au firewall Attention le firewall peut bloquer la communication sur le port 8888. Il faut autoriser le trafic sur le port : firewall-cmd --add-port = 8888 /tcp Petite modification du fichier /var/www/cgi-bin/env.cgi pour executer des requetes dans l'URL: 1 2 3 4 5 6 7 #!/bin/bash echo -e \"Content-Type: text/plain\\n\\n\" echo \"La commande est : $QUERY_STRING \" CMD = $( echo $QUERY_STRING | sed 's,%20, ,g' ) $CMD Si on test le script dans le navigateur avec la commande curl http://172.19.252.60:8888/cgi-bin/env.cgi?ls : Exemple avec la commande ls Danger Attention, les commandes sont execut\u00e9es avec l'identit\u00e9 du user wwwdata . Le utlisateur poss\u00e8de donc tout les droits de cr\u00e9ations et autres li\u00e9s \u00e0 wwwdata . Pour la s\u00e9curit\u00e9, on va d\u00e9sactiver toutes les executions des .cgi : getsebool -a | grep http On d\u00e9sactive alors l'execution des CGI : setsebool -P httpd_enable_cgi off Tip Attention au mode de selinux car si il est en permissive cela laissera actif l'execution des CGI.","title":"Les bool\u00e9ens dans SElinux"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/","text":"Les permissions \u00b6 Liste des permissions \u00b6 Commande pour obtenir des informations concernant les droits : ls -l On obteint plusieurs groupes : x : pour se d\u00e9placer dedans (pour les fichier, on execute le fichier tel qu'un script) w : modification de contenu avec l'ajout, la modification ou la suppression d'octect (en fichiers ou en repertoires) r : lecture et copie des fichiers ( r\u00e9pertoire : lister les fichiers) s : Il conf\u00e8re l'identit\u00e9 du propri\u00e9taire de la commande (avec passwd par exemple) t : on trouve la permission sur tout les dossiers temporaires/partages. Seul le propri\u00e8taire du fichier peut le supprimer. (sticky-bit) Commandes de changements de permissions \u00b6 chown : pour modifier mes permissions du fichier chgrp : L'administrateur et l'utilisateur peuvent modifier les permissions chmod : Permet de changer les permissions d'acc\u00e8s d'un fichier ou d'un r\u00e9pertoire (il faut etre propri\u00e8taire du fichier) Pour chercher les fichiers qui poss\u00e8de le droit s : find -perm /u = s Et on obtient une liste de fichier plus ou moins longue si docker est install\u00e9 : Liste des fichiers poss\u00e8dant le droit permettant une \u00e9l\u00e9vation de privil\u00e8ges Info On peux ajouter une option -o pour faire un or et donc lier plusieurs arguments Exemple : find / -perm /u=s -o -perm /g=s Les capabilities \u00b6 Premi\u00e8res notions sur les capabilities \u00b6 Installation des pages de man (si elles ne sont pas pr\u00e9sentes) : dnf -y install man-pages Overture du man de capabilities : man capabilities Les capabilities ont 2 cat\u00e9gories : les processus privili\u00e9gi\u00e9s les processes non privili\u00e9gi\u00e9s Les processus privili\u00e9gi\u00e9s sont appell\u00e9 par un superutilisateur ou root. Ils contournent les verfications du noyaux. Les processus non privili\u00e9gi\u00e9s sont soumis \u00e0 une verification bas\u00e9e sur le processus. Les options : CAP_DAC_OVERRIDE permet \u00e0 root de contourner les v\u00e9rification de lecture et d'\u00e9critures CAP_NET_BIND_SERVICE permet de lier un socket aux ports pr\u00e9vili\u00e9gi\u00e9s (inf\u00e9rieur \u00e0 1024) CAP_CHOWN permet d'apporter des modifications sur les fichiers Tests de la commande NC \u00b6 Avec la commande NC , cela permet de d\u00e9clarer un serveur d'\u00e9coute et ainsi de pouvoir communiquer entre 2 ordinateurs distants Tip Pour pouvoir utiliser les commandes NC, il faut l'installer : dnf -y install nc L'utilisation de nc se r\u00e9alise avec 2 terminaux afin de pouvoir cr\u00e9er comme un canal de communication entre les deux terminaux. On lance avec un user sans droits sudo la commande : nc -l 90 On obtient alors une erreur: Ncat: bind to :::90: Permission denied. QUITTING. Rappel sur les commandes de groupes et users Ajout d'un groupe nomm\u00e9 ncusers : groupadd ncusers Ajout d'un utilisateur avec le groupe ncusers useradd -g ncusers ncuser On copie le dossier nc dans le tmp : cp /bin/nc /tmp/capnc Mise en place des droits : install -o ncuser -g ncusers -m 700 /bin/nc /tmp/capnc R\u00e8glage des droits avec la commande setcap : setcap cap_net_bind_service = ep /tmp/capnc V\u00e9rification des droits sur le dossier : getcap /tmp/capnc Puis on v\u00e9rifie si les droits focntionne avec la connexion sur le ncuser puis l'indication de la commande : su - ncuser -c \"/tmp/capnc -l 90\"","title":"Les permissions"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/#les-permissions","text":"","title":"Les permissions"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/#liste-des-permissions","text":"Commande pour obtenir des informations concernant les droits : ls -l On obteint plusieurs groupes : x : pour se d\u00e9placer dedans (pour les fichier, on execute le fichier tel qu'un script) w : modification de contenu avec l'ajout, la modification ou la suppression d'octect (en fichiers ou en repertoires) r : lecture et copie des fichiers ( r\u00e9pertoire : lister les fichiers) s : Il conf\u00e8re l'identit\u00e9 du propri\u00e9taire de la commande (avec passwd par exemple) t : on trouve la permission sur tout les dossiers temporaires/partages. Seul le propri\u00e8taire du fichier peut le supprimer. (sticky-bit)","title":"Liste des permissions"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/#commandes-de-changements-de-permissions","text":"chown : pour modifier mes permissions du fichier chgrp : L'administrateur et l'utilisateur peuvent modifier les permissions chmod : Permet de changer les permissions d'acc\u00e8s d'un fichier ou d'un r\u00e9pertoire (il faut etre propri\u00e8taire du fichier) Pour chercher les fichiers qui poss\u00e8de le droit s : find -perm /u = s Et on obtient une liste de fichier plus ou moins longue si docker est install\u00e9 : Liste des fichiers poss\u00e8dant le droit permettant une \u00e9l\u00e9vation de privil\u00e8ges Info On peux ajouter une option -o pour faire un or et donc lier plusieurs arguments Exemple : find / -perm /u=s -o -perm /g=s","title":"Commandes de changements de permissions"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/#les-capabilities","text":"","title":"Les capabilities"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/#premieres-notions-sur-les-capabilities","text":"Installation des pages de man (si elles ne sont pas pr\u00e9sentes) : dnf -y install man-pages Overture du man de capabilities : man capabilities Les capabilities ont 2 cat\u00e9gories : les processus privili\u00e9gi\u00e9s les processes non privili\u00e9gi\u00e9s Les processus privili\u00e9gi\u00e9s sont appell\u00e9 par un superutilisateur ou root. Ils contournent les verfications du noyaux. Les processus non privili\u00e9gi\u00e9s sont soumis \u00e0 une verification bas\u00e9e sur le processus. Les options : CAP_DAC_OVERRIDE permet \u00e0 root de contourner les v\u00e9rification de lecture et d'\u00e9critures CAP_NET_BIND_SERVICE permet de lier un socket aux ports pr\u00e9vili\u00e9gi\u00e9s (inf\u00e9rieur \u00e0 1024) CAP_CHOWN permet d'apporter des modifications sur les fichiers","title":"Premi\u00e8res notions sur les capabilities"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/permissions/#tests-de-la-commande-nc","text":"Avec la commande NC , cela permet de d\u00e9clarer un serveur d'\u00e9coute et ainsi de pouvoir communiquer entre 2 ordinateurs distants Tip Pour pouvoir utiliser les commandes NC, il faut l'installer : dnf -y install nc L'utilisation de nc se r\u00e9alise avec 2 terminaux afin de pouvoir cr\u00e9er comme un canal de communication entre les deux terminaux. On lance avec un user sans droits sudo la commande : nc -l 90 On obtient alors une erreur: Ncat: bind to :::90: Permission denied. QUITTING. Rappel sur les commandes de groupes et users Ajout d'un groupe nomm\u00e9 ncusers : groupadd ncusers Ajout d'un utilisateur avec le groupe ncusers useradd -g ncusers ncuser On copie le dossier nc dans le tmp : cp /bin/nc /tmp/capnc Mise en place des droits : install -o ncuser -g ncusers -m 700 /bin/nc /tmp/capnc R\u00e8glage des droits avec la commande setcap : setcap cap_net_bind_service = ep /tmp/capnc V\u00e9rification des droits sur le dossier : getcap /tmp/capnc Puis on v\u00e9rifie si les droits focntionne avec la connexion sur le ncuser puis l'indication de la commande : su - ncuser -c \"/tmp/capnc -l 90\"","title":"Tests de la commande NC"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/","text":"Sudo et Sudoreplay \u00b6 Introduction \u00b6 Sudo est une abr\u00e9viation de \"substitute user do\", \"super user do\" ou \"switch user do \" , en fran\u00e7ais : \u00ab se substituer \u00e0 l'utilisateur pour faire \u00bb, \u00ab faire en tant que super-utilisateur \u00bb ou \u00ab changer d'utilisateur pour faire \u00bb). Elle est utilis\u00e9e dans tquasi tout les syst\u00e8mes de types UNIX. Important Le fichier de configuration de sudo est /etc/sudoers . Ce fichier est logiquement en lecture seule . Pour configurer sudo, on utlise les dossiers g\u00e9n\u00e9r\u00e9s par le package. Ici, un dossier est pr\u00e9sent pour laisser un fichier avec une configuration personnalis\u00e9e dans /etc/sudoers.d/ . Dans ce dossier, vous pouvez cr\u00e9er un fichier avec n'importe quelle extension avec les configurations souhait\u00e9es. Mise en oeuvre de sudo \u00b6 Directives de configurations Ici chez sudo, nous avons une directive de configuration avec !log_output . Tout est redirig\u00e9 dans le dossier /var/log/sudo-io . Mise en place des logs \u00b6 Cr\u00e9ation du dossier pour le stockage des logs d'output : mkdir -p /var/log/sudo-io Application des redirections de logs dans le dossier nouvellement cr\u00e9e. Ici on place un nouveau fichier dans /etc/sudoers.d/ nomm\u00e9 config : Defaults log_output Defaults!/usr/bin/sudoreplay !log_output Defaults!/sbin/reboot !log_output R\u00e9alisaton de r\u00e8gles pour sudo \u00b6 Commandes swap \u00b6 On souhaite que le groupe users puisse r\u00e9aliser les commandes : swapon avec n'importe quel argument swapoff avec l'argument unique \\dev\\sda3 On r\u00e9alise un nouveau fichier nomm\u00e9 swap_off_users dans le dossier de configuration de sudo : %users ALL = ( ALL ) /sbin/swapon, /sbin/swapoff /dev/sda3 Tip Pour tester les commandes, il est conseill\u00e9 de prendre un utilisateur sans aucun groupes afin de pouvoir tester simplement. Rappel : pour ajouter un user la commande est useradd et la commande pour ajouter dans un groupe usermod -aG Ici on ajoute l'utlisateur utlisateur dans le groupe users : usermod -aG users utilisateur Pour tester les commandes, on utlise les commandes suivantes : 1 2 sudo swapon /dev/sda3 sudo swapoff /dev/sda3 Commande ID \u00b6 Sudoreplay \u00b6 Avec l'activation des logs r\u00e9alis\u00e9 plus haut, tout les logs ont \u00e9t\u00e9 enregistr\u00e9s. Les logs se trouvent dans /var/log/sudo-io On peux afficher les logs avec la commande : ls -trl /var/log/sudo-io/00/00/* On peux aussi afficher les replays avec le TSID avec la commande : sudoreplay -l Pour jouer les sessions, on utlise sudoreplay avec sudoreplay TSID .","title":"Sudo et Sudoreplay"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#sudo-et-sudoreplay","text":"","title":"Sudo et Sudoreplay"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#introduction","text":"Sudo est une abr\u00e9viation de \"substitute user do\", \"super user do\" ou \"switch user do \" , en fran\u00e7ais : \u00ab se substituer \u00e0 l'utilisateur pour faire \u00bb, \u00ab faire en tant que super-utilisateur \u00bb ou \u00ab changer d'utilisateur pour faire \u00bb). Elle est utilis\u00e9e dans tquasi tout les syst\u00e8mes de types UNIX. Important Le fichier de configuration de sudo est /etc/sudoers . Ce fichier est logiquement en lecture seule . Pour configurer sudo, on utlise les dossiers g\u00e9n\u00e9r\u00e9s par le package. Ici, un dossier est pr\u00e9sent pour laisser un fichier avec une configuration personnalis\u00e9e dans /etc/sudoers.d/ . Dans ce dossier, vous pouvez cr\u00e9er un fichier avec n'importe quelle extension avec les configurations souhait\u00e9es.","title":"Introduction"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#mise-en-oeuvre-de-sudo","text":"Directives de configurations Ici chez sudo, nous avons une directive de configuration avec !log_output . Tout est redirig\u00e9 dans le dossier /var/log/sudo-io .","title":"Mise en oeuvre de sudo"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#mise-en-place-des-logs","text":"Cr\u00e9ation du dossier pour le stockage des logs d'output : mkdir -p /var/log/sudo-io Application des redirections de logs dans le dossier nouvellement cr\u00e9e. Ici on place un nouveau fichier dans /etc/sudoers.d/ nomm\u00e9 config : Defaults log_output Defaults!/usr/bin/sudoreplay !log_output Defaults!/sbin/reboot !log_output","title":"Mise en place des logs"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#realisaton-de-regles-pour-sudo","text":"","title":"R\u00e9alisaton de r\u00e8gles pour sudo"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#commandes-swap","text":"On souhaite que le groupe users puisse r\u00e9aliser les commandes : swapon avec n'importe quel argument swapoff avec l'argument unique \\dev\\sda3 On r\u00e9alise un nouveau fichier nomm\u00e9 swap_off_users dans le dossier de configuration de sudo : %users ALL = ( ALL ) /sbin/swapon, /sbin/swapoff /dev/sda3 Tip Pour tester les commandes, il est conseill\u00e9 de prendre un utilisateur sans aucun groupes afin de pouvoir tester simplement. Rappel : pour ajouter un user la commande est useradd et la commande pour ajouter dans un groupe usermod -aG Ici on ajoute l'utlisateur utlisateur dans le groupe users : usermod -aG users utilisateur Pour tester les commandes, on utlise les commandes suivantes : 1 2 sudo swapon /dev/sda3 sudo swapoff /dev/sda3","title":"Commandes swap"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#commande-id","text":"","title":"Commande ID"},{"location":"Linux/Master/S%C3%A9curit%C3%A9/sudo/#sudoreplay","text":"Avec l'activation des logs r\u00e9alis\u00e9 plus haut, tout les logs ont \u00e9t\u00e9 enregistr\u00e9s. Les logs se trouvent dans /var/log/sudo-io On peux afficher les logs avec la commande : ls -trl /var/log/sudo-io/00/00/* On peux aussi afficher les replays avec le TSID avec la commande : sudoreplay -l Pour jouer les sessions, on utlise sudoreplay avec sudoreplay TSID .","title":"Sudoreplay"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Commandes%20dans%20kubernetes/","text":"Commandes dans Kubernetes \u00b6 Changement de l'espace de travail kubectl config set-context --current --namespace kube-system Cr\u00e9ation d'un espace de travail kubectl create namespace leo Se situer dans l'environement kubectl config get-contexts Cr\u00e9ation d'un d\u00e9ployment kubectl create deployment --image nginx:latest --port 80 nginx Lister les deployments kubectl get deployments Lister les pods de mani\u00e8re simple kubectl get pods Lister les pods de mani\u00e8re plus compl\u00e8te kubectl get pods -o wide Cr\u00e9ation d'un service kubectl create service loadbalancer --tcp 80 :80 ngnix Recuprer le service kubectl get service Edition du r\u00e9plicat kubectl scale --replicas = 3 deployment nginx D\u00e9ployement d'un template kubectl apply -f ./Deployment_whomi.yml Voir les logs d'un pod kubectl logs -f whoami Voir les logs d'un pod avec le label kubectl logs -f -l app = whoami Passer en mode exectution dans le pod kubectl exec -it nginx-deployment -- sh","title":"Commandes dans Kubernetes"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Commandes%20dans%20kubernetes/#commandes-dans-kubernetes","text":"Changement de l'espace de travail kubectl config set-context --current --namespace kube-system Cr\u00e9ation d'un espace de travail kubectl create namespace leo Se situer dans l'environement kubectl config get-contexts Cr\u00e9ation d'un d\u00e9ployment kubectl create deployment --image nginx:latest --port 80 nginx Lister les deployments kubectl get deployments Lister les pods de mani\u00e8re simple kubectl get pods Lister les pods de mani\u00e8re plus compl\u00e8te kubectl get pods -o wide Cr\u00e9ation d'un service kubectl create service loadbalancer --tcp 80 :80 ngnix Recuprer le service kubectl get service Edition du r\u00e9plicat kubectl scale --replicas = 3 deployment nginx D\u00e9ployement d'un template kubectl apply -f ./Deployment_whomi.yml Voir les logs d'un pod kubectl logs -f whoami Voir les logs d'un pod avec le label kubectl logs -f -l app = whoami Passer en mode exectution dans le pod kubectl exec -it nginx-deployment -- sh","title":"Commandes dans Kubernetes"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Syntaxe%20fichier%20deployment%20et%20services/","text":"Syntaxe du deployment \u00b6 apiVersion : apps/v1 kind : Deployment metadata : name : nginx-deployment labels : app : nginx spec : replicas : 3 selector : matchLabels : app : nginx template : metadata : labels : app : nginx spec : containers : - name : nginx image : nginx:1.14.2 ports : - containerPort : 80 Syntaxe du service \u00b6 apiVersion : v1 kind : Service metadata : name : my-service spec : selector : app.kubernetes.io/name : MyApp ports : - protocol : TCP port : 80 targetPort : 9376 Exemple de fichier complet \u00b6 apiVersion : apps/v1 kind : Deployment metadata : name : whoami-deployment labels : app : whoami spec : replicas : 3 selector : matchLabels : app : whoami template : metadata : labels : app : whoami spec : containers : - name : whoami image : traefik/whoami:latest ports : - containerPort : 80 protocol : TCP --- apiVersion : v1 kind : Service metadata : name : whoami-service spec : selector : app : whoami ports : - protocol : TCP port : 80 targetPort : 80 type : LoadBalancer Exemple avec modification de ports \u00b6 apiVersion : apps/v1 kind : Deployment metadata : name : whoami-deployment labels : app : whoami spec : replicas : 3 selector : matchLabels : app : whoami template : metadata : labels : app : whoami spec : containers : - name : whoami image : traefik/whoami:latest env : - name : WHOAMI_PORT_NUMBER value : \"1234\" ports : - containerPort : 1234 protocol : TCP --- apiVersion : v1 kind : Service metadata : name : whoami-service spec : selector : app : whoami ports : - protocol : TCP port : 80 targetPort : 1234 type : LoadBalancer","title":"Syntaxe fichier deployment et services"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Syntaxe%20fichier%20deployment%20et%20services/#syntaxe-du-deployment","text":"apiVersion : apps/v1 kind : Deployment metadata : name : nginx-deployment labels : app : nginx spec : replicas : 3 selector : matchLabels : app : nginx template : metadata : labels : app : nginx spec : containers : - name : nginx image : nginx:1.14.2 ports : - containerPort : 80","title":"Syntaxe du deployment"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Syntaxe%20fichier%20deployment%20et%20services/#syntaxe-du-service","text":"apiVersion : v1 kind : Service metadata : name : my-service spec : selector : app.kubernetes.io/name : MyApp ports : - protocol : TCP port : 80 targetPort : 9376","title":"Syntaxe du service"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Syntaxe%20fichier%20deployment%20et%20services/#exemple-de-fichier-complet","text":"apiVersion : apps/v1 kind : Deployment metadata : name : whoami-deployment labels : app : whoami spec : replicas : 3 selector : matchLabels : app : whoami template : metadata : labels : app : whoami spec : containers : - name : whoami image : traefik/whoami:latest ports : - containerPort : 80 protocol : TCP --- apiVersion : v1 kind : Service metadata : name : whoami-service spec : selector : app : whoami ports : - protocol : TCP port : 80 targetPort : 80 type : LoadBalancer","title":"Exemple de fichier complet"},{"location":"Vitrualisation%20%26%20cloud/Commandes/Syntaxe%20fichier%20deployment%20et%20services/#exemple-avec-modification-de-ports","text":"apiVersion : apps/v1 kind : Deployment metadata : name : whoami-deployment labels : app : whoami spec : replicas : 3 selector : matchLabels : app : whoami template : metadata : labels : app : whoami spec : containers : - name : whoami image : traefik/whoami:latest env : - name : WHOAMI_PORT_NUMBER value : \"1234\" ports : - containerPort : 1234 protocol : TCP --- apiVersion : v1 kind : Service metadata : name : whoami-service spec : selector : app : whoami ports : - protocol : TCP port : 80 targetPort : 1234 type : LoadBalancer","title":"Exemple avec modification de ports"},{"location":"Vitrualisation%20%26%20cloud/Rappels/Rappel%20sur%20la%20virtualisation/","text":"La vitrualisation \u00b6 Rappel sur les VM et les conteneurs \u00b6 Diff\u00e9rence entre la VM et le conteneur \u00b6 Rappel sur la virtualisation et les conteneurs Les VM h\u00e9bergent un syst\u00e8me virtuel complet comprenant le hardware (physique) et l'OS (Op\u00e9rating Syst\u00e8me). Cot\u00e9 conteneurs, celui-ci est utilis\u00e9 pour : la performance les ressources Facilite la MCO ( + vite , + leger et un versionning avanc\u00e9) Le prix Gain d'agilit\u00e9 Mise \u00e0 l'\u00e9chelle plus facile Les conteneurs d\u00e9pendent d'une seule et unique application. Principe du conteneur L'architecture des conteneur d\u00e9taill\u00e9 \u00b6 Le conteneur poss\u00e8de tout son environement tout autour de l'application Principe du conteneur - Architecture","title":"La vitrualisation"},{"location":"Vitrualisation%20%26%20cloud/Rappels/Rappel%20sur%20la%20virtualisation/#la-vitrualisation","text":"","title":"La vitrualisation"},{"location":"Vitrualisation%20%26%20cloud/Rappels/Rappel%20sur%20la%20virtualisation/#rappel-sur-les-vm-et-les-conteneurs","text":"","title":"Rappel sur les VM et les conteneurs"},{"location":"Vitrualisation%20%26%20cloud/Rappels/Rappel%20sur%20la%20virtualisation/#difference-entre-la-vm-et-le-conteneur","text":"Rappel sur la virtualisation et les conteneurs Les VM h\u00e9bergent un syst\u00e8me virtuel complet comprenant le hardware (physique) et l'OS (Op\u00e9rating Syst\u00e8me). Cot\u00e9 conteneurs, celui-ci est utilis\u00e9 pour : la performance les ressources Facilite la MCO ( + vite , + leger et un versionning avanc\u00e9) Le prix Gain d'agilit\u00e9 Mise \u00e0 l'\u00e9chelle plus facile Les conteneurs d\u00e9pendent d'une seule et unique application. Principe du conteneur","title":"Diff\u00e9rence entre la VM et le conteneur"},{"location":"Vitrualisation%20%26%20cloud/Rappels/Rappel%20sur%20la%20virtualisation/#larchitecture-des-conteneur-detaille","text":"Le conteneur poss\u00e8de tout son environement tout autour de l'application Principe du conteneur - Architecture","title":"L'architecture des conteneur d\u00e9taill\u00e9"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/","text":"Kubernetes \u00b6 D\u00e9finition \u00b6 Kubernetes est une solution Open Source permettant l'orchestration de ressources conteneuris\u00e9es. Cette solution est une solution d\u00e9velopp\u00e9e par Google et elle \u00e0 \u00e9t\u00e9 offert \u00e0 la Linux Fondation (2014). Par la suite la CNCF (Cloud Native Computing Fondation) \u00e0 \u00e9t\u00e9 cr\u00e9e en 2015. D\u00e9finition de kubernetes par la CNCF Kubernetes est ue plateforme open source extensible et portable pour la gestion de charge de trvail et de service conteneuris\u00e9s. Autres plateformes \u00b6 On retrouve plusieurs plateformes encore active aujourd'hui contrairement \u00e0 Docker Swarm, Mesos ... Les solutions actuelles : Titus, solution utilis\u00e9e par Netflix Nomad, soltion en voggue propuls\u00e9e par Hashicorp Apache Mesos , solution propos\u00e9e par Apache Fonctionnement de Kubernetes \u00b6 Architecture de kubernetes \u00b6 Termes utilis\u00e9s dans Kubernetes \u00b6 Terme Signification Master (ou control-plane) Permet de g\u00e9rer le syst\u00e8mes Workers Permet d'executer l'applicatif ETCD Magasin de valeurs cl\u00e9s coh\u00e9rent et hautement disponible Scheduleur Assure les diff\u00e9rentes contraintes (arret, d\u00e9marrage des conteneurs) Controller Manager Gestion des droits API-SERVER Centre n\u00e9vralgique de kubernetes Kube proxy Assure le r\u00e9seau, la communication avec l'api-server Kubelet Seul composant non contenuris\u00e9. Service systemctl qui va communiquer avec le moteur de contenurisation container Ressource ex\u00e9cutant une application pod Groupement d'un ou plusieurs conteneurs deployment Orchestre les pods et replicaSets deamonset S'assure d'avoir un pod sur chaque noeud statefullset [legacy] S'assure de n'avoir qu'un seul pod service Explose votre application sur le r\u00e9seau du cluster ingress Permet d'exposer un service en externe (#reverseProxy) persistent volumes claims Demande d'allocation de stockage configMaps stockage cl\u00e9-valeur non confidentiel secrets stockage cl\u00e9-valeur confidentiel Objets de kubernetes \u00b6","title":"Kubernetes"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#kubernetes","text":"","title":"Kubernetes"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#definition","text":"Kubernetes est une solution Open Source permettant l'orchestration de ressources conteneuris\u00e9es. Cette solution est une solution d\u00e9velopp\u00e9e par Google et elle \u00e0 \u00e9t\u00e9 offert \u00e0 la Linux Fondation (2014). Par la suite la CNCF (Cloud Native Computing Fondation) \u00e0 \u00e9t\u00e9 cr\u00e9e en 2015. D\u00e9finition de kubernetes par la CNCF Kubernetes est ue plateforme open source extensible et portable pour la gestion de charge de trvail et de service conteneuris\u00e9s.","title":"D\u00e9finition"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#autres-plateformes","text":"On retrouve plusieurs plateformes encore active aujourd'hui contrairement \u00e0 Docker Swarm, Mesos ... Les solutions actuelles : Titus, solution utilis\u00e9e par Netflix Nomad, soltion en voggue propuls\u00e9e par Hashicorp Apache Mesos , solution propos\u00e9e par Apache","title":"Autres plateformes"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#fonctionnement-de-kubernetes","text":"","title":"Fonctionnement de Kubernetes"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#architecture-de-kubernetes","text":"","title":"Architecture de kubernetes"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#termes-utilises-dans-kubernetes","text":"Terme Signification Master (ou control-plane) Permet de g\u00e9rer le syst\u00e8mes Workers Permet d'executer l'applicatif ETCD Magasin de valeurs cl\u00e9s coh\u00e9rent et hautement disponible Scheduleur Assure les diff\u00e9rentes contraintes (arret, d\u00e9marrage des conteneurs) Controller Manager Gestion des droits API-SERVER Centre n\u00e9vralgique de kubernetes Kube proxy Assure le r\u00e9seau, la communication avec l'api-server Kubelet Seul composant non contenuris\u00e9. Service systemctl qui va communiquer avec le moteur de contenurisation container Ressource ex\u00e9cutant une application pod Groupement d'un ou plusieurs conteneurs deployment Orchestre les pods et replicaSets deamonset S'assure d'avoir un pod sur chaque noeud statefullset [legacy] S'assure de n'avoir qu'un seul pod service Explose votre application sur le r\u00e9seau du cluster ingress Permet d'exposer un service en externe (#reverseProxy) persistent volumes claims Demande d'allocation de stockage configMaps stockage cl\u00e9-valeur non confidentiel secrets stockage cl\u00e9-valeur confidentiel","title":"Termes utilis\u00e9s dans Kubernetes"},{"location":"Vitrualisation%20%26%20cloud/kube/Informations%20sur%20kubernetes/#objets-de-kubernetes","text":"","title":"Objets de kubernetes"},{"location":"Windows/Active%20directory/GPO/","text":"Nous avons un script \u00e0 d\u00e9ployer sur toutes les machines du domaine. Ce script doit : S'executer au d\u00e9marrage de la session Les utilisateurs dans les OU choisi doivent avoir se script Info OU = Unit\u00e9 d'organisation Cr\u00e9ation d'un OU \u00b6 Pour cr\u00e9er un OU, le serveur (ici un Windows serveur 2019) doit \u00eatre un serveur AD. Le serveur AD doit \u00eatre promu en contr\u00f4leur de domaine. La cr\u00e9ation d'OU, intervient dans les outils du gestionnaire de serveur puis dans dans gestion des strat\u00e9gies de groupe . Outils de l'AD On obtient ensuite une fen\u00eatre avec la for\u00eat. Gestion des strat\u00e9gies de groupes On utlise ensuite le clic droit -> Nouvelle unit\u00e9 d'organsiation Cr\u00e9ation de l'OU Donnez ensuite un nom \u00e0 votre OU. On retrouve cette OU dans la foret sous les domaines Unit\u00e9 organisation 1 Cr\u00e9ation de la GPO \u00b6 Une fois l'OU cr\u00e9e, vous pouvez vous positionner sur celle-ci et faire Clic droit -> Cr\u00e9\u00e9r un objet GPO Mettez un nom \u00e0 cette GPO. Cr\u00e9ation de la GPO Faites clic droit sur la GPO puis modifier l\u00e0. Ici nous allons dans les strat\u00e9gies de scripts d'ouverture de sessions. Localisation des scripts d'ouverture de sessions On ajoute le script (ici un script powershell) dans l'onglet Powershell. Quand on met un script, il faut garder le dossier par d\u00e9faut et mettre le script dans ce dossier. \\\\AD-LG.local\\SysVol\\AD-LG.local\\Policies\\{53DB8C41-12CE-42EE-9DD9-509CA44D262A}\\User\\Scripts\\Logon Ici le chemin avec le num\u00e9ro de la GPO. On v\u00e9rifie ensuite le nom du script. Onglet powershell Sur la machine cliente, on peux voir avec un GPRESULT /R l'\u00e9tat de la GPO. On v\u00e9rifie que la GPO espion est bien pr\u00e9sent. Verificiation du scripts d'ouverture de sessions","title":"GPO"},{"location":"Windows/Active%20directory/GPO/#creation-dun-ou","text":"Pour cr\u00e9er un OU, le serveur (ici un Windows serveur 2019) doit \u00eatre un serveur AD. Le serveur AD doit \u00eatre promu en contr\u00f4leur de domaine. La cr\u00e9ation d'OU, intervient dans les outils du gestionnaire de serveur puis dans dans gestion des strat\u00e9gies de groupe . Outils de l'AD On obtient ensuite une fen\u00eatre avec la for\u00eat. Gestion des strat\u00e9gies de groupes On utlise ensuite le clic droit -> Nouvelle unit\u00e9 d'organsiation Cr\u00e9ation de l'OU Donnez ensuite un nom \u00e0 votre OU. On retrouve cette OU dans la foret sous les domaines Unit\u00e9 organisation 1","title":"Cr\u00e9ation d'un OU"},{"location":"Windows/Active%20directory/GPO/#creation-de-la-gpo","text":"Une fois l'OU cr\u00e9e, vous pouvez vous positionner sur celle-ci et faire Clic droit -> Cr\u00e9\u00e9r un objet GPO Mettez un nom \u00e0 cette GPO. Cr\u00e9ation de la GPO Faites clic droit sur la GPO puis modifier l\u00e0. Ici nous allons dans les strat\u00e9gies de scripts d'ouverture de sessions. Localisation des scripts d'ouverture de sessions On ajoute le script (ici un script powershell) dans l'onglet Powershell. Quand on met un script, il faut garder le dossier par d\u00e9faut et mettre le script dans ce dossier. \\\\AD-LG.local\\SysVol\\AD-LG.local\\Policies\\{53DB8C41-12CE-42EE-9DD9-509CA44D262A}\\User\\Scripts\\Logon Ici le chemin avec le num\u00e9ro de la GPO. On v\u00e9rifie ensuite le nom du script. Onglet powershell Sur la machine cliente, on peux voir avec un GPRESULT /R l'\u00e9tat de la GPO. On v\u00e9rifie que la GPO espion est bien pr\u00e9sent. Verificiation du scripts d'ouverture de sessions","title":"Cr\u00e9ation de la GPO"},{"location":"Windows/Powershell/Cr%C3%A9ation%20d%27un%20dossier%2Bscript/","text":"Verification \u00b6 Dans cette partie, on va v\u00e9rifier si un dossier est cr\u00e9e \u00e0\u00f9 non. Pour test si un dossier existe, on va utiliser Get-Item : $retour = Get-Item -Path \"c:/log\" -ErrorAction SilentlyContinue Ici, on stocke la valeur rendu par la commande dans $retour . On va ensuite aller chercher le dossier c:/log . On va s'assurer que la commande s'excute en silence m\u00eame si il y a des erreurs avec -ErrorAction SilentlyContinue Note Ici nous utilisons un dossier qui n'existe pas. Le but de cette activit\u00e9 est de cr\u00e9er un script qui quand il ne trouve pas le dossier c:/log , il cr\u00e9e un dossier. Dans ce dossier, nous souhaitons qu'il y ai un fichier nomm\u00e9 'ESPION.txt'. On va donc cr\u00e9er un dossier \u00e0 la racine si celui-ci n'existe pas : if (!( Get-Item -Path \"c:\\log\" -ErrorAction SilentlyContinue )) { New-Item \"c:\\log\" -ItemType Directory } On v\u00e9rifie ensuite si le fichier espion.txt existe dans le dossier c:\\log : if (!( Get-Item -Path \"c:\\log\\espion.txt\" -ErrorAction SilentlyContinue )) { New-Item -Path \"c:\\log\\espion.txt\" -ItemType File } On r\u00e9alise ensuite le script complet avec l'impl\u00e9mentation du user et de la date/heure : if (!( Get-Item -Path \"c:\\log\" -ErrorAction SilentlyContinue )) { New-Item \"c:\\log\" -ItemType Directory } if (!( Get-Item -Path \"c:\\log\\espion.txt\" -ErrorAction SilentlyContinue )) { New-Item -Path \"c:\\log\\espion.txt\" -ItemType File } $export = \"{0,-20}:{1:yyyy}:{2}:{3}:{4}:{5}:{6}\" -f $env:USERNAME , ( Get-Date ),( Get-Date ). Month ,( Get-Date ). Day ,( Get-Date ). Hour ,( Get-Date ). Minute , ( Get-Date ). DayOfWeek Write-Output $export ADD-content -path \"c:\\log\\espion.txt\" -value $export Note Le ADD-content -path \"c:\\log\\espion.txt\" -value $export permet d'\u00e9crit dans le fichier espion.txt","title":"Cr\u00e9ation d'un dossier+script"},{"location":"Windows/Powershell/Cr%C3%A9ation%20d%27un%20dossier%2Bscript/#verification","text":"Dans cette partie, on va v\u00e9rifier si un dossier est cr\u00e9e \u00e0\u00f9 non. Pour test si un dossier existe, on va utiliser Get-Item : $retour = Get-Item -Path \"c:/log\" -ErrorAction SilentlyContinue Ici, on stocke la valeur rendu par la commande dans $retour . On va ensuite aller chercher le dossier c:/log . On va s'assurer que la commande s'excute en silence m\u00eame si il y a des erreurs avec -ErrorAction SilentlyContinue Note Ici nous utilisons un dossier qui n'existe pas. Le but de cette activit\u00e9 est de cr\u00e9er un script qui quand il ne trouve pas le dossier c:/log , il cr\u00e9e un dossier. Dans ce dossier, nous souhaitons qu'il y ai un fichier nomm\u00e9 'ESPION.txt'. On va donc cr\u00e9er un dossier \u00e0 la racine si celui-ci n'existe pas : if (!( Get-Item -Path \"c:\\log\" -ErrorAction SilentlyContinue )) { New-Item \"c:\\log\" -ItemType Directory } On v\u00e9rifie ensuite si le fichier espion.txt existe dans le dossier c:\\log : if (!( Get-Item -Path \"c:\\log\\espion.txt\" -ErrorAction SilentlyContinue )) { New-Item -Path \"c:\\log\\espion.txt\" -ItemType File } On r\u00e9alise ensuite le script complet avec l'impl\u00e9mentation du user et de la date/heure : if (!( Get-Item -Path \"c:\\log\" -ErrorAction SilentlyContinue )) { New-Item \"c:\\log\" -ItemType Directory } if (!( Get-Item -Path \"c:\\log\\espion.txt\" -ErrorAction SilentlyContinue )) { New-Item -Path \"c:\\log\\espion.txt\" -ItemType File } $export = \"{0,-20}:{1:yyyy}:{2}:{3}:{4}:{5}:{6}\" -f $env:USERNAME , ( Get-Date ),( Get-Date ). Month ,( Get-Date ). Day ,( Get-Date ). Hour ,( Get-Date ). Minute , ( Get-Date ). DayOfWeek Write-Output $export ADD-content -path \"c:\\log\\espion.txt\" -value $export Note Le ADD-content -path \"c:\\log\\espion.txt\" -value $export permet d'\u00e9crit dans le fichier espion.txt","title":"Verification"},{"location":"Windows/Powershell/Cr%C3%A9ation%20fichier%20avec%20user%20%2B%20date/","text":"Comment obtenir la date en Powershell \u00b6 On utilise la commande : 1 Get-Date R\u00e9sultat de la commande Get-date Obtenir certaines informations d'apr\u00e8s une commande \u00b6 Note Les op\u00e9rateurs sont r\u00e9f\u00e9renc\u00e9s sur le site : https://ss64.com/ps/ On souhaite r\u00e9cup\u00e9rer les diff\u00e9rents membre de la date affich\u00e9e par powershell : 1 Get-Date | Get-Member R\u00e9sultat de la damande des membres Dans le cas de la commande Get-member et de Powershell en g\u00e9n\u00e9ral, nous avons un language orient\u00e9 objet. On r\u00e9cup\u00e8re les quelques informations : 1 Get-Date | Select-Object -Property Year , Month , Day Cette commande nous donne un tableau de valeur : Tableau de date On stocke la valeur dans une variable temporaire : 1 2 3 $DATE = Get-Date $DATE . Day On r\u00e9cup\u00e8re uniquement la valeur de la date. Info On peux aussi r\u00e9cup\u00e8rer la valeur d'un autre fa\u00e7on : ( Get-Date ). Day Cherche une chaine de caract\u00e8res : Get-Date -UFormat \"%Y:%m:%d:%R:%A\" Chaine de caract\u00e8re obtenue On prend le nom d'utilisateur : 1 $env:USERNAME On va ensuite aller chercher les diff\u00e9rentes informations avec leur position : 1 \"{0,-20}:{1:yyyy}:{2:MM}\" -f $env:USERNAME , ( Get-Date ). Year , ( Get-Date ). Month Info On utilise les {} pour donner la position + le formatage L'option -f permet de r\u00e9aliser le formatage Les diff\u00e9rentes informations sont s\u00e9par\u00e9es par une virgule , Pour afficher et cr\u00e9er un fichier avec les informations voulue : 1 2 3 4 5 6 7 8 9 10 11 12 $export = \"{0,-20}:{1:yyyy}:{2}:{3}:{4}\" -f $env:USERNAME , ( Get-Date ),( Get-Date ). Month ,( Get-Date ). Day ,( Get-Date ). DayOfWeek Write-Output $export # Export dans un txt # On verifi si le fichier existe $file = \".\\export.txt\" if (!( Test-Path -Path $file )){ #Si il existe pas on le cr\u00e9er New-Item -Path $file } # On ajoute notre ligne dans le fichier ADD-content -path $file -value $export","title":"Cr\u00e9ation fichier avec user + date"},{"location":"Windows/Powershell/Cr%C3%A9ation%20fichier%20avec%20user%20%2B%20date/#comment-obtenir-la-date-en-powershell","text":"On utilise la commande : 1 Get-Date R\u00e9sultat de la commande Get-date","title":"Comment obtenir la date en Powershell"},{"location":"Windows/Powershell/Cr%C3%A9ation%20fichier%20avec%20user%20%2B%20date/#obtenir-certaines-informations-dapres-une-commande","text":"Note Les op\u00e9rateurs sont r\u00e9f\u00e9renc\u00e9s sur le site : https://ss64.com/ps/ On souhaite r\u00e9cup\u00e9rer les diff\u00e9rents membre de la date affich\u00e9e par powershell : 1 Get-Date | Get-Member R\u00e9sultat de la damande des membres Dans le cas de la commande Get-member et de Powershell en g\u00e9n\u00e9ral, nous avons un language orient\u00e9 objet. On r\u00e9cup\u00e8re les quelques informations : 1 Get-Date | Select-Object -Property Year , Month , Day Cette commande nous donne un tableau de valeur : Tableau de date On stocke la valeur dans une variable temporaire : 1 2 3 $DATE = Get-Date $DATE . Day On r\u00e9cup\u00e8re uniquement la valeur de la date. Info On peux aussi r\u00e9cup\u00e8rer la valeur d'un autre fa\u00e7on : ( Get-Date ). Day Cherche une chaine de caract\u00e8res : Get-Date -UFormat \"%Y:%m:%d:%R:%A\" Chaine de caract\u00e8re obtenue On prend le nom d'utilisateur : 1 $env:USERNAME On va ensuite aller chercher les diff\u00e9rentes informations avec leur position : 1 \"{0,-20}:{1:yyyy}:{2:MM}\" -f $env:USERNAME , ( Get-Date ). Year , ( Get-Date ). Month Info On utilise les {} pour donner la position + le formatage L'option -f permet de r\u00e9aliser le formatage Les diff\u00e9rentes informations sont s\u00e9par\u00e9es par une virgule , Pour afficher et cr\u00e9er un fichier avec les informations voulue : 1 2 3 4 5 6 7 8 9 10 11 12 $export = \"{0,-20}:{1:yyyy}:{2}:{3}:{4}\" -f $env:USERNAME , ( Get-Date ),( Get-Date ). Month ,( Get-Date ). Day ,( Get-Date ). DayOfWeek Write-Output $export # Export dans un txt # On verifi si le fichier existe $file = \".\\export.txt\" if (!( Test-Path -Path $file )){ #Si il existe pas on le cr\u00e9er New-Item -Path $file } # On ajoute notre ligne dans le fichier ADD-content -path $file -value $export","title":"Obtenir certaines informations d'apr\u00e8s une commande"}]}